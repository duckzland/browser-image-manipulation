{"version":3,"file":"browser-image-manipulation.js","sources":["../src/loaders/loadBlob.js","../src/loaders/loadCanvas.js","../src/manipulations/imageResize.js","../src/helpers/degreesToRadian.js","../src/manipulations/rotate.js","../src/manipulations/centerInRectangle.js","../src/manipulations/circle.js","../src/filters/grayscale.js","../src/filters/pixelize.js","../node_modules/stackblur-canvas/dist/stackblur-es.js","../src/filters/gaussianBlur.js","../src/helpers/fileExtByMimeType.js","../src/savers/asBlob.js","../src/savers/asCanvas.js","../src/savers/asImage.js","../src/helpers/pointsTo2DArray.js","../src/draw/draw.js","../src/manipulations/perspective.js","../node_modules/regenerator-runtime/runtime.js","../node_modules/pica/dist/pica.js","../src/constants.js","../src/ImageManipulation.js","../node_modules/blueimp-canvas-to-blob/js/canvas-to-blob.js","../index.js"],"sourcesContent":["/**\n * @param imageFile{File}\n * @returns {function(): Promise<{canvas: HTMLCanvasElement, fileName: String}>}\n */\nexport function loadBlob (imageFile) {\n    return () => new Promise((resolve, reject) => {\n        let image = document.createElement('img')\n        let reader = new FileReader()\n        reader.onload = (data) => {\n            image.src = data.target.result\n        }\n        reader.onerror = () => {\n            reject(new Error('Image read error'))\n        }\n        image.onload = () => {\n            let canvas = document.createElement('canvas')\n            canvas.width = image.width\n            canvas.height = image.height\n            let ctx = canvas.getContext('2d')\n            ctx.drawImage(image, 0, 0, canvas.width, canvas.height)\n            resolve({canvas, fileName: imageFile.name})\n        }\n        image.onerror = () => {\n            reject(new Error('Invalid image'))\n        }\n        reader.readAsDataURL(imageFile)\n    })\n}\n","/**\n * @param canvas{HTMLCanvasElement}\n * @param fileName{String}\n * @returns {function(): Promise<{canvas: HTMLCanvasElement, fileName: String}>}\n */\nexport function loadCanvas (canvas, fileName) {\n    return () => Promise.resolve({canvas, fileName})\n}\n","import Pica from 'pica/dist/pica'\n\nimport {RESIZE_TYPE_SQUARE, RESIZE_TYPE_TO} from '../constants'\n\n/**\n * @param newWidth{number} - new width after crop.\n * @param newHeight{number} - new height after crop.\n * @param offsetX{number} - If specified, cropping will start from that offset on X axis,\n * otherwise it will crop so result is centered in the source\n * @param offsetY{number} - If specified, cropping will start from that offset on Y axis,\n * otherwise it will crop so result is centered in the source\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\n export function imageCrop(newWidth, newHeight, offsetX = 0, offsetY = 0) {\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let dx = 0\n        let dy = 0\n        let sx = 0\n        let sy = 0\n        let width = canvasImage.width\n        let height = canvasImage.height\n\n        sy = offsetY || (height - newHeight) / 2\n        sx = offsetX || (width - newWidth) / 2\n\n        let cropedCanvas = document.createElement('canvas')\n        let cropedCanvasCtx = cropedCanvas.getContext('2d')\n        cropedCanvas.width = newWidth\n        cropedCanvas.height = newHeight\n\n        cropedCanvasCtx.drawImage(canvasImage, sx, sy, newWidth, newHeight, dx, dy, newWidth, newHeight)\n\n        resolve(cropedCanvas)\n    })\n }\n\n/**\n * @param maxWidth\n * @param maxHeight\n * @param type\n * @param options{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function imageResize (maxWidth, maxHeight, type = null, options = {}) {\n    let resizeOptions = Object.assign({\n        pica: {}\n    }, options)\n\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let outputCanvas = null\n        let canvas = document.createElement('canvas')\n        let ratio = 0\n        let width = canvasImage.width\n        let height = canvasImage.height\n        let newHeight = 0\n        let newWidth = 0\n\n        if (type === RESIZE_TYPE_SQUARE) {\n            if (width < height) {\n                ratio = maxWidth / width\n            } else {\n                ratio = maxHeight / height\n            }\n            newHeight = height * ratio\n            newWidth = width * ratio\n        } else if (type === RESIZE_TYPE_TO) {\n            let ratioWidth = width / maxWidth\n            let ratioHeight = height / maxHeight\n            if (ratioWidth > ratioHeight) {\n                newHeight = Math.round(height / ratioWidth)\n                newWidth = maxWidth\n            } else {\n                newWidth = Math.round(width / ratioHeight)\n                newHeight = maxHeight\n            }\n        } else {\n            reject(new Error('Unknown resize type'))\n        }\n\n        canvas.width = newWidth\n        canvas.height = newHeight\n\n        let picaInstanse = new Pica()\n        picaInstanse.resize(canvasImage, canvas, resizeOptions.pica).then(resizedCanvas => {\n            if (type === RESIZE_TYPE_SQUARE) {\n                let dx = 0\n                let dy = 0\n                let sx = 0\n                let sy = 0\n\n                if (newWidth < newHeight) {\n                    sy = (newHeight - newWidth) / 2\n                    newHeight = newWidth\n                } else {\n                    sx = (newWidth - newHeight) / 2\n                    newWidth = newHeight\n                }\n                let cropedCanvas = document.createElement('canvas')\n                let cropedCanvasCtx = cropedCanvas.getContext('2d')\n                cropedCanvas.width = newWidth\n                cropedCanvas.height = newHeight\n\n                cropedCanvasCtx.drawImage(resizedCanvas, sx, sy, newWidth, newHeight, dx, dy, newWidth, newHeight)\n\n                outputCanvas = cropedCanvas\n            } else {\n                outputCanvas = resizedCanvas\n            }\n            resolve(outputCanvas)\n        })\n    })\n}\n","/**\n * @param degrees{number}\n * @returns {number}\n */\nexport function degreesToRadian (degrees) {\n    return degrees * (Math.PI / 180)\n}\n","import {degreesToRadian} from '../helpers/degreesToRadian.js'\n\n/**\n * @param degrees\n * @param opts{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function rotate (degrees, opts = {}) {\n    let {padding = 0, bgColor = 'white'} = opts\n\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        let calcAngle = 0\n\n        if (degrees < 0) {\n            degrees = 360 + degrees\n        }\n\n        // get angle\n        if (degrees >= 0 && degrees <= 90) {\n            calcAngle = 90 - degrees\n        } else {\n            calcAngle = 270 - degrees\n        }\n        // to rad\n        let degreesRad = degreesToRadian(degrees)\n        let calcAngleRad = degreesToRadian(calcAngle)\n        let angleRad = degreesToRadian(degrees)\n        // calc sin cos\n        let sinCos = {\n            cosAngle: Math.cos(angleRad),\n            cosCalcAngle: Math.cos(calcAngleRad),\n            sinAngle: Math.sin(angleRad),\n            sinCalcAngle: Math.sin(calcAngleRad)\n\n        }\n        // get module of sin/cos\n        for (let key in sinCos) {\n            if (sinCos[key] < 0) {\n                sinCos[key] = sinCos[key] * -1\n            }\n        }\n        // calc w/h on rotate changes\n        canvas.width = canvasImage.width * sinCos.cosAngle + canvasImage.height * sinCos.cosCalcAngle + padding\n        canvas.height = canvasImage.width * sinCos.sinAngle + canvasImage.height * sinCos.sinCalcAngle + padding\n\n        let ctx = canvas.getContext('2d')\n        // set bg\n        if (bgColor) {\n            ctx.beginPath()\n            ctx.rect(0, 0, canvas.width, canvas.height)\n            ctx.fillStyle = bgColor\n            ctx.fill()\n            ctx.save()\n        }\n        ctx.save()\n\n        // rotate\n        ctx.translate(canvas.width / 2, canvas.height / 2)\n        ctx.rotate(degreesRad)\n        ctx.drawImage(canvasImage, -(canvasImage.width / 2), -(canvasImage.height / 2))\n        ctx.restore()\n\n        resolve(canvas)\n    })\n}\n","/**\n * @param width\n * @param height\n * @param opts{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function centerInRectangle (width, height, opts = {}) {\n    let {bgColor = 'white'} = opts\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        canvas.width = width\n        canvas.height = height\n        let ctx = canvas.getContext('2d')\n        let newWidth = canvasImage.width\n        let newHeight = canvasImage.height\n        // set bg\n        if (bgColor) {\n            ctx.beginPath()\n            ctx.rect(0, 0, width, height)\n            ctx.fillStyle = bgColor\n            ctx.fill()\n            ctx.save()\n        }\n        // put image\n        let dx = 0\n        let dy = 0\n        let sx = 0\n        let sy = 0\n        if (newWidth < width) {\n            dx = (width - newWidth) / 2\n        }\n        if (newHeight < height) {\n            dy = (height - newHeight) / 2\n        }\n        ctx.drawImage(canvasImage, sx, sy, newWidth, newHeight, dx, dy, newWidth, newHeight)\n        resolve(canvas)\n    })\n}\n","/**\n * @param diametr\n * @param opts{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function circle (diametr, opts = {}) {\n    let {padding = 4, bgColor = 'white'} = opts\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        canvas.width = diametr\n        canvas.height = diametr\n\n        let ctx = canvas.getContext('2d')\n        // set area and area bg color\n        ctx.beginPath()\n        ctx.rect(0, 0, diametr, diametr)\n        ctx.fillStyle = bgColor\n        ctx.fill()\n        ctx.save()\n        // set padding in cropped circle\n        let paddingSize = diametr - padding\n        let halfSize = Math.round(paddingSize / 2)\n        ctx.beginPath()\n        ctx.arc(halfSize + (padding / 2), halfSize + (padding / 2), halfSize - (padding / 2), 0, Math.PI * 2, true)\n        ctx.closePath()\n        ctx.clip()\n\n        ctx.drawImage(canvasImage, 0, 0, paddingSize, paddingSize)\n        ctx.restore()\n        resolve(canvas)\n    })\n}\n","/**\n * @param opts{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function grayscale (opts = {}) {\n    let {rQ = 0.34, gQ = 0.5, bQ = 0.16} = opts\n\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        canvas.width = canvasImage.width\n        canvas.height = canvasImage.height\n\n        let ctx = canvas.getContext('2d')\n        ctx.drawImage(canvasImage, 0, 0)\n\n        let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n        let data = imageData.data\n\n        for (let i = 0; i < data.length; i += 4) {\n            let brightness = rQ * data[i] + gQ * data[i + 1] + bQ * data[i + 2]\n\n            data[i] = brightness\n            data[i + 1] = brightness\n            data[i + 2] = brightness\n        }\n\n        ctx.putImageData(imageData, 0, 0)\n\n        resolve(canvas)\n    })\n}\n","/**\n * @param threshold{Number}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function pixelize (threshold) {\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        let ctx = canvas.getContext('2d')\n        canvas.width = canvasImage.width\n        canvas.height = canvasImage.height\n\n        // resize img to small\n        let smallW = canvasImage.width * threshold\n        let smallH = canvasImage.height * threshold\n        disableSmooth(ctx)\n        ctx.drawImage(canvasImage, 0, 0, smallW, smallH)\n\n        // and resize to full\n        disableSmooth(ctx)\n        ctx.drawImage(canvas, 0, 0, smallW, smallH, 0, 0, canvasImage.width, canvasImage.height)\n\n        resolve(canvas)\n    })\n}\n\nfunction disableSmooth (ctx) {\n    ctx.webkitImageSmoothingEnabled = false\n    ctx.mozImageSmoothingEnabled = false\n    ctx.msImageSmoothingEnabled = false\n    ctx.imageSmoothingEnabled = false\n}\n","function _typeof(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\n/**\n* StackBlur - a fast almost Gaussian Blur For Canvas\n*\n* In case you find this class useful - especially in commercial projects -\n* I am not totally unhappy for a small donation to my PayPal account\n* mario@quasimondo.de\n*\n* Or support me on flattr:\n* {@link https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript}\n* @module StackBlur\n* @version 0.5\n* @author Mario Klingemann\n* Contact: mario@quasimondo.com\n* Website: {@link http://www.quasimondo.com/StackBlurForCanvas/StackBlurDemo.html}\n* Twitter: @quasimondo\n*\n* @copyright (c) 2010 Mario Klingemann\n*\n* Permission is hereby granted, free of charge, to any person\n* obtaining a copy of this software and associated documentation\n* files (the \"Software\"), to deal in the Software without\n* restriction, including without limitation the rights to use,\n* copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the\n* Software is furnished to do so, subject to the following\n* conditions:\n*\n* The above copyright notice and this permission notice shall be\n* included in all copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n* OTHER DEALINGS IN THE SOFTWARE.\n*/\nvar mulTable = [512, 512, 456, 512, 328, 456, 335, 512, 405, 328, 271, 456, 388, 335, 292, 512, 454, 405, 364, 328, 298, 271, 496, 456, 420, 388, 360, 335, 312, 292, 273, 512, 482, 454, 428, 405, 383, 364, 345, 328, 312, 298, 284, 271, 259, 496, 475, 456, 437, 420, 404, 388, 374, 360, 347, 335, 323, 312, 302, 292, 282, 273, 265, 512, 497, 482, 468, 454, 441, 428, 417, 405, 394, 383, 373, 364, 354, 345, 337, 328, 320, 312, 305, 298, 291, 284, 278, 271, 265, 259, 507, 496, 485, 475, 465, 456, 446, 437, 428, 420, 412, 404, 396, 388, 381, 374, 367, 360, 354, 347, 341, 335, 329, 323, 318, 312, 307, 302, 297, 292, 287, 282, 278, 273, 269, 265, 261, 512, 505, 497, 489, 482, 475, 468, 461, 454, 447, 441, 435, 428, 422, 417, 411, 405, 399, 394, 389, 383, 378, 373, 368, 364, 359, 354, 350, 345, 341, 337, 332, 328, 324, 320, 316, 312, 309, 305, 301, 298, 294, 291, 287, 284, 281, 278, 274, 271, 268, 265, 262, 259, 257, 507, 501, 496, 491, 485, 480, 475, 470, 465, 460, 456, 451, 446, 442, 437, 433, 428, 424, 420, 416, 412, 408, 404, 400, 396, 392, 388, 385, 381, 377, 374, 370, 367, 363, 360, 357, 354, 350, 347, 344, 341, 338, 335, 332, 329, 326, 323, 320, 318, 315, 312, 310, 307, 304, 302, 299, 297, 294, 292, 289, 287, 285, 282, 280, 278, 275, 273, 271, 269, 267, 265, 263, 261, 259];\nvar shgTable = [9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24];\n/**\n * @param {string|HTMLImageElement} img\n * @param {string|HTMLCanvasElement} canvas\n * @param {Float} radius\n * @param {boolean} blurAlphaChannel\n * @returns {undefined}\n */\n\nfunction processImage(img, canvas, radius, blurAlphaChannel) {\n  if (typeof img === 'string') {\n    img = document.getElementById(img);\n  }\n\n  if (!img || !('naturalWidth' in img)) {\n    return;\n  }\n\n  var w = img.naturalWidth;\n  var h = img.naturalHeight;\n\n  if (typeof canvas === 'string') {\n    canvas = document.getElementById(canvas);\n  }\n\n  if (!canvas || !('getContext' in canvas)) {\n    return;\n  }\n\n  canvas.style.width = w + 'px';\n  canvas.style.height = h + 'px';\n  canvas.width = w;\n  canvas.height = h;\n  var context = canvas.getContext('2d');\n  context.clearRect(0, 0, w, h);\n  context.drawImage(img, 0, 0);\n\n  if (isNaN(radius) || radius < 1) {\n    return;\n  }\n\n  if (blurAlphaChannel) {\n    processCanvasRGBA(canvas, 0, 0, w, h, radius);\n  } else {\n    processCanvasRGB(canvas, 0, 0, w, h, radius);\n  }\n}\n/**\n * @param {string|HTMLCanvasElement} canvas\n * @param {Integer} topX\n * @param {Integer} topY\n * @param {Integer} width\n * @param {Integer} height\n * @throws {Error|TypeError}\n * @returns {ImageData} See {@link https://html.spec.whatwg.org/multipage/canvas.html#imagedata}\n */\n\n\nfunction getImageDataFromCanvas(canvas, topX, topY, width, height) {\n  if (typeof canvas === 'string') {\n    canvas = document.getElementById(canvas);\n  }\n\n  if (!canvas || _typeof(canvas) !== 'object' || !('getContext' in canvas)) {\n    throw new TypeError('Expecting canvas with `getContext` method in processCanvasRGB(A) calls!');\n  }\n\n  var context = canvas.getContext('2d');\n\n  try {\n    return context.getImageData(topX, topY, width, height);\n  } catch (e) {\n    throw new Error('unable to access image data: ' + e);\n  }\n}\n/**\n * @param {HTMLCanvasElement} canvas\n * @param {Integer} topX\n * @param {Integer} topY\n * @param {Integer} width\n * @param {Integer} height\n * @param {Float} radius\n * @returns {undefined}\n */\n\n\nfunction processCanvasRGBA(canvas, topX, topY, width, height, radius) {\n  if (isNaN(radius) || radius < 1) {\n    return;\n  }\n\n  radius |= 0;\n  var imageData = getImageDataFromCanvas(canvas, topX, topY, width, height);\n  imageData = processImageDataRGBA(imageData, topX, topY, width, height, radius);\n  canvas.getContext('2d').putImageData(imageData, topX, topY);\n}\n/**\n * @param {ImageData} imageData\n * @param {Integer} topX\n * @param {Integer} topY\n * @param {Integer} width\n * @param {Integer} height\n * @param {Float} radius\n * @returns {ImageData}\n */\n\n\nfunction processImageDataRGBA(imageData, topX, topY, width, height, radius) {\n  var pixels = imageData.data;\n  var x, y, i, p, yp, yi, yw, rSum, gSum, bSum, aSum, rOutSum, gOutSum, bOutSum, aOutSum, rInSum, gInSum, bInSum, aInSum, pr, pg, pb, pa, rbs;\n  var div = 2 * radius + 1; // const w4 = width << 2;\n\n  var widthMinus1 = width - 1;\n  var heightMinus1 = height - 1;\n  var radiusPlus1 = radius + 1;\n  var sumFactor = radiusPlus1 * (radiusPlus1 + 1) / 2;\n  var stackStart = new BlurStack();\n  var stack = stackStart;\n  var stackEnd;\n\n  for (i = 1; i < div; i++) {\n    stack = stack.next = new BlurStack();\n\n    if (i === radiusPlus1) {\n      stackEnd = stack;\n    }\n  }\n\n  stack.next = stackStart;\n  var stackIn = null;\n  var stackOut = null;\n  yw = yi = 0;\n  var mulSum = mulTable[radius];\n  var shgSum = shgTable[radius];\n\n  for (y = 0; y < height; y++) {\n    rInSum = gInSum = bInSum = aInSum = rSum = gSum = bSum = aSum = 0;\n    rOutSum = radiusPlus1 * (pr = pixels[yi]);\n    gOutSum = radiusPlus1 * (pg = pixels[yi + 1]);\n    bOutSum = radiusPlus1 * (pb = pixels[yi + 2]);\n    aOutSum = radiusPlus1 * (pa = pixels[yi + 3]);\n    rSum += sumFactor * pr;\n    gSum += sumFactor * pg;\n    bSum += sumFactor * pb;\n    aSum += sumFactor * pa;\n    stack = stackStart;\n\n    for (i = 0; i < radiusPlus1; i++) {\n      stack.r = pr;\n      stack.g = pg;\n      stack.b = pb;\n      stack.a = pa;\n      stack = stack.next;\n    }\n\n    for (i = 1; i < radiusPlus1; i++) {\n      p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n      rSum += (stack.r = pr = pixels[p]) * (rbs = radiusPlus1 - i);\n      gSum += (stack.g = pg = pixels[p + 1]) * rbs;\n      bSum += (stack.b = pb = pixels[p + 2]) * rbs;\n      aSum += (stack.a = pa = pixels[p + 3]) * rbs;\n      rInSum += pr;\n      gInSum += pg;\n      bInSum += pb;\n      aInSum += pa;\n      stack = stack.next;\n    }\n\n    stackIn = stackStart;\n    stackOut = stackEnd;\n\n    for (x = 0; x < width; x++) {\n      pixels[yi + 3] = pa = aSum * mulSum >> shgSum;\n\n      if (pa !== 0) {\n        pa = 255 / pa;\n        pixels[yi] = (rSum * mulSum >> shgSum) * pa;\n        pixels[yi + 1] = (gSum * mulSum >> shgSum) * pa;\n        pixels[yi + 2] = (bSum * mulSum >> shgSum) * pa;\n      } else {\n        pixels[yi] = pixels[yi + 1] = pixels[yi + 2] = 0;\n      }\n\n      rSum -= rOutSum;\n      gSum -= gOutSum;\n      bSum -= bOutSum;\n      aSum -= aOutSum;\n      rOutSum -= stackIn.r;\n      gOutSum -= stackIn.g;\n      bOutSum -= stackIn.b;\n      aOutSum -= stackIn.a;\n      p = yw + ((p = x + radius + 1) < widthMinus1 ? p : widthMinus1) << 2;\n      rInSum += stackIn.r = pixels[p];\n      gInSum += stackIn.g = pixels[p + 1];\n      bInSum += stackIn.b = pixels[p + 2];\n      aInSum += stackIn.a = pixels[p + 3];\n      rSum += rInSum;\n      gSum += gInSum;\n      bSum += bInSum;\n      aSum += aInSum;\n      stackIn = stackIn.next;\n      rOutSum += pr = stackOut.r;\n      gOutSum += pg = stackOut.g;\n      bOutSum += pb = stackOut.b;\n      aOutSum += pa = stackOut.a;\n      rInSum -= pr;\n      gInSum -= pg;\n      bInSum -= pb;\n      aInSum -= pa;\n      stackOut = stackOut.next;\n      yi += 4;\n    }\n\n    yw += width;\n  }\n\n  for (x = 0; x < width; x++) {\n    gInSum = bInSum = aInSum = rInSum = gSum = bSum = aSum = rSum = 0;\n    yi = x << 2;\n    rOutSum = radiusPlus1 * (pr = pixels[yi]);\n    gOutSum = radiusPlus1 * (pg = pixels[yi + 1]);\n    bOutSum = radiusPlus1 * (pb = pixels[yi + 2]);\n    aOutSum = radiusPlus1 * (pa = pixels[yi + 3]);\n    rSum += sumFactor * pr;\n    gSum += sumFactor * pg;\n    bSum += sumFactor * pb;\n    aSum += sumFactor * pa;\n    stack = stackStart;\n\n    for (i = 0; i < radiusPlus1; i++) {\n      stack.r = pr;\n      stack.g = pg;\n      stack.b = pb;\n      stack.a = pa;\n      stack = stack.next;\n    }\n\n    yp = width;\n\n    for (i = 1; i <= radius; i++) {\n      yi = yp + x << 2;\n      rSum += (stack.r = pr = pixels[yi]) * (rbs = radiusPlus1 - i);\n      gSum += (stack.g = pg = pixels[yi + 1]) * rbs;\n      bSum += (stack.b = pb = pixels[yi + 2]) * rbs;\n      aSum += (stack.a = pa = pixels[yi + 3]) * rbs;\n      rInSum += pr;\n      gInSum += pg;\n      bInSum += pb;\n      aInSum += pa;\n      stack = stack.next;\n\n      if (i < heightMinus1) {\n        yp += width;\n      }\n    }\n\n    yi = x;\n    stackIn = stackStart;\n    stackOut = stackEnd;\n\n    for (y = 0; y < height; y++) {\n      p = yi << 2;\n      pixels[p + 3] = pa = aSum * mulSum >> shgSum;\n\n      if (pa > 0) {\n        pa = 255 / pa;\n        pixels[p] = (rSum * mulSum >> shgSum) * pa;\n        pixels[p + 1] = (gSum * mulSum >> shgSum) * pa;\n        pixels[p + 2] = (bSum * mulSum >> shgSum) * pa;\n      } else {\n        pixels[p] = pixels[p + 1] = pixels[p + 2] = 0;\n      }\n\n      rSum -= rOutSum;\n      gSum -= gOutSum;\n      bSum -= bOutSum;\n      aSum -= aOutSum;\n      rOutSum -= stackIn.r;\n      gOutSum -= stackIn.g;\n      bOutSum -= stackIn.b;\n      aOutSum -= stackIn.a;\n      p = x + ((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width << 2;\n      rSum += rInSum += stackIn.r = pixels[p];\n      gSum += gInSum += stackIn.g = pixels[p + 1];\n      bSum += bInSum += stackIn.b = pixels[p + 2];\n      aSum += aInSum += stackIn.a = pixels[p + 3];\n      stackIn = stackIn.next;\n      rOutSum += pr = stackOut.r;\n      gOutSum += pg = stackOut.g;\n      bOutSum += pb = stackOut.b;\n      aOutSum += pa = stackOut.a;\n      rInSum -= pr;\n      gInSum -= pg;\n      bInSum -= pb;\n      aInSum -= pa;\n      stackOut = stackOut.next;\n      yi += width;\n    }\n  }\n\n  return imageData;\n}\n/**\n * @param {HTMLCanvasElement} canvas\n * @param {Integer} topX\n * @param {Integer} topY\n * @param {Integer} width\n * @param {Integer} height\n * @param {Float} radius\n * @returns {undefined}\n */\n\n\nfunction processCanvasRGB(canvas, topX, topY, width, height, radius) {\n  if (isNaN(radius) || radius < 1) {\n    return;\n  }\n\n  radius |= 0;\n  var imageData = getImageDataFromCanvas(canvas, topX, topY, width, height);\n  imageData = processImageDataRGB(imageData, topX, topY, width, height, radius);\n  canvas.getContext('2d').putImageData(imageData, topX, topY);\n}\n/**\n * @param {ImageData} imageData\n * @param {Integer} topX\n * @param {Integer} topY\n * @param {Integer} width\n * @param {Integer} height\n * @param {Float} radius\n * @returns {ImageData}\n */\n\n\nfunction processImageDataRGB(imageData, topX, topY, width, height, radius) {\n  var pixels = imageData.data;\n  var x, y, i, p, yp, yi, yw, rSum, gSum, bSum, rOutSum, gOutSum, bOutSum, rInSum, gInSum, bInSum, pr, pg, pb, rbs;\n  var div = 2 * radius + 1; // const w4 = width << 2;\n\n  var widthMinus1 = width - 1;\n  var heightMinus1 = height - 1;\n  var radiusPlus1 = radius + 1;\n  var sumFactor = radiusPlus1 * (radiusPlus1 + 1) / 2;\n  var stackStart = new BlurStack();\n  var stack = stackStart;\n  var stackEnd;\n\n  for (i = 1; i < div; i++) {\n    stack = stack.next = new BlurStack();\n\n    if (i === radiusPlus1) {\n      stackEnd = stack;\n    }\n  }\n\n  stack.next = stackStart;\n  var stackIn = null;\n  var stackOut = null;\n  yw = yi = 0;\n  var mulSum = mulTable[radius];\n  var shgSum = shgTable[radius];\n\n  for (y = 0; y < height; y++) {\n    rInSum = gInSum = bInSum = rSum = gSum = bSum = 0;\n    rOutSum = radiusPlus1 * (pr = pixels[yi]);\n    gOutSum = radiusPlus1 * (pg = pixels[yi + 1]);\n    bOutSum = radiusPlus1 * (pb = pixels[yi + 2]);\n    rSum += sumFactor * pr;\n    gSum += sumFactor * pg;\n    bSum += sumFactor * pb;\n    stack = stackStart;\n\n    for (i = 0; i < radiusPlus1; i++) {\n      stack.r = pr;\n      stack.g = pg;\n      stack.b = pb;\n      stack = stack.next;\n    }\n\n    for (i = 1; i < radiusPlus1; i++) {\n      p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n      rSum += (stack.r = pr = pixels[p]) * (rbs = radiusPlus1 - i);\n      gSum += (stack.g = pg = pixels[p + 1]) * rbs;\n      bSum += (stack.b = pb = pixels[p + 2]) * rbs;\n      rInSum += pr;\n      gInSum += pg;\n      bInSum += pb;\n      stack = stack.next;\n    }\n\n    stackIn = stackStart;\n    stackOut = stackEnd;\n\n    for (x = 0; x < width; x++) {\n      pixels[yi] = rSum * mulSum >> shgSum;\n      pixels[yi + 1] = gSum * mulSum >> shgSum;\n      pixels[yi + 2] = bSum * mulSum >> shgSum;\n      rSum -= rOutSum;\n      gSum -= gOutSum;\n      bSum -= bOutSum;\n      rOutSum -= stackIn.r;\n      gOutSum -= stackIn.g;\n      bOutSum -= stackIn.b;\n      p = yw + ((p = x + radius + 1) < widthMinus1 ? p : widthMinus1) << 2;\n      rInSum += stackIn.r = pixels[p];\n      gInSum += stackIn.g = pixels[p + 1];\n      bInSum += stackIn.b = pixels[p + 2];\n      rSum += rInSum;\n      gSum += gInSum;\n      bSum += bInSum;\n      stackIn = stackIn.next;\n      rOutSum += pr = stackOut.r;\n      gOutSum += pg = stackOut.g;\n      bOutSum += pb = stackOut.b;\n      rInSum -= pr;\n      gInSum -= pg;\n      bInSum -= pb;\n      stackOut = stackOut.next;\n      yi += 4;\n    }\n\n    yw += width;\n  }\n\n  for (x = 0; x < width; x++) {\n    gInSum = bInSum = rInSum = gSum = bSum = rSum = 0;\n    yi = x << 2;\n    rOutSum = radiusPlus1 * (pr = pixels[yi]);\n    gOutSum = radiusPlus1 * (pg = pixels[yi + 1]);\n    bOutSum = radiusPlus1 * (pb = pixels[yi + 2]);\n    rSum += sumFactor * pr;\n    gSum += sumFactor * pg;\n    bSum += sumFactor * pb;\n    stack = stackStart;\n\n    for (i = 0; i < radiusPlus1; i++) {\n      stack.r = pr;\n      stack.g = pg;\n      stack.b = pb;\n      stack = stack.next;\n    }\n\n    yp = width;\n\n    for (i = 1; i <= radius; i++) {\n      yi = yp + x << 2;\n      rSum += (stack.r = pr = pixels[yi]) * (rbs = radiusPlus1 - i);\n      gSum += (stack.g = pg = pixels[yi + 1]) * rbs;\n      bSum += (stack.b = pb = pixels[yi + 2]) * rbs;\n      rInSum += pr;\n      gInSum += pg;\n      bInSum += pb;\n      stack = stack.next;\n\n      if (i < heightMinus1) {\n        yp += width;\n      }\n    }\n\n    yi = x;\n    stackIn = stackStart;\n    stackOut = stackEnd;\n\n    for (y = 0; y < height; y++) {\n      p = yi << 2;\n      pixels[p] = rSum * mulSum >> shgSum;\n      pixels[p + 1] = gSum * mulSum >> shgSum;\n      pixels[p + 2] = bSum * mulSum >> shgSum;\n      rSum -= rOutSum;\n      gSum -= gOutSum;\n      bSum -= bOutSum;\n      rOutSum -= stackIn.r;\n      gOutSum -= stackIn.g;\n      bOutSum -= stackIn.b;\n      p = x + ((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width << 2;\n      rSum += rInSum += stackIn.r = pixels[p];\n      gSum += gInSum += stackIn.g = pixels[p + 1];\n      bSum += bInSum += stackIn.b = pixels[p + 2];\n      stackIn = stackIn.next;\n      rOutSum += pr = stackOut.r;\n      gOutSum += pg = stackOut.g;\n      bOutSum += pb = stackOut.b;\n      rInSum -= pr;\n      gInSum -= pg;\n      bInSum -= pb;\n      stackOut = stackOut.next;\n      yi += width;\n    }\n  }\n\n  return imageData;\n}\n/**\n *\n */\n\n\nvar BlurStack = function BlurStack() {\n  _classCallCheck(this, BlurStack);\n\n  this.r = 0;\n  this.g = 0;\n  this.b = 0;\n  this.a = 0;\n  this.next = null;\n};\n\nexport { BlurStack, processImage as image, processCanvasRGBA as canvasRGBA, processCanvasRGB as canvasRGB, processImageDataRGBA as imageDataRGBA, processImageDataRGB as imageDataRGB };\n","import * as StackBlur from 'stackblur-canvas'\n/**\n * @param radius{Number}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function gaussianBlur (radius) {\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        canvas.width = canvasImage.width\n        canvas.height = canvasImage.height\n\n        let ctx = canvas.getContext('2d')\n        ctx.drawImage(canvasImage, 0, 0)\n\n        StackBlur.canvasRGBA(canvas, 0, 0, canvasImage.width, canvasImage.height, radius)\n\n        resolve(canvas)\n    })\n}\n","/**\n * @param fileName{string}\n * @param mimeType{string}\n * @returns {string}\n */\nexport function fileExtByMimeType (fileName, mimeType) {\n    let tmp = fileName.split('.')\n    let ext = 'jpg'\n    if (mimeType.indexOf('png') > -1) {\n        ext = 'png'\n    } else if (mimeType.indexOf('webp') > -1) {\n        ext = 'webp'\n    }\n    tmp.pop()\n    tmp.push(ext)\n    return tmp.join('.')\n}\n","import {fileExtByMimeType} from '../helpers/fileExtByMimeType'\n\n/**\n * @param canvas{HTMLCanvasElement}\n * @param fileName\n * @param mimeType\n * @param q\n * @returns {Promise<File>}\n */\nexport function asBlob (canvas, fileName, mimeType, q) {\n    return new Promise((resolve, reject) => {\n        canvas.toBlob((blob) => {\n            // edge doesnt suppot new File, create Blob and set file.name\n            let fileOfBlob = new Blob([blob], {type: mimeType})\n            fileOfBlob.name = fileExtByMimeType(fileName, mimeType)\n            resolve(fileOfBlob)\n        }, mimeType, q)\n    })\n}\n","/**\n * @param canvas{HTMLCanvasElement}\n * @returns {Promise<HTMLCanvasElement>}\n */\nexport function asCanvas (canvas) {\n    return Promise.resolve(canvas)\n}\n","/**\n * @param canvas{HTMLCanvasElement}\n * @param mimeType\n * @param q\n * @returns {Promise<HTMLImageElement.src>}\n */\nexport function asImage (canvas, mimeType, q) {\n    return new Promise((resolve, reject) => {\n        let image = canvas.toDataURL(mimeType, q)\n        resolve(image)\n    })\n}\n","/**\n * Get [[x0, y0], [x1, y1] ...] or [x0, y0, x1, y1 ...]\n * and convert to [[x0, y0], [x1, y1] ...]\n * @param points\n * @returns {Array}\n */\nexport function pointsTo2DArray (points = []) {\n    if (points.length < 1) {\n        throw new Error('We need points')\n    }\n\n    const out = []\n    for (let i = 0; i < points.length; i++) {\n        if (Array.isArray(points[i])) {\n            out.push(points[i])\n        } else {\n            const lastIndex = out.length - 1\n            if (lastIndex === -1) {\n                out.push([points[i]])\n            } else if (out[lastIndex] && out[lastIndex].length === 2) {\n                out.push([points[i]])\n            } else {\n                out[lastIndex].push(points[i])\n            }\n        }\n    }\n\n    return out\n}\n","import {pointsTo2DArray} from '../helpers/pointsTo2DArray'\n\n/**\n * Inspired by https://pillow.readthedocs.io/en/3.1.x/reference/ImageDraw.html#PIL.ImageDraw.PIL.ImageDraw.Draw.line\n * @param points\n * @param fill\n * @param width\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function drawLine (points, fill, width) {\n    return (canvasImage) => new Promise((resolve, reject) => {\n        const points2d = pointsTo2DArray(points)\n        const ctx = canvasImage.getContext('2d')\n        ctx.save()\n\n        const [x, y] = points2d[0]\n        ctx.moveTo(x, y)\n\n        for (let i = 1; i < points2d.length; i++) {\n            const [x, y] = points2d[i]\n            ctx.lineTo(x, y)\n        }\n\n        ctx.strokeStyle = fill\n        ctx.lineWidth = width\n        ctx.stroke()\n\n        ctx.restore()\n        resolve(canvasImage)\n    })\n}\n\n/**\n * Inspired by https://pillow.readthedocs.io/en/3.1.x/reference/ImageDraw.html#PIL.ImageDraw.PIL.ImageDraw.Draw.polygon\n * @param points\n * @param fill\n * @param outline\n * @param outlineWidth\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function drawPolygon (points, fill, outline, outlineWidth) {\n    return (canvasImage) => new Promise((resolve, reject) => {\n        const points2d = pointsTo2DArray(points)\n        const ctx = canvasImage.getContext('2d')\n        ctx.save()\n\n        ctx.beginPath()\n\n        const [x, y] = points2d[0]\n        ctx.moveTo(x, y)\n\n        for (let i = 1; i < points2d.length; i++) {\n            const [x, y] = points2d[i]\n            ctx.lineTo(x, y)\n        }\n\n        ctx.closePath()\n\n        ctx.fillStyle = fill\n        ctx.fill()\n\n        ctx.strokeStyle = outline\n        ctx.lineWidth = outlineWidth\n        ctx.stroke()\n\n        ctx.restore()\n        resolve(canvasImage)\n    })\n}\n\n/**\n * Inspired by https://pillow.readthedocs.io/en/3.1.x/reference/ImageDraw.html#PIL.ImageDraw.PIL.ImageDraw.Draw.rectangle\n * @param points [[left, bottom], [right, top]] or [left, bottom, right, top]\n * @param fill\n * @param outline\n * @param outlineWidth\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport function drawRectangle (points, fill, outline, outlineWidth) {\n    return (canvasImage) => new Promise((resolve, reject) => {\n        const points2d = pointsTo2DArray(points)\n\n        if (points2d.length < 2) {\n            throw new Error('Need points sequence of [[left, bottom], [right, top]] or [left, bottom, right, top]')\n        }\n\n        const [left, bottom] = points2d[0]\n        const [right, top] = points2d[1]\n\n        const ctx = canvasImage.getContext('2d')\n        ctx.save()\n\n        if (fill) {\n            ctx.beginPath()\n        }\n\n        ctx.moveTo(left, bottom)\n        ctx.lineTo(left, top)\n        ctx.lineTo(right, top)\n        ctx.lineTo(right, bottom)\n        ctx.lineTo(left, bottom)\n\n        if (fill) {\n            ctx.closePath()\n            ctx.fillStyle = fill\n            ctx.fill()\n        }\n\n        if (outline) {\n            ctx.strokeStyle = outline\n            ctx.lineWidth = outlineWidth\n            ctx.stroke()\n        }\n\n        ctx.restore()\n        resolve(canvasImage)\n    })\n}\n\n/**\n * @returns {function(*=): Promise<any>}\n */\nexport function drawText (xy, text, {\n    font = 'helvetica',\n    fontSize = null,\n    fill = null,\n    fillPadding = null,\n    rotateAngle = null\n} = {}) {\n    return (canvasImage) => new Promise(async (resolve, reject) => {\n        let fontSizeInPx = 0\n        let fillPaddingInPx = 0\n\n        const canvasMaskImage = document.createElement('canvas')\n        canvasMaskImage.width = canvasImage.width\n        canvasMaskImage.height = canvasImage.height\n\n        const ctx = canvasMaskImage.getContext('2d')\n        // append transforms\n        // rotate\n        if (rotateAngle) {\n            const radians = rotateAngle * Math.PI / 180\n            ctx.rotate(radians)\n        }\n\n        // calc font size\n        if (fontSize) {\n            if (fontSize.indexOf('%') > -1) {\n                fontSizeInPx = Math.floor(canvasMaskImage.height * (parseFloat(fontSize) / 100))\n            } else {\n                fontSizeInPx = parseFloat(fontSize)\n            }\n\n            font = `${fontSizeInPx}px ${font}`.trim()\n        }\n\n        // calc padding\n        if (fillPadding) {\n            if (fillPadding.indexOf('%') > -1) {\n                fillPaddingInPx = Math.floor(canvasMaskImage.height * (parseFloat(fillPadding) / 100))\n            } else {\n                fillPaddingInPx = parseFloat(fillPadding)\n            }\n        }\n\n        // draw poly\n        if (fill) {\n            ctx.save()\n\n            if (font) ctx.font = font\n\n            const [x, y] = xy\n\n            let height = parseInt(ctx.font)\n            const metrics = ctx.measureText(text)\n            const width = metrics.width\n            if ('actualBoundingBoxAscent' in metrics) {\n                height = metrics.actualBoundingBoxAscent - metrics.actualBoundingBoxDescent\n            }\n\n            ctx.restore()\n\n            await drawRectangle([\n                x - fillPaddingInPx,\n                y + fillPaddingInPx,\n                x + width + fillPaddingInPx,\n                y - height - fillPaddingInPx\n            ], fill, null)(canvasMaskImage)\n        }\n\n        // draw text\n        ctx.save()\n\n        if (font) ctx.font = font\n\n        const [x, y] = xy\n        ctx.fillText(text, x, y)\n\n        ctx.restore()\n\n        // merge images\n        const ctxImage = canvasImage.getContext('2d')\n        ctxImage.drawImage(canvasMaskImage, 0, 0)\n\n        resolve(canvasImage)\n    })\n}\n","// Based on https://github.com/wanadev/perspective.js/blob/b332d6167b2ea9b0921c14f8716539e374496199/src/perspective.js by futomi  http://www.html5.jp/ and  Fabien LOISON <http://www.flozz.fr/>\n\n/**\n * @param warpPoints\n * @returns {function(*=): Promise<any>}\n */\nexport function perspective (warpPoints = {}) {\n    return (canvasImage) => new Promise((resolve, reject) => {\n        const ctxDestination = canvasImage.getContext('2d')\n        const {width, height} = canvasImage\n\n        const {\n            xy0 = ['0%', '0%'],\n            xy1 = ['100%', '0%'],\n            xy2 = ['100%', '100%'],\n            xy3 = ['0%', '100%']\n        } = warpPoints\n\n        const points = convertRelativePointsToAbsolute([xy0, xy1, xy2, xy3], width, height)\n\n        const ctxOut = createCanvasContext(width, height)\n        ctxOut.drawImage(canvasImage, 0, 0, width, height)\n\n        // prepare a <canvas> for the transformed image\n        const ctxTransformed = createCanvasContext(width, height)\n\n        // specify the index of which dimension is longest\n        const baseIndex = getBaseIndex(points, width, height)\n\n        const step = 2\n        const coverStep = step * 5\n\n        ctxTransformed.clearRect(0, 0, ctxTransformed.canvas.width, ctxTransformed.canvas.height)\n        if (baseIndex % 2 === 0) { // top or bottom side\n            transformSide(points, {\n                ctxTransformed,\n                sideSize: height,\n                otherSizeSize: width,\n                ctxOut,\n                coverStep,\n                step\n            })\n        } else if (baseIndex % 2 === 1) { // right or left side\n            transformSide(points, {\n                ctxTransformed,\n                sideSize: width,\n                otherSizeSize: height,\n                ctxOut,\n                coverStep,\n                step\n            })\n        }\n        // set a clipping path and draw the transformed image on the destination canvas.\n        ctxDestination.save()\n        ctxDestination.drawImage(ctxTransformed.canvas, 0, 0)\n        applyMask(ctxDestination, points)\n        ctxDestination.restore()\n\n        resolve(ctxDestination.canvas)\n    })\n}\n\nfunction convertRelativePointsToAbsolute (points = [], width, height) {\n    const out = []\n    for (let i = 0; i < points.length; i++) {\n        out[i] = [\n            convertRelativePointValue(points[i][0], width),\n            convertRelativePointValue(points[i][1], height)\n        ]\n    }\n    return out\n}\n\nfunction convertRelativePointValue (point, sizeSize) {\n    let absPointVal = 0\n    if (point.toString().indexOf('%') > -1) {\n        absPointVal = Math.floor(sizeSize * (parseFloat(point) / 100))\n    } else {\n        absPointVal = point\n    }\n\n    return absPointVal\n}\n\nfunction createCanvasContext (w, h) {\n    let canvas = document.createElement('canvas')\n    canvas.width = w\n    canvas.height = h\n    return canvas.getContext('2d')\n}\n\nfunction getBaseIndex (points, width, height) {\n    const [[d0x, d0y], [d1x, d1y], [d2x, d2y], [d3x, d3y]] = points\n\n    // compute the dimension of each side\n    const dims = [\n        Math.sqrt(Math.pow(d0x - d1x, 2) + Math.pow(d0y - d1y, 2)), // top side\n        Math.sqrt(Math.pow(d1x - d2x, 2) + Math.pow(d1y - d2y, 2)), // right side\n        Math.sqrt(Math.pow(d2x - d3x, 2) + Math.pow(d2y - d3y, 2)), // bottom side\n        Math.sqrt(Math.pow(d3x - d0x, 2) + Math.pow(d3y - d0y, 2)) // left side\n    ]\n\n    // specify the index of which dimension is longest\n    let baseIndex = 0\n    let maxScaleRate = 0\n    let zeroNum = 0\n    for (let i = 0; i < 4; i++) {\n        let rate = 0\n        if (i % 2) {\n            rate = dims[i] / width\n        } else {\n            rate = dims[i] / height\n        }\n        if (rate > maxScaleRate) {\n            baseIndex = i\n            maxScaleRate = rate\n        }\n        if (dims[i] === 0) {\n            zeroNum++\n        }\n    }\n    if (zeroNum > 1) {\n        return 0\n    }\n\n    return baseIndex\n}\n\nfunction transformSide (points, {ctxTransformed, sideSize, otherSizeSize, ctxOut, coverStep, step}) {\n    const [[d0x, d0y], [d1x, d1y], [d2x, d2y], [d3x, d3y]] = points\n\n    const ctxWide = createCanvasContext(otherSizeSize, coverStep)\n    ctxWide.globalCompositeOperation = 'copy'\n\n    for (let y = 0; y < sideSize; y += step) {\n        let r = y / sideSize\n        let sx = d0x + (d3x - d0x) * r\n        let sy = d0y + (d3y - d0y) * r\n        let ex = d1x + (d2x - d1x) * r\n        let ey = d1y + (d2y - d1y) * r\n        let ag = Math.atan((ey - sy) / (ex - sx))\n        let sc = Math.sqrt(Math.pow(ex - sx, 2) + Math.pow(ey - sy, 2)) / otherSizeSize\n        ctxWide.setTransform(1, 0, 0, 1, 0, -y)\n        ctxWide.drawImage(ctxOut.canvas, 0, 0)\n\n        ctxTransformed.translate(sx, sy)\n        ctxTransformed.rotate(ag)\n        ctxTransformed.scale(sc, sc)\n        ctxTransformed.drawImage(ctxWide.canvas, 0, 0)\n\n        ctxTransformed.setTransform(1, 0, 0, 1, 0, 0)\n    }\n}\n\nfunction applyMask (ctx, points) {\n    ctx.beginPath()\n    ctx.moveTo(points[0][0], points[0][1])\n    for (let i = 1; i < points.length; i++) {\n        ctx.lineTo(points[i][0], points[i][1])\n    }\n    ctx.closePath()\n    ctx.globalCompositeOperation = 'destination-in'\n    ctx.fill()\n    ctx.globalCompositeOperation = 'source-over'\n}\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  runtime.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  runtime.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        if (delegate.iterator.return) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // In sloppy mode, unbound `this` refers to the global object, fallback to\n  // Function constructor if we're in global strict mode. That is sadly a form\n  // of indirect eval which violates Content Security Policy.\n  (function() { return this })() || Function(\"return this\")()\n);\n","/* pica 4.1.1 nodeca/pica */(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.pica = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n// Collection of math functions\n//\n// 1. Combine components together\n// 2. Has async init to load wasm modules\n//\n'use strict';\n\nvar inherits = require('inherits');\nvar Multimath = require('multimath');\n\nvar mm_unsharp_mask = require('multimath/lib/unsharp_mask');\nvar mm_resize = require('./mm_resize');\n\nfunction MathLib(requested_features) {\n  var __requested_features = requested_features || [];\n\n  var features = {\n    js: __requested_features.indexOf('js') >= 0,\n    wasm: __requested_features.indexOf('wasm') >= 0\n  };\n\n  Multimath.call(this, features);\n\n  this.features = {\n    js: features.js,\n    wasm: features.wasm && this.has_wasm\n  };\n\n  this.use(mm_unsharp_mask);\n  this.use(mm_resize);\n}\n\ninherits(MathLib, Multimath);\n\nMathLib.prototype.resizeAndUnsharp = function resizeAndUnsharp(options, cache) {\n  var result = this.resize(options, cache);\n\n  if (options.unsharpAmount) {\n    this.unsharp_mask(result, options.toWidth, options.toHeight, options.unsharpAmount, options.unsharpRadius, options.unsharpThreshold);\n  }\n\n  return result;\n};\n\nmodule.exports = MathLib;\n\n},{\"./mm_resize\":4,\"inherits\":15,\"multimath\":16,\"multimath/lib/unsharp_mask\":19}],2:[function(require,module,exports){\n// Resize convolvers, pure JS implementation\n//\n'use strict';\n\n// Precision of fixed FP values\n//var FIXED_FRAC_BITS = 14;\n\n\nfunction clampTo8(i) {\n  return i < 0 ? 0 : i > 255 ? 255 : i;\n}\n\n// Convolve image in horizontal directions and transpose output. In theory,\n// transpose allow:\n//\n// - use the same convolver for both passes (this fails due different\n//   types of input array and temporary buffer)\n// - making vertical pass by horisonltal lines inprove CPU cache use.\n//\n// But in real life this doesn't work :)\n//\nfunction convolveHorizontally(src, dest, srcW, srcH, destW, filters) {\n\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0;\n\n  // For each row\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0;\n\n    // Apply precomputed filters to each destination row point\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n\n      srcPtr = srcOffset + filterShift * 4 | 0;\n\n      r = g = b = a = 0;\n\n      // Apply the filter to the row to get the destination pixel r, g, b, a\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++];\n\n        // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      }\n\n      // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n}\n\n// Technically, convolvers are the same. But input array and temporary\n// buffer can be of different type (especially, in old browsers). So,\n// keep code in separate functions to avoid deoptimizations & speed loss.\n\nfunction convolveVertically(src, dest, srcW, srcH, destW, filters) {\n\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0;\n\n  // For each row\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0;\n\n    // Apply precomputed filters to each destination row point\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n\n      srcPtr = srcOffset + filterShift * 4 | 0;\n\n      r = g = b = a = 0;\n\n      // Apply the filter to the row to get the destination pixel r, g, b, a\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++];\n\n        // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      }\n\n      // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n}\n\nmodule.exports = {\n  convolveHorizontally: convolveHorizontally,\n  convolveVertically: convolveVertically\n};\n\n},{}],3:[function(require,module,exports){\n// This is autogenerated file from math.wasm, don't edit.\n//\n'use strict';\n\n/* eslint-disable max-len */\n\nmodule.exports = 'AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw==';\n\n},{}],4:[function(require,module,exports){\n'use strict';\n\nmodule.exports = {\n  name: 'resize',\n  fn: require('./resize'),\n  wasm_fn: require('./resize_wasm'),\n  wasm_src: require('./convolve_wasm_base64')\n};\n\n},{\"./convolve_wasm_base64\":3,\"./resize\":5,\"./resize_wasm\":8}],5:[function(require,module,exports){\n'use strict';\n\nvar createFilters = require('./resize_filter_gen');\nvar convolveHorizontally = require('./convolve').convolveHorizontally;\nvar convolveVertically = require('./convolve').convolveVertically;\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n  while (ptr < len) {\n    dst[ptr] = 0xFF;ptr = ptr + 4 | 0;\n  }\n}\n\nmodule.exports = function resize(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0;\n  var offsetY = options.offsetY || 0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY);\n\n  var tmp = new Uint8Array(destW * srcH * 4);\n\n  // To use single function we need src & tmp of the same type.\n  // But src can be CanvasPixelArray, and tmp - Uint8Array. So, keep\n  // vertical and horizontal passes separately to avoid deoptimization.\n\n  convolveHorizontally(src, tmp, srcW, srcH, destW, filtersX);\n  convolveVertically(tmp, dest, srcH, destW, destH, filtersY);\n\n  // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n\n  return dest;\n};\n\n},{\"./convolve\":2,\"./resize_filter_gen\":6}],6:[function(require,module,exports){\n// Calculate convolution filters for each destination point,\n// and pack data to Int16Array:\n//\n// [ shift, length, data..., shift2, length2, data..., ... ]\n//\n// - shift - offset in src image\n// - length - filter length (in src points)\n// - data - filter values sequence\n//\n'use strict';\n\nvar FILTER_INFO = require('./resize_filter_info');\n\n// Precision of fixed FP values\nvar FIXED_FRAC_BITS = 14;\n\nfunction toFixedPoint(num) {\n  return Math.round(num * ((1 << FIXED_FRAC_BITS) - 1));\n}\n\nmodule.exports = function resizeFilterGen(quality, srcSize, destSize, scale, offset) {\n\n  var filterFunction = FILTER_INFO[quality].filter;\n\n  var scaleInverted = 1.0 / scale;\n  var scaleClamped = Math.min(1.0, scale); // For upscale\n\n  // Filter window (averaging interval), scaled to src image\n  var srcWindow = FILTER_INFO[quality].win / scaleClamped;\n\n  var destPixel, srcPixel, srcFirst, srcLast, filterElementSize, floatFilter, fxpFilter, total, pxl, idx, floatVal, filterTotal, filterVal;\n  var leftNotEmpty, rightNotEmpty, filterShift, filterSize;\n\n  var maxFilterElementSize = Math.floor((srcWindow + 1) * 2);\n  var packedFilter = new Int16Array((maxFilterElementSize + 2) * destSize);\n  var packedFilterPtr = 0;\n\n  var slowCopy = !packedFilter.subarray || !packedFilter.set;\n\n  // For each destination pixel calculate source range and built filter values\n  for (destPixel = 0; destPixel < destSize; destPixel++) {\n\n    // Scaling should be done relative to central pixel point\n    srcPixel = (destPixel + 0.5) * scaleInverted + offset;\n\n    srcFirst = Math.max(0, Math.floor(srcPixel - srcWindow));\n    srcLast = Math.min(srcSize - 1, Math.ceil(srcPixel + srcWindow));\n\n    filterElementSize = srcLast - srcFirst + 1;\n    floatFilter = new Float32Array(filterElementSize);\n    fxpFilter = new Int16Array(filterElementSize);\n\n    total = 0.0;\n\n    // Fill filter values for calculated range\n    for (pxl = srcFirst, idx = 0; pxl <= srcLast; pxl++, idx++) {\n      floatVal = filterFunction((pxl + 0.5 - srcPixel) * scaleClamped);\n      total += floatVal;\n      floatFilter[idx] = floatVal;\n    }\n\n    // Normalize filter, convert to fixed point and accumulate conversion error\n    filterTotal = 0;\n\n    for (idx = 0; idx < floatFilter.length; idx++) {\n      filterVal = floatFilter[idx] / total;\n      filterTotal += filterVal;\n      fxpFilter[idx] = toFixedPoint(filterVal);\n    }\n\n    // Compensate normalization error, to minimize brightness drift\n    fxpFilter[destSize >> 1] += toFixedPoint(1.0 - filterTotal);\n\n    //\n    // Now pack filter to useable form\n    //\n    // 1. Trim heading and tailing zero values, and compensate shitf/length\n    // 2. Put all to single array in this format:\n    //\n    //    [ pos shift, data length, value1, value2, value3, ... ]\n    //\n\n    leftNotEmpty = 0;\n    while (leftNotEmpty < fxpFilter.length && fxpFilter[leftNotEmpty] === 0) {\n      leftNotEmpty++;\n    }\n\n    if (leftNotEmpty < fxpFilter.length) {\n      rightNotEmpty = fxpFilter.length - 1;\n      while (rightNotEmpty > 0 && fxpFilter[rightNotEmpty] === 0) {\n        rightNotEmpty--;\n      }\n\n      filterShift = srcFirst + leftNotEmpty;\n      filterSize = rightNotEmpty - leftNotEmpty + 1;\n\n      packedFilter[packedFilterPtr++] = filterShift; // shift\n      packedFilter[packedFilterPtr++] = filterSize; // size\n\n      if (!slowCopy) {\n        packedFilter.set(fxpFilter.subarray(leftNotEmpty, rightNotEmpty + 1), packedFilterPtr);\n        packedFilterPtr += filterSize;\n      } else {\n        // fallback for old IE < 11, without subarray/set methods\n        for (idx = leftNotEmpty; idx <= rightNotEmpty; idx++) {\n          packedFilter[packedFilterPtr++] = fxpFilter[idx];\n        }\n      }\n    } else {\n      // zero data, write header only\n      packedFilter[packedFilterPtr++] = 0; // shift\n      packedFilter[packedFilterPtr++] = 0; // size\n    }\n  }\n  return packedFilter;\n};\n\n},{\"./resize_filter_info\":7}],7:[function(require,module,exports){\n// Filter definitions to build tables for\n// resizing convolvers.\n//\n// Presets for quality 0..3. Filter functions + window size\n//\n'use strict';\n\nmodule.exports = [{ // Nearest neibor (Box)\n  win: 0.5,\n  filter: function filter(x) {\n    return x >= -0.5 && x < 0.5 ? 1.0 : 0.0;\n  }\n}, { // Hamming\n  win: 1.0,\n  filter: function filter(x) {\n    if (x <= -1.0 || x >= 1.0) {\n      return 0.0;\n    }\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * (0.54 + 0.46 * Math.cos(xpi / 1.0));\n  }\n}, { // Lanczos, win = 2\n  win: 2.0,\n  filter: function filter(x) {\n    if (x <= -2.0 || x >= 2.0) {\n      return 0.0;\n    }\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 2.0) / (xpi / 2.0);\n  }\n}, { // Lanczos, win = 3\n  win: 3.0,\n  filter: function filter(x) {\n    if (x <= -3.0 || x >= 3.0) {\n      return 0.0;\n    }\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 3.0) / (xpi / 3.0);\n  }\n}];\n\n},{}],8:[function(require,module,exports){\n'use strict';\n\nvar createFilters = require('./resize_filter_gen');\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n  while (ptr < len) {\n    dst[ptr] = 0xFF;ptr = ptr + 4 | 0;\n  }\n}\n\nfunction asUint8Array(src) {\n  return new Uint8Array(src.buffer, 0, src.byteLength);\n}\n\nvar IS_LE = true;\n// should not crash everything on module load in old browsers\ntry {\n  IS_LE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n} catch (__) {}\n\nfunction copyInt16asLE(src, target, target_offset) {\n  if (IS_LE) {\n    target.set(asUint8Array(src), target_offset);\n    return;\n  }\n\n  for (var ptr = target_offset, i = 0; i < src.length; i++) {\n    var data = src[i];\n    target[ptr++] = data & 0xFF;\n    target[ptr++] = data >> 8 & 0xFF;\n  }\n}\n\nmodule.exports = function resize_wasm(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0.0;\n  var offsetY = options.offsetY || 0.0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY);\n\n  // destination is 0 too.\n  var src_offset = 0;\n  // buffer between convolve passes\n  var tmp_offset = this.__align(src_offset + Math.max(src.byteLength, dest.byteLength));\n  var filtersX_offset = this.__align(tmp_offset + srcH * destW * 4);\n  var filtersY_offset = this.__align(filtersX_offset + filtersX.byteLength);\n  var alloc_bytes = filtersY_offset + filtersY.byteLength;\n\n  var instance = this.__instance('resize', alloc_bytes);\n\n  //\n  // Fill memory block with data to process\n  //\n\n  var mem = new Uint8Array(this.__memory.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer);\n\n  // 32-bit copy is much faster in chrome\n  var src32 = new Uint32Array(src.buffer);\n  mem32.set(src32);\n\n  // We should guarantee LE bytes order. Filters are not big, so\n  // speed difference is not significant vs direct .set()\n  copyInt16asLE(filtersX, mem, filtersX_offset);\n  copyInt16asLE(filtersY, mem, filtersY_offset);\n\n  //\n  // Now call webassembly method\n  // emsdk does method names with '_'\n  var fn = instance.exports.convolveHV || instance.exports._convolveHV;\n\n  fn(filtersX_offset, filtersY_offset, tmp_offset, srcW, srcH, destW, destH);\n\n  //\n  // Copy data back to typed array\n  //\n\n  // 32-bit copy is much faster in chrome\n  var dest32 = new Uint32Array(dest.buffer);\n  dest32.set(new Uint32Array(this.__memory.buffer, 0, destH * destW));\n\n  // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n\n  return dest;\n};\n\n},{\"./resize_filter_gen\":6}],9:[function(require,module,exports){\n'use strict';\n\nvar GC_INTERVAL = 100;\n\nfunction Pool(create, idle) {\n  this.create = create;\n\n  this.available = [];\n  this.acquired = {};\n  this.lastId = 1;\n\n  this.timeoutId = 0;\n  this.idle = idle || 2000;\n}\n\nPool.prototype.acquire = function () {\n  var _this = this;\n\n  var resource = void 0;\n\n  if (this.available.length !== 0) {\n    resource = this.available.pop();\n  } else {\n    resource = this.create();\n    resource.id = this.lastId++;\n    resource.release = function () {\n      return _this.release(resource);\n    };\n  }\n  this.acquired[resource.id] = resource;\n  return resource;\n};\n\nPool.prototype.release = function (resource) {\n  var _this2 = this;\n\n  delete this.acquired[resource.id];\n\n  resource.lastUsed = Date.now();\n  this.available.push(resource);\n\n  if (this.timeoutId === 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this2.gc();\n    }, GC_INTERVAL);\n  }\n};\n\nPool.prototype.gc = function () {\n  var _this3 = this;\n\n  var now = Date.now();\n\n  this.available = this.available.filter(function (resource) {\n    if (now - resource.lastUsed > _this3.idle) {\n      resource.destroy();\n      return false;\n    }\n    return true;\n  });\n\n  if (this.available.length !== 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this3.gc();\n    }, GC_INTERVAL);\n  } else {\n    this.timeoutId = 0;\n  }\n};\n\nmodule.exports = Pool;\n\n},{}],10:[function(require,module,exports){\n// Add intermediate resizing steps when scaling down by a very large factor.\n//\n// For example, when resizing 10000x10000 down to 10x10, it'll resize it to\n// 300x300 first.\n//\n// It's needed because tiler has issues when the entire tile is scaled down\n// to a few pixels (1024px source tile with border size 3 should result in\n// at least 3+3+2 = 8px target tile, so max scale factor is 128 here).\n//\n// Also, adding intermediate steps can speed up processing if we use lower\n// quality algorithms for first stages.\n//\n\n'use strict';\n\n// min size = 0 results in infinite loop,\n// min size = 1 can consume large amount of memory\n\nvar MIN_INNER_TILE_SIZE = 2;\n\nmodule.exports = function createStages(fromWidth, fromHeight, toWidth, toHeight, srcTileSize, destTileBorder) {\n  var scaleX = toWidth / fromWidth;\n  var scaleY = toHeight / fromHeight;\n\n  // derived from createRegions equation:\n  // innerTileWidth = pixelFloor(srcTileSize * scaleX) - 2 * destTileBorder;\n  var minScale = (2 * destTileBorder + MIN_INNER_TILE_SIZE + 1) / srcTileSize;\n\n  // refuse to scale image multiple times by less than twice each time,\n  // it could only happen because of invalid options\n  if (minScale > 0.5) return [[toWidth, toHeight]];\n\n  var stageCount = Math.ceil(Math.log(Math.min(scaleX, scaleY)) / Math.log(minScale));\n\n  // no additional resizes are necessary,\n  // stageCount can be zero or be negative when enlarging the image\n  if (stageCount <= 1) return [[toWidth, toHeight]];\n\n  var result = [];\n\n  for (var i = 0; i < stageCount; i++) {\n    var width = Math.round(Math.pow(Math.pow(fromWidth, stageCount - i - 1) * Math.pow(toWidth, i + 1), 1 / stageCount));\n\n    var height = Math.round(Math.pow(Math.pow(fromHeight, stageCount - i - 1) * Math.pow(toHeight, i + 1), 1 / stageCount));\n\n    result.push([width, height]);\n  }\n\n  return result;\n};\n\n},{}],11:[function(require,module,exports){\n// Split original image into multiple 1024x1024 chunks to reduce memory usage\n// (images have to be unpacked into typed arrays for resizing) and allow\n// parallel processing of multiple tiles at a time.\n//\n\n'use strict';\n\n/*\n * pixelFloor and pixelCeil are modified versions of Math.floor and Math.ceil\n * functions which take into account floating point arithmetic errors.\n * Those errors can cause undesired increments/decrements of sizes and offsets:\n * Math.ceil(36 / (36 / 500)) = 501\n * pixelCeil(36 / (36 / 500)) = 500\n */\n\nvar PIXEL_EPSILON = 1e-5;\n\nfunction pixelFloor(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n  return Math.floor(x);\n}\n\nfunction pixelCeil(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n  return Math.ceil(x);\n}\n\nmodule.exports = function createRegions(options) {\n  var scaleX = options.toWidth / options.width;\n  var scaleY = options.toHeight / options.height;\n\n  var innerTileWidth = pixelFloor(options.srcTileSize * scaleX) - 2 * options.destTileBorder;\n  var innerTileHeight = pixelFloor(options.srcTileSize * scaleY) - 2 * options.destTileBorder;\n\n  // prevent infinite loop, this should never happen\n  if (innerTileWidth < 1 || innerTileHeight < 1) {\n    throw new Error('Internal error in pica: target tile width/height is too small.');\n  }\n\n  var x, y;\n  var innerX, innerY, toTileWidth, toTileHeight;\n  var tiles = [];\n  var tile;\n\n  // we go top-to-down instead of left-to-right to make image displayed from top to\n  // doesn in the browser\n  for (innerY = 0; innerY < options.toHeight; innerY += innerTileHeight) {\n    for (innerX = 0; innerX < options.toWidth; innerX += innerTileWidth) {\n      x = innerX - options.destTileBorder;\n      if (x < 0) {\n        x = 0;\n      }\n      toTileWidth = innerX + innerTileWidth + options.destTileBorder - x;\n      if (x + toTileWidth >= options.toWidth) {\n        toTileWidth = options.toWidth - x;\n      }\n\n      y = innerY - options.destTileBorder;\n      if (y < 0) {\n        y = 0;\n      }\n      toTileHeight = innerY + innerTileHeight + options.destTileBorder - y;\n      if (y + toTileHeight >= options.toHeight) {\n        toTileHeight = options.toHeight - y;\n      }\n\n      tile = {\n        toX: x,\n        toY: y,\n        toWidth: toTileWidth,\n        toHeight: toTileHeight,\n\n        toInnerX: innerX,\n        toInnerY: innerY,\n        toInnerWidth: innerTileWidth,\n        toInnerHeight: innerTileHeight,\n\n        offsetX: x / scaleX - pixelFloor(x / scaleX),\n        offsetY: y / scaleY - pixelFloor(y / scaleY),\n        scaleX: scaleX,\n        scaleY: scaleY,\n\n        x: pixelFloor(x / scaleX),\n        y: pixelFloor(y / scaleY),\n        width: pixelCeil(toTileWidth / scaleX),\n        height: pixelCeil(toTileHeight / scaleY)\n      };\n\n      tiles.push(tile);\n    }\n  }\n\n  return tiles;\n};\n\n},{}],12:[function(require,module,exports){\n'use strict';\n\nfunction objClass(obj) {\n  return Object.prototype.toString.call(obj);\n}\n\nmodule.exports.isCanvas = function isCanvas(element) {\n  //return (element.nodeName && element.nodeName.toLowerCase() === 'canvas') ||\n  var cname = objClass(element);\n\n  return cname === '[object HTMLCanvasElement]' /* browser */ || cname === '[object Canvas]' /* node-canvas */;\n};\n\nmodule.exports.isImage = function isImage(element) {\n  //return element.nodeName && element.nodeName.toLowerCase() === 'img';\n  return objClass(element) === '[object HTMLImageElement]';\n};\n\nmodule.exports.limiter = function limiter(concurrency) {\n  var active = 0,\n      queue = [];\n\n  function roll() {\n    if (active < concurrency && queue.length) {\n      active++;\n      queue.shift()();\n    }\n  }\n\n  return function limit(fn) {\n    return new Promise(function (resolve, reject) {\n      queue.push(function () {\n        fn().then(function (result) {\n          resolve(result);\n          active--;\n          roll();\n        }, function (err) {\n          reject(err);\n          active--;\n          roll();\n        });\n      });\n\n      roll();\n    });\n  };\n};\n\nmodule.exports.cib_quality_name = function cib_quality_name(num) {\n  switch (num) {\n    case 0:\n      return 'pixelated';\n    case 1:\n      return 'low';\n    case 2:\n      return 'medium';\n  }\n  return 'high';\n};\n\nmodule.exports.cib_support = function cib_support() {\n  return Promise.resolve().then(function () {\n    if (typeof createImageBitmap === 'undefined' || typeof document === 'undefined') {\n      return false;\n    }\n\n    var c = document.createElement('canvas');\n    c.width = 100;\n    c.height = 100;\n\n    return createImageBitmap(c, 0, 0, 100, 100, {\n      resizeWidth: 10,\n      resizeHeight: 10,\n      resizeQuality: 'high'\n    }).then(function (bitmap) {\n      var status = bitmap.width === 10;\n\n      // Branch below is filtered on upper level. We do not call resize\n      // detection for basic ImageBitmap.\n      //\n      // https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap\n      // old Crome 51 has ImageBitmap without .close(). Then this code\n      // will throw and return 'false' as expected.\n      //\n      bitmap.close();\n      c = null;\n      return status;\n    });\n  }).catch(function () {\n    return false;\n  });\n};\n\n},{}],13:[function(require,module,exports){\n// Web Worker wrapper for image resize function\n\n'use strict';\n\nmodule.exports = function () {\n  var MathLib = require('./mathlib');\n\n  var mathLib = void 0;\n\n  /* eslint-disable no-undef */\n  onmessage = function onmessage(ev) {\n    var opts = ev.data.opts;\n\n    if (!mathLib) mathLib = new MathLib(ev.data.features);\n\n    // Use multimath's sync auto-init. Avoid Promise use in old browsers,\n    // because polyfills are not propagated to webworker.\n    var result = mathLib.resizeAndUnsharp(opts);\n\n    postMessage({ result: result }, [result.buffer]);\n  };\n};\n\n},{\"./mathlib\":1}],14:[function(require,module,exports){\n// Calculate Gaussian blur of an image using IIR filter\n// The method is taken from Intel's white paper and code example attached to it:\n// https://software.intel.com/en-us/articles/iir-gaussian-blur-filter\n// -implementation-using-intel-advanced-vector-extensions\n\nvar a0, a1, a2, a3, b1, b2, left_corner, right_corner;\n\nfunction gaussCoef(sigma) {\n  if (sigma < 0.5) {\n    sigma = 0.5;\n  }\n\n  var a = Math.exp(0.726 * 0.726) / sigma,\n      g1 = Math.exp(-a),\n      g2 = Math.exp(-2 * a),\n      k = (1 - g1) * (1 - g1) / (1 + 2 * a * g1 - g2);\n\n  a0 = k;\n  a1 = k * (a - 1) * g1;\n  a2 = k * (a + 1) * g1;\n  a3 = -k * g2;\n  b1 = 2 * g1;\n  b2 = -g2;\n  left_corner = (a0 + a1) / (1 - b1 - b2);\n  right_corner = (a2 + a3) / (1 - b1 - b2);\n\n  // Attempt to force type to FP32.\n  return new Float32Array([ a0, a1, a2, a3, b1, b2, left_corner, right_corner ]);\n}\n\nfunction convolveMono16(src, out, line, coeff, width, height) {\n  // takes src image and writes the blurred and transposed result into out\n\n  var prev_src, curr_src, curr_out, prev_out, prev_prev_out;\n  var src_index, out_index, line_index;\n  var i, j;\n  var coeff_a0, coeff_a1, coeff_b1, coeff_b2;\n\n  for (i = 0; i < height; i++) {\n    src_index = i * width;\n    out_index = i;\n    line_index = 0;\n\n    // left to right\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[6];\n    prev_out = prev_prev_out;\n\n    coeff_a0 = coeff[0];\n    coeff_a1 = coeff[1];\n    coeff_b1 = coeff[4];\n    coeff_b2 = coeff[5];\n\n    for (j = 0; j < width; j++) {\n      curr_src = src[src_index];\n\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n      prev_src = curr_src;\n\n      line[line_index] = prev_out;\n      line_index++;\n      src_index++;\n    }\n\n    src_index--;\n    line_index--;\n    out_index += height * (width - 1);\n\n    // right to left\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[7];\n    prev_out = prev_prev_out;\n    curr_src = prev_src;\n\n    coeff_a0 = coeff[2];\n    coeff_a1 = coeff[3];\n\n    for (j = width - 1; j >= 0; j--) {\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n\n      prev_src = curr_src;\n      curr_src = src[src_index];\n\n      out[out_index] = line[line_index] + prev_out;\n\n      src_index--;\n      line_index--;\n      out_index -= height;\n    }\n  }\n}\n\n\nfunction blurMono16(src, width, height, radius) {\n  // Quick exit on zero radius\n  if (!radius) { return; }\n\n  var out      = new Uint16Array(src.length),\n      tmp_line = new Float32Array(Math.max(width, height));\n\n  var coeff = gaussCoef(radius);\n\n  convolveMono16(src, out, tmp_line, coeff, width, height, radius);\n  convolveMono16(out, src, tmp_line, coeff, height, width, radius);\n}\n\nmodule.exports = blurMono16;\n\n},{}],15:[function(require,module,exports){\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n\n},{}],16:[function(require,module,exports){\n'use strict';\n\n\nvar assign         = require('object-assign');\nvar base64decode   = require('./lib/base64decode');\nvar hasWebAssembly = require('./lib/wa_detect');\n\n\nvar DEFAULT_OPTIONS = {\n  js: true,\n  wasm: true\n};\n\n\nfunction MultiMath(options) {\n  if (!(this instanceof MultiMath)) return new MultiMath(options);\n\n  var opts = assign({}, DEFAULT_OPTIONS, options || {});\n\n  this.options         = opts;\n\n  this.__cache         = {};\n  this.has_wasm        = hasWebAssembly();\n\n  this.__init_promise  = null;\n  this.__modules       = opts.modules || {};\n  this.__memory        = null;\n  this.__wasm          = {};\n\n  this.__isLE = ((new Uint32Array((new Uint8Array([ 1, 0, 0, 0 ])).buffer))[0] === 1);\n\n  if (!this.options.js && !this.options.wasm) {\n    throw new Error('mathlib: at least \"js\" or \"wasm\" should be enabled');\n  }\n}\n\n\nMultiMath.prototype.use = function (module) {\n  this.__modules[module.name] = module;\n\n  // Pin the best possible implementation\n  if (!this.has_wasm || !this.options.wasm || !module.wasm_fn) {\n    this[module.name] = module.fn;\n  } else {\n    this[module.name] = module.wasm_fn;\n  }\n\n  return this;\n};\n\n\nMultiMath.prototype.init = function () {\n  if (this.__init_promise) return this.__init_promise;\n\n  if (!this.options.js && this.options.wasm && !this.has_wasm) {\n    return Promise.reject(new Error('mathlib: only \"wasm\" was enabled, but it\\'s not supported'));\n  }\n\n  var self = this;\n\n  this.__init_promise = Promise.all(Object.keys(self.__modules).map(function (name) {\n    var module = self.__modules[name];\n\n    if (!self.has_wasm || !self.options.wasm || !module.wasm_fn) return null;\n\n    // If already compiled - exit\n    if (self.__wasm[name]) return null;\n\n    // Compile wasm source\n    return WebAssembly.compile(self.__base64decode(module.wasm_src))\n      .then(function (m) { self.__wasm[name] = m; });\n  }))\n    .then(function () { return self; });\n\n  return this.__init_promise;\n};\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Methods below are for internal use from plugins\n\n\n// Simple decode base64 to typed array. Useful to load embedded webassembly\n// code. You probably don't need to call this method directly.\n//\nMultiMath.prototype.__base64decode = base64decode;\n\n\n// Increase current memory to include specified number of bytes. Do nothing if\n// size is already ok. You probably don't need to call this method directly,\n// because it will be invoked from `.__instance()`.\n//\nMultiMath.prototype.__reallocate = function mem_grow_to(bytes) {\n  if (!this.__memory) {\n    this.__memory = new WebAssembly.Memory({\n      initial: Math.ceil(bytes / (64 * 1024))\n    });\n    return this.__memory;\n  }\n\n  var mem_size = this.__memory.buffer.byteLength;\n\n  if (mem_size < bytes) {\n    this.__memory.grow(Math.ceil((bytes - mem_size) / (64 * 1024)));\n  }\n\n  return this.__memory;\n};\n\n\n// Returns instantinated webassembly item by name, with specified memory size\n// and environment.\n// - use cache if available\n// - do sync module init, if async init was not called earlier\n// - allocate memory if not enougth\n// - can export functions to webassembly via \"env_extra\",\n//   for example, { exp: Math.exp }\n//\nMultiMath.prototype.__instance = function instance(name, memsize, env_extra) {\n  if (memsize) this.__reallocate(memsize);\n\n  // If .init() was not called, do sync compile\n  if (!this.__wasm[name]) {\n    var module = this.__modules[name];\n    this.__wasm[name] = new WebAssembly.Module(this.__base64decode(module.wasm_src));\n  }\n\n  if (!this.__cache[name]) {\n    var env_base = {\n      memoryBase: 0,\n      memory: this.__memory,\n      tableBase: 0,\n      table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' })\n    };\n\n    this.__cache[name] = new WebAssembly.Instance(this.__wasm[name], {\n      env: assign(env_base, env_extra || {})\n    });\n  }\n\n  return this.__cache[name];\n};\n\n\n// Helper to calculate memory aligh for pointers. Webassembly does not require\n// this, but you may wish to experiment. Default base = 8;\n//\nMultiMath.prototype.__align = function align(number, base) {\n  base = base || 8;\n  var reminder = number % base;\n  return number + (reminder ? base - reminder : 0);\n};\n\n\nmodule.exports = MultiMath;\n\n},{\"./lib/base64decode\":17,\"./lib/wa_detect\":23,\"object-assign\":24}],17:[function(require,module,exports){\n// base64 decode str -> Uint8Array, to load WA modules\n//\n'use strict';\n\n\nvar BASE64_MAP = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n\nmodule.exports = function base64decode(str) {\n  var input = str.replace(/[\\r\\n=]/g, ''), // remove CR/LF & padding to simplify scan\n      max   = input.length;\n\n  var out = new Uint8Array((max * 3) >> 2);\n\n  // Collect by 6*4 bits (3 bytes)\n\n  var bits = 0;\n  var ptr  = 0;\n\n  for (var idx = 0; idx < max; idx++) {\n    if ((idx % 4 === 0) && idx) {\n      out[ptr++] = (bits >> 16) & 0xFF;\n      out[ptr++] = (bits >> 8) & 0xFF;\n      out[ptr++] = bits & 0xFF;\n    }\n\n    bits = (bits << 6) | BASE64_MAP.indexOf(input.charAt(idx));\n  }\n\n  // Dump tail\n\n  var tailbits = (max % 4) * 6;\n\n  if (tailbits === 0) {\n    out[ptr++] = (bits >> 16) & 0xFF;\n    out[ptr++] = (bits >> 8) & 0xFF;\n    out[ptr++] = bits & 0xFF;\n  } else if (tailbits === 18) {\n    out[ptr++] = (bits >> 10) & 0xFF;\n    out[ptr++] = (bits >> 2) & 0xFF;\n  } else if (tailbits === 12) {\n    out[ptr++] = (bits >> 4) & 0xFF;\n  }\n\n  return out;\n};\n\n},{}],18:[function(require,module,exports){\n// Calculates 16-bit precision HSL lightness from 8-bit rgba buffer\n//\n'use strict';\n\n\nmodule.exports = function hsl_l16_js(img, width, height) {\n  var size = width * height;\n  var out = new Uint16Array(size);\n  var r, g, b, min, max;\n  for (var i = 0; i < size; i++) {\n    r = img[4 * i];\n    g = img[4 * i + 1];\n    b = img[4 * i + 2];\n    max = (r >= g && r >= b) ? r : (g >= b && g >= r) ? g : b;\n    min = (r <= g && r <= b) ? r : (g <= b && g <= r) ? g : b;\n    out[i] = (max + min) * 257 >> 1;\n  }\n  return out;\n};\n\n},{}],19:[function(require,module,exports){\n'use strict';\n\nmodule.exports = {\n  name:     'unsharp_mask',\n  fn:       require('./unsharp_mask'),\n  wasm_fn:  require('./unsharp_mask_wasm'),\n  wasm_src: require('./unsharp_mask_wasm_base64')\n};\n\n},{\"./unsharp_mask\":20,\"./unsharp_mask_wasm\":21,\"./unsharp_mask_wasm_base64\":22}],20:[function(require,module,exports){\n// Unsharp mask filter\n//\n// http://stackoverflow.com/a/23322820/1031804\n// USM(O) = O + (2 * (Amount / 100) * (O - GB))\n// GB - gaussian blur.\n//\n// Image is converted from RGB to HSL, unsharp mask is applied to the\n// lightness channel and then image is converted back to RGB.\n//\n'use strict';\n\n\nvar glur_mono16 = require('glur/mono16');\nvar hsl_l16     = require('./hsl_l16');\n\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  var r, g, b;\n  var h, s, l;\n  var min, max;\n  var m1, m2, hShifted;\n  var diff, iTimes4;\n\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var lightness = hsl_l16(img, width, height);\n\n  var blured = new Uint16Array(lightness); // copy, because blur modify src\n\n  glur_mono16(blured, width, height, radius);\n\n  var amountFp = (amount / 100 * 0x1000 + 0.5)|0;\n  var thresholdFp = (threshold * 257)|0;\n\n  var size = width * height;\n\n  /* eslint-disable indent */\n  for (var i = 0; i < size; i++) {\n    diff = 2 * (lightness[i] - blured[i]);\n\n    if (Math.abs(diff) >= thresholdFp) {\n      iTimes4 = i * 4;\n      r = img[iTimes4];\n      g = img[iTimes4 + 1];\n      b = img[iTimes4 + 2];\n\n      // convert RGB to HSL\n      // take RGB, 8-bit unsigned integer per each channel\n      // save HSL, H and L are 16-bit unsigned integers, S is 12-bit unsigned integer\n      // math is taken from here: http://www.easyrgb.com/index.php?X=MATH&H=18\n      // and adopted to be integer (fixed point in fact) for sake of performance\n      max = (r >= g && r >= b) ? r : (g >= r && g >= b) ? g : b; // min and max are in [0..0xff]\n      min = (r <= g && r <= b) ? r : (g <= r && g <= b) ? g : b;\n      l = (max + min) * 257 >> 1; // l is in [0..0xffff] that is caused by multiplication by 257\n\n      if (min === max) {\n        h = s = 0;\n      } else {\n        s = (l <= 0x7fff) ?\n          (((max - min) * 0xfff) / (max + min))|0 :\n          (((max - min) * 0xfff) / (2 * 0xff - max - min))|0; // s is in [0..0xfff]\n        // h could be less 0, it will be fixed in backward conversion to RGB, |h| <= 0xffff / 6\n        h = (r === max) ? (((g - b) * 0xffff) / (6 * (max - min)))|0\n          : (g === max) ? 0x5555 + ((((b - r) * 0xffff) / (6 * (max - min)))|0) // 0x5555 == 0xffff / 3\n          : 0xaaaa + ((((r - g) * 0xffff) / (6 * (max - min)))|0); // 0xaaaa == 0xffff * 2 / 3\n      }\n\n      // add unsharp mask mask to the lightness channel\n      l += (amountFp * diff + 0x800) >> 12;\n      if (l > 0xffff) {\n        l = 0xffff;\n      } else if (l < 0) {\n        l = 0;\n      }\n\n      // convert HSL back to RGB\n      // for information about math look above\n      if (s === 0) {\n        r = g = b = l >> 8;\n      } else {\n        m2 = (l <= 0x7fff) ? (l * (0x1000 + s) + 0x800) >> 12 :\n          l  + (((0xffff - l) * s + 0x800) >>  12);\n        m1 = 2 * l - m2 >> 8;\n        m2 >>= 8;\n        // save result to RGB channels\n        // R channel\n        hShifted = (h + 0x5555) & 0xffff; // 0x5555 == 0xffff / 3\n        r = (hShifted >= 0xaaaa) ? m1 // 0xaaaa == 0xffff * 2 / 3\n          : (hShifted >= 0x7fff) ?  m1 + ((m2 - m1) * 6 * (0xaaaa - hShifted) + 0x8000 >> 16)\n          : (hShifted >= 0x2aaa) ? m2 // 0x2aaa == 0xffff / 6\n          : m1 + ((m2 - m1) * 6 * hShifted + 0x8000 >> 16);\n        // G channel\n        hShifted = h & 0xffff;\n        g = (hShifted >= 0xaaaa) ? m1 // 0xaaaa == 0xffff * 2 / 3\n          : (hShifted >= 0x7fff) ?  m1 + ((m2 - m1) * 6 * (0xaaaa - hShifted) + 0x8000 >> 16)\n          : (hShifted >= 0x2aaa) ? m2 // 0x2aaa == 0xffff / 6\n          : m1 + ((m2 - m1) * 6 * hShifted + 0x8000 >> 16);\n        // B channel\n        hShifted = (h - 0x5555) & 0xffff;\n        b = (hShifted >= 0xaaaa) ? m1 // 0xaaaa == 0xffff * 2 / 3\n          : (hShifted >= 0x7fff) ?  m1 + ((m2 - m1) * 6 * (0xaaaa - hShifted) + 0x8000 >> 16)\n          : (hShifted >= 0x2aaa) ? m2 // 0x2aaa == 0xffff / 6\n          : m1 + ((m2 - m1) * 6 * hShifted + 0x8000 >> 16);\n      }\n\n      img[iTimes4] = r;\n      img[iTimes4 + 1] = g;\n      img[iTimes4 + 2] = b;\n    }\n  }\n};\n\n},{\"./hsl_l16\":18,\"glur/mono16\":14}],21:[function(require,module,exports){\n'use strict';\n\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var pixels = width * height;\n\n  var img_bytes_cnt        = pixels * 4;\n  var hsl_bytes_cnt        = pixels * 2;\n  var blur_bytes_cnt       = pixels * 2;\n  var blur_line_byte_cnt   = Math.max(width, height) * 4; // float32 array\n  var blur_coeffs_byte_cnt = 8 * 4; // float32 array\n\n  var img_offset         = 0;\n  var hsl_offset         = img_bytes_cnt;\n  var blur_offset        = hsl_offset + hsl_bytes_cnt;\n  var blur_tmp_offset    = blur_offset + blur_bytes_cnt;\n  var blur_line_offset   = blur_tmp_offset + blur_bytes_cnt;\n  var blur_coeffs_offset = blur_line_offset + blur_line_byte_cnt;\n\n  var instance = this.__instance(\n    'unsharp_mask',\n    img_bytes_cnt + hsl_bytes_cnt + blur_bytes_cnt * 2 + blur_line_byte_cnt + blur_coeffs_byte_cnt,\n    { exp: Math.exp }\n  );\n\n  // 32-bit copy is much faster in chrome\n  var img32 = new Uint32Array(img.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer);\n  mem32.set(img32);\n\n  // HSL\n  var fn = instance.exports.hsl_l16 || instance.exports._hsl_l16;\n  fn(img_offset, hsl_offset, width, height);\n\n  // BLUR\n  fn = instance.exports.blurMono16 || instance.exports._blurMono16;\n  fn(hsl_offset, blur_offset, blur_tmp_offset,\n    blur_line_offset, blur_coeffs_offset, width, height, radius);\n\n  // UNSHARP\n  fn = instance.exports.unsharp || instance.exports._unsharp;\n  fn(img_offset, img_offset, hsl_offset,\n    blur_offset, width, height, amount, threshold);\n\n  // 32-bit copy is much faster in chrome\n  img32.set(new Uint32Array(this.__memory.buffer, 0, pixels));\n};\n\n},{}],22:[function(require,module,exports){\n// This is autogenerated file from math.wasm, don't edit.\n//\n'use strict';\n\n/* eslint-disable max-len */\nmodule.exports = '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';\n\n},{}],23:[function(require,module,exports){\n// Detect WebAssembly support.\n// - Check global WebAssembly object\n// - Try to load simple module (can be disabled via CSP)\n//\n'use strict';\n\n\nvar wa;\n\n\nmodule.exports = function hasWebAssembly() {\n  // use cache if called before;\n  if (typeof wa !== 'undefined') return wa;\n\n  wa = false;\n\n  if (typeof WebAssembly === 'undefined') return wa;\n\n  // If WebAssenbly is disabled, code can throw on compile\n  try {\n    // https://github.com/brion/min-wasm-fail/blob/master/min-wasm-fail.in.js\n    // Additional check that WA internals are correct\n\n    /* eslint-disable comma-spacing, max-len */\n    var bin      = new Uint8Array([ 0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11 ]);\n    var module   = new WebAssembly.Module(bin);\n    var instance = new WebAssembly.Instance(module, {});\n\n    // test storing to and loading from a non-zero location via a parameter.\n    // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n    if (instance.exports.test(4) !== 0) wa = true;\n\n    return wa;\n  } catch (__) {}\n\n  return wa;\n};\n\n},{}],24:[function(require,module,exports){\n/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n},{}],25:[function(require,module,exports){\nvar bundleFn = arguments[3];\nvar sources = arguments[4];\nvar cache = arguments[5];\n\nvar stringify = JSON.stringify;\n\nmodule.exports = function (fn, options) {\n    var wkey;\n    var cacheKeys = Object.keys(cache);\n\n    for (var i = 0, l = cacheKeys.length; i < l; i++) {\n        var key = cacheKeys[i];\n        var exp = cache[key].exports;\n        // Using babel as a transpiler to use esmodule, the export will always\n        // be an object with the default export as a property of it. To ensure\n        // the existing api and babel esmodule exports are both supported we\n        // check for both\n        if (exp === fn || exp && exp.default === fn) {\n            wkey = key;\n            break;\n        }\n    }\n\n    if (!wkey) {\n        wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n        var wcache = {};\n        for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            wcache[key] = key;\n        }\n        sources[wkey] = [\n            'function(require,module,exports){' + fn + '(self); }',\n            wcache\n        ];\n    }\n    var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n\n    var scache = {}; scache[wkey] = wkey;\n    sources[skey] = [\n        'function(require,module,exports){' +\n            // try to call default if defined to also support babel esmodule exports\n            'var f = require(' + stringify(wkey) + ');' +\n            '(f.default ? f.default : f)(self);' +\n        '}',\n        scache\n    ];\n\n    var workerSources = {};\n    resolveSources(skey);\n\n    function resolveSources(key) {\n        workerSources[key] = true;\n\n        for (var depPath in sources[key][1]) {\n            var depKey = sources[key][1][depPath];\n            if (!workerSources[depKey]) {\n                resolveSources(depKey);\n            }\n        }\n    }\n\n    var src = '(' + bundleFn + ')({'\n        + Object.keys(workerSources).map(function (key) {\n            return stringify(key) + ':['\n                + sources[key][0]\n                + ',' + stringify(sources[key][1]) + ']'\n            ;\n        }).join(',')\n        + '},{},[' + stringify(skey) + '])'\n    ;\n\n    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n    var blob = new Blob([src], { type: 'text/javascript' });\n    if (options && options.bare) { return blob; }\n    var workerUrl = URL.createObjectURL(blob);\n    var worker = new Worker(workerUrl);\n    worker.objectURL = workerUrl;\n    return worker;\n};\n\n},{}],\"/\":[function(require,module,exports){\n'use strict';\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar assign = require('object-assign');\nvar webworkify = require('webworkify');\n\nvar MathLib = require('./lib/mathlib');\nvar Pool = require('./lib/pool');\nvar utils = require('./lib/utils');\nvar worker = require('./lib/worker');\nvar createStages = require('./lib/stepper');\nvar createRegions = require('./lib/tiler');\n\n// Deduplicate pools & limiters with the same configs\n// when user creates multiple pica instances.\nvar singletones = {};\n\nvar NEED_SAFARI_FIX = false;\ntry {\n  if (typeof navigator !== 'undefined' && navigator.userAgent) {\n    NEED_SAFARI_FIX = navigator.userAgent.indexOf('Safari') >= 0;\n  }\n} catch (e) {}\n\nvar concurrency = 1;\nif (typeof navigator !== 'undefined') {\n  concurrency = Math.min(navigator.hardwareConcurrency || 1, 4);\n}\n\nvar DEFAULT_PICA_OPTS = {\n  tile: 1024,\n  concurrency: concurrency,\n  features: ['js', 'wasm', 'ww'],\n  idle: 2000\n};\n\nvar DEFAULT_RESIZE_OPTS = {\n  quality: 3,\n  alpha: false,\n  unsharpAmount: 0,\n  unsharpRadius: 0.0,\n  unsharpThreshold: 0\n};\n\nvar CAN_NEW_IMAGE_DATA = void 0;\nvar CAN_CREATE_IMAGE_BITMAP = void 0;\n\nfunction workerFabric() {\n  return {\n    value: webworkify(worker),\n    destroy: function destroy() {\n      this.value.terminate();\n\n      if (typeof window !== 'undefined') {\n        var url = window.URL || window.webkitURL || window.mozURL || window.msURL;\n        if (url && url.revokeObjectURL && this.value.objectURL) {\n          url.revokeObjectURL(this.value.objectURL);\n        }\n      }\n    }\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// API methods\n\nfunction Pica(options) {\n  if (!(this instanceof Pica)) return new Pica(options);\n\n  this.options = assign({}, DEFAULT_PICA_OPTS, options || {});\n\n  var limiter_key = 'lk_' + this.options.concurrency;\n\n  // Share limiters to avoid multiple parallel workers when user creates\n  // multiple pica instances.\n  this.__limit = singletones[limiter_key] || utils.limiter(this.options.concurrency);\n\n  if (!singletones[limiter_key]) singletones[limiter_key] = this.__limit;\n\n  // List of supported features, according to options & browser/node.js\n  this.features = {\n    js: false, // pure JS implementation, can be disabled for testing\n    wasm: false, // webassembly implementation for heavy functions\n    cib: false, // resize via createImageBitmap (only FF at this moment)\n    ww: false // webworkers\n  };\n\n  this.__workersPool = null;\n\n  // Store requested features for webworkers\n  this.__requested_features = [];\n\n  this.__mathlib = null;\n}\n\nPica.prototype.init = function () {\n  var _this = this;\n\n  if (this.__initPromise) return this.__initPromise;\n\n  // Test if we can create ImageData without canvas and memory copy\n  if (CAN_NEW_IMAGE_DATA !== false && CAN_NEW_IMAGE_DATA !== true) {\n    CAN_NEW_IMAGE_DATA = false;\n    if (typeof ImageData !== 'undefined' && typeof Uint8ClampedArray !== 'undefined') {\n      try {\n        /* eslint-disable no-new */\n        new ImageData(new Uint8ClampedArray(400), 10, 10);\n        CAN_NEW_IMAGE_DATA = true;\n      } catch (__) {}\n    }\n  }\n\n  // ImageBitmap can be effective in 2 places:\n  //\n  // 1. Threaded jpeg unpack (basic)\n  // 2. Built-in resize (blocked due problem in chrome, see issue #89)\n  //\n  // For basic use we also need ImageBitmap wo support .close() method,\n  // see https://developer.mozilla.org/ru/docs/Web/API/ImageBitmap\n\n  if (CAN_CREATE_IMAGE_BITMAP !== false && CAN_CREATE_IMAGE_BITMAP !== true) {\n    CAN_CREATE_IMAGE_BITMAP = false;\n    if (typeof ImageBitmap !== 'undefined') {\n      if (ImageBitmap.prototype && ImageBitmap.prototype.close) {\n        CAN_CREATE_IMAGE_BITMAP = true;\n      } else {\n        this.debug('ImageBitmap does not support .close(), disabled');\n      }\n    }\n  }\n\n  var features = this.options.features.slice();\n\n  if (features.indexOf('all') >= 0) {\n    features = ['cib', 'wasm', 'js', 'ww'];\n  }\n\n  this.__requested_features = features;\n\n  this.__mathlib = new MathLib(features);\n\n  // Check WebWorker support if requested\n  if (features.indexOf('ww') >= 0) {\n    if (typeof window !== 'undefined' && 'Worker' in window) {\n      // IE <= 11 don't allow to create webworkers from string. We should check it.\n      // https://connect.microsoft.com/IE/feedback/details/801810/web-workers-from-blob-urls-in-ie-10-and-11\n      try {\n        var wkr = require('webworkify')(function () {});\n        wkr.terminate();\n        this.features.ww = true;\n\n        // pool uniqueness depends on pool config + webworker config\n        var wpool_key = 'wp_' + JSON.stringify(this.options);\n\n        if (singletones[wpool_key]) {\n          this.__workersPool = singletones[wpool_key];\n        } else {\n          this.__workersPool = new Pool(workerFabric, this.options.idle);\n          singletones[wpool_key] = this.__workersPool;\n        }\n      } catch (__) {}\n    }\n  }\n\n  var initMath = this.__mathlib.init().then(function (mathlib) {\n    // Copy detected features\n    assign(_this.features, mathlib.features);\n  });\n\n  var checkCibResize = void 0;\n\n  if (!CAN_CREATE_IMAGE_BITMAP) {\n    checkCibResize = Promise.resolve(false);\n  } else {\n    checkCibResize = utils.cib_support().then(function (status) {\n      if (_this.features.cib && features.indexOf('cib') < 0) {\n        _this.debug('createImageBitmap() resize supported, but disabled by config');\n        return;\n      }\n\n      if (features.indexOf('cib') >= 0) _this.features.cib = status;\n    });\n  }\n\n  // Init math lib. That's async because can load some\n  this.__initPromise = Promise.all([initMath, checkCibResize]).then(function () {\n    return _this;\n  });\n\n  return this.__initPromise;\n};\n\nPica.prototype.resize = function (from, to, options) {\n  var _this2 = this;\n\n  this.debug('Start resize...');\n\n  var opts = assign({}, DEFAULT_RESIZE_OPTS);\n\n  if (!isNaN(options)) {\n    opts = assign(opts, { quality: options });\n  } else if (options) {\n    opts = assign(opts, options);\n  }\n\n  opts.toWidth = to.width;\n  opts.toHeight = to.height;\n  opts.width = from.naturalWidth || from.width;\n  opts.height = from.naturalHeight || from.height;\n\n  if (opts.unsharpRadius > 2) opts.unsharpRadius = 2;\n\n  var canceled = false;\n  var cancelToken = null;\n\n  if (opts.cancelToken) {\n    // Wrap cancelToken to avoid successive resolve & set flag\n    cancelToken = opts.cancelToken.then(function (data) {\n      canceled = true;throw data;\n    }, function (err) {\n      canceled = true;throw err;\n    });\n  }\n\n  var DEST_TILE_BORDER = 3; // Max possible filter window size\n  var destTileBorder = Math.ceil(Math.max(DEST_TILE_BORDER, 2.5 * opts.unsharpRadius | 0));\n\n  return this.init().then(function () {\n    if (canceled) return cancelToken;\n\n    // if createImageBitmap supports resize, just do it and return\n    if (_this2.features.cib) {\n      var toCtx = to.getContext('2d', { alpha: Boolean(opts.alpha) });\n\n      _this2.debug('Resize via createImageBitmap()');\n\n      return createImageBitmap(from, {\n        resizeWidth: opts.toWidth,\n        resizeHeight: opts.toHeight,\n        resizeQuality: utils.cib_quality_name(opts.quality)\n      }).then(function (imageBitmap) {\n        if (canceled) return cancelToken;\n\n        // if no unsharp - draw directly to output canvas\n        if (!opts.unsharpAmount) {\n          toCtx.drawImage(imageBitmap, 0, 0);\n          imageBitmap.close();\n          toCtx = null;\n\n          _this2.debug('Finished!');\n\n          return to;\n        }\n\n        _this2.debug('Unsharp result');\n\n        var tmpCanvas = document.createElement('canvas');\n\n        tmpCanvas.width = opts.toWidth;\n        tmpCanvas.height = opts.toHeight;\n\n        var tmpCtx = tmpCanvas.getContext('2d', { alpha: Boolean(opts.alpha) });\n\n        tmpCtx.drawImage(imageBitmap, 0, 0);\n        imageBitmap.close();\n\n        var iData = tmpCtx.getImageData(0, 0, opts.toWidth, opts.toHeight);\n\n        _this2.__mathlib.unsharp(iData.data, opts.toWidth, opts.toHeight, opts.unsharpAmount, opts.unsharpRadius, opts.unsharpThreshold);\n\n        toCtx.putImageData(iData, 0, 0);\n        iData = tmpCtx = tmpCanvas = toCtx = null;\n\n        _this2.debug('Finished!');\n\n        return to;\n      });\n    }\n\n    //\n    // No easy way, let's resize manually via arrays\n    //\n\n    // Share cache between calls:\n    //\n    // - wasm instance\n    // - wasm memory object\n    //\n    var cache = {};\n\n    // Call resizer in webworker or locally, depending on config\n    var invokeResize = function invokeResize(opts) {\n      return Promise.resolve().then(function () {\n        if (!_this2.features.ww) return _this2.__mathlib.resizeAndUnsharp(opts, cache);\n\n        return new Promise(function (resolve, reject) {\n          var w = _this2.__workersPool.acquire();\n\n          if (cancelToken) cancelToken.catch(function (err) {\n            return reject(err);\n          });\n\n          w.value.onmessage = function (ev) {\n            w.release();\n\n            if (ev.data.err) reject(ev.data.err);else resolve(ev.data.result);\n          };\n\n          w.value.postMessage({\n            opts: opts,\n            features: _this2.__requested_features,\n            preload: {\n              wasm_nodule: _this2.__mathlib.__\n            }\n          }, [opts.src.buffer]);\n        });\n      });\n    };\n\n    var tileAndResize = function tileAndResize(from, to, opts) {\n      var srcCtx = void 0;\n      var srcImageBitmap = void 0;\n      var toCtx = void 0;\n\n      var processTile = function processTile(tile) {\n        return _this2.__limit(function () {\n          if (canceled) return cancelToken;\n\n          var srcImageData = void 0;\n\n          // Extract tile RGBA buffer, depending on input type\n          if (utils.isCanvas(from)) {\n            _this2.debug('Get tile pixel data');\n\n            // If input is Canvas - extract region data directly\n            srcImageData = srcCtx.getImageData(tile.x, tile.y, tile.width, tile.height);\n          } else {\n            // If input is Image or decoded to ImageBitmap,\n            // draw region to temporary canvas and extract data from it\n            //\n            // Note! Attempt to reuse this canvas causes significant slowdown in chrome\n            //\n            _this2.debug('Draw tile imageBitmap/image to temporary canvas');\n\n            var tmpCanvas = document.createElement('canvas');\n            tmpCanvas.width = tile.width;\n            tmpCanvas.height = tile.height;\n\n            var tmpCtx = tmpCanvas.getContext('2d', { alpha: Boolean(opts.alpha) });\n            tmpCtx.globalCompositeOperation = 'copy';\n            tmpCtx.drawImage(srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height, 0, 0, tile.width, tile.height);\n\n            _this2.debug('Get tile pixel data');\n\n            srcImageData = tmpCtx.getImageData(0, 0, tile.width, tile.height);\n            tmpCtx = tmpCanvas = null;\n          }\n\n          var o = {\n            src: srcImageData.data,\n            width: tile.width,\n            height: tile.height,\n            toWidth: tile.toWidth,\n            toHeight: tile.toHeight,\n            scaleX: tile.scaleX,\n            scaleY: tile.scaleY,\n            offsetX: tile.offsetX,\n            offsetY: tile.offsetY,\n            quality: opts.quality,\n            alpha: opts.alpha,\n            unsharpAmount: opts.unsharpAmount,\n            unsharpRadius: opts.unsharpRadius,\n            unsharpThreshold: opts.unsharpThreshold\n          };\n\n          _this2.debug('Invoke resize math');\n\n          return Promise.resolve().then(function () {\n            return invokeResize(o);\n          }).then(function (result) {\n            if (canceled) return cancelToken;\n\n            srcImageData = null;\n\n            var toImageData = void 0;\n\n            _this2.debug('Convert raw rgba tile result to ImageData');\n\n            if (CAN_NEW_IMAGE_DATA) {\n              // this branch is for modern browsers\n              // If `new ImageData()` & Uint8ClampedArray suported\n              toImageData = new ImageData(new Uint8ClampedArray(result), tile.toWidth, tile.toHeight);\n            } else {\n              // fallback for `node-canvas` and old browsers\n              // (IE11 has ImageData but does not support `new ImageData()`)\n              toImageData = toCtx.createImageData(tile.toWidth, tile.toHeight);\n\n              if (toImageData.data.set) {\n                toImageData.data.set(result);\n              } else {\n                // IE9 don't have `.set()`\n                for (var i = toImageData.data.length - 1; i >= 0; i--) {\n                  toImageData.data[i] = result[i];\n                }\n              }\n            }\n\n            _this2.debug('Draw tile');\n\n            if (NEED_SAFARI_FIX) {\n              // Safari draws thin white stripes between tiles without this fix\n              toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth + 1e-5, tile.toInnerHeight + 1e-5);\n            } else {\n              toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth, tile.toInnerHeight);\n            }\n\n            return null;\n          });\n        });\n      };\n\n      // Need to normalize data source first. It can be canvas or image.\n      // If image - try to decode in background if possible\n      return Promise.resolve().then(function () {\n        toCtx = to.getContext('2d', { alpha: Boolean(opts.alpha) });\n\n        if (utils.isCanvas(from)) {\n          srcCtx = from.getContext('2d', { alpha: Boolean(opts.alpha) });\n          return null;\n        }\n\n        if (utils.isImage(from)) {\n          // try do decode image in background for faster next operations\n          if (!CAN_CREATE_IMAGE_BITMAP) return null;\n\n          _this2.debug('Decode image via createImageBitmap');\n\n          return createImageBitmap(from).then(function (imageBitmap) {\n            srcImageBitmap = imageBitmap;\n          });\n        }\n\n        throw new Error('\".from\" should be image or canvas');\n      }).then(function () {\n        if (canceled) return cancelToken;\n\n        _this2.debug('Calculate tiles');\n\n        //\n        // Here we are with \"normalized\" source,\n        // follow to tiling\n        //\n\n        var regions = createRegions({\n          width: opts.width,\n          height: opts.height,\n          srcTileSize: _this2.options.tile,\n          toWidth: opts.toWidth,\n          toHeight: opts.toHeight,\n          destTileBorder: destTileBorder\n        });\n\n        var jobs = regions.map(function (tile) {\n          return processTile(tile);\n        });\n\n        function cleanup() {\n          if (srcImageBitmap) {\n            srcImageBitmap.close();\n            srcImageBitmap = null;\n          }\n        }\n\n        _this2.debug('Process tiles');\n\n        return Promise.all(jobs).then(function () {\n          _this2.debug('Finished!');\n          cleanup();return to;\n        }, function (err) {\n          cleanup();throw err;\n        });\n      });\n    };\n\n    var processStages = function processStages(stages, from, to, opts) {\n      if (canceled) return cancelToken;\n\n      var _stages$shift = stages.shift(),\n          _stages$shift2 = _slicedToArray(_stages$shift, 2),\n          toWidth = _stages$shift2[0],\n          toHeight = _stages$shift2[1];\n\n      var isLastStage = stages.length === 0;\n\n      opts = assign({}, opts, {\n        toWidth: toWidth,\n        toHeight: toHeight,\n        // only use user-defined quality for the last stage,\n        // use simpler (Hamming) filter for the first stages where\n        // scale factor is large enough (more than 2-3)\n        quality: isLastStage ? opts.quality : Math.min(1, opts.quality)\n      });\n\n      var tmpCanvas = void 0;\n\n      if (!isLastStage) {\n        // create temporary canvas\n        tmpCanvas = document.createElement('canvas');\n        tmpCanvas.width = toWidth;\n        tmpCanvas.height = toHeight;\n      }\n\n      return tileAndResize(from, isLastStage ? to : tmpCanvas, opts).then(function () {\n        if (isLastStage) return to;\n\n        opts.width = toWidth;\n        opts.height = toHeight;\n        return processStages(stages, tmpCanvas, to, opts);\n      });\n    };\n\n    var stages = createStages(opts.width, opts.height, opts.toWidth, opts.toHeight, _this2.options.tile, destTileBorder);\n\n    return processStages(stages, from, to, opts);\n  });\n};\n\n// RGBA buffer resize\n//\nPica.prototype.resizeBuffer = function (options) {\n  var _this3 = this;\n\n  var opts = assign({}, DEFAULT_RESIZE_OPTS, options);\n\n  return this.init().then(function () {\n    return _this3.__mathlib.resizeAndUnsharp(opts);\n  });\n};\n\nPica.prototype.toBlob = function (canvas, mimeType, quality) {\n  mimeType = mimeType || 'image/png';\n\n  return new Promise(function (resolve) {\n    if (canvas.toBlob) {\n      canvas.toBlob(function (blob) {\n        return resolve(blob);\n      }, mimeType, quality);\n      return;\n    }\n\n    // Fallback for old browsers\n    var asString = atob(canvas.toDataURL(mimeType, quality).split(',')[1]);\n    var len = asString.length;\n    var asBuffer = new Uint8Array(len);\n\n    for (var i = 0; i < len; i++) {\n      asBuffer[i] = asString.charCodeAt(i);\n    }\n\n    resolve(new Blob([asBuffer], { type: mimeType }));\n  });\n};\n\nPica.prototype.debug = function () {};\n\nmodule.exports = Pica;\n\n},{\"./lib/mathlib\":1,\"./lib/pool\":9,\"./lib/stepper\":10,\"./lib/tiler\":11,\"./lib/utils\":12,\"./lib/worker\":13,\"object-assign\":24,\"webworkify\":25}]},{},[])(\"/\")\n});\n","export const RESIZE_TYPE_SQUARE = 'square'\nexport const RESIZE_TYPE_TO = 'to'\n\nexport const MANIPULATION = 'MANIPULATION'\nexport const LOADER = 'LOADER'\nexport const FILTER = 'FILTER'\nexport const DRAW = 'DRAW'\n","import {loadBlob} from './loaders/loadBlob.js'\nimport {loadCanvas} from './loaders/loadCanvas.js'\nimport {imageCrop, imageResize} from './manipulations/imageResize.js'\nimport {rotate} from './manipulations/rotate.js'\nimport {centerInRectangle} from './manipulations/centerInRectangle.js'\nimport {circle} from './manipulations/circle.js'\nimport {grayscale} from './filters/grayscale.js'\nimport {pixelize} from './filters/pixelize.js'\nimport {gaussianBlur} from './filters/gaussianBlur.js'\nimport {asBlob} from './savers/asBlob'\nimport {asCanvas} from './savers/asCanvas'\nimport {asImage} from './savers/asImage'\nimport {drawLine, drawPolygon, drawRectangle, drawText} from './draw/draw'\nimport {perspective} from './manipulations/perspective'\n\nimport {RESIZE_TYPE_SQUARE, RESIZE_TYPE_TO, MANIPULATION, LOADER, FILTER, DRAW} from './constants'\n\nexport class ImageManipulation {\n    constructor () {\n        this._tasks = []\n\n        this._canvas = null\n        this._loadedCanvas = null\n        this._lastCanvas = null\n\n        this._fileName = null\n    }\n\n    /**\n     * @param imageFile{File}\n     * @returns {ImageManipulation}\n     */\n    loadBlob (imageFile) {\n        this._addToTask(LOADER, loadBlob(imageFile))\n        return this\n    }\n\n    /**\n     * @param canvas{HTMLCanvasElement}\n     * @param fileName{String}\n     * @returns {ImageManipulation}\n     */\n    loadCanvas (canvas, fileName = 'canvas.png') {\n        this._addToTask(LOADER, loadCanvas(canvas, fileName))\n        return this\n    }\n\n    /**\n     * @param maxWidth\n     * @param maxHeight\n     * @param type\n     * @param options\n     * @returns {ImageManipulation}\n     * @private\n     */\n    _imageResize (maxWidth = 200, maxHeight = 100, type = null, options = {}) {\n        this._addToTask(MANIPULATION, imageResize(maxWidth, maxHeight, type, options))\n        return this\n    }\n\n    /**\n     * @param length\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    toSquare (length = 150, opts = {}) {\n        return this._imageResize(length, length, RESIZE_TYPE_SQUARE, opts)\n    }\n\n    /**\n     * @param maxWidth {number} - width to crop to.\n     * @param maxHeight {number} - height to crop to.\n     * @param offsetX{number} - If specified, cropping will start from that offset on X axis,\n     * otherwise it will crop so result is centered in the source\n     * @param offsetY{number} - If specified, cropping will start from that offset on Y axis,\n     * otherwise it will crop so result is centered in the source\n     * @returns {ImageManipulation}\n     */\n    crop (maxWidth, maxHeight, offsetX, offsetY) {\n        this._addToTask(MANIPULATION, imageCrop(maxWidth, maxHeight, offsetX, offsetY))\n        return this\n    }\n\n    /**\n     *\n     * @param maxWidth\n     * @param maxHeight\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    resize (maxWidth = 200, maxHeight = 100, opts = {}) {\n        return this._imageResize(maxWidth, maxHeight, RESIZE_TYPE_TO, opts)\n    }\n\n    /**\n     *\n     * @param degrees\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    rotate (degrees, opts = {}) {\n        this._addToTask(MANIPULATION, rotate(degrees, opts))\n        return this\n    }\n\n    /**\n     *\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    toGrayscale (opts = {}) {\n        this._addToTask(FILTER, grayscale(opts))\n        return this\n    }\n\n    /**\n     *\n     * @param threshold{Number}\n     * @returns {ImageManipulation}\n     */\n    pixelize (threshold = 0.2) {\n        this._addToTask(FILTER, pixelize(threshold))\n        return this\n    }\n\n    /**\n     *\n     * @param radius{Number}\n     * @returns {ImageManipulation}\n     */\n    gaussianBlur (radius = 10) {\n        this._addToTask(FILTER, gaussianBlur(radius))\n        return this\n    }\n\n    /**\n     *\n     * @param width\n     * @param height\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    centerInRectangle (width = 200, height = 100, opts = {}) {\n        // resize\n        this._imageResize(width, height, RESIZE_TYPE_TO, opts)\n        // fit\n        this._addToTask(MANIPULATION, centerInRectangle(width, height, opts))\n        return this\n    }\n\n    /**\n     * @param diametr\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    toCircle (diametr = 150, opts = {}) {\n        // resize to square first\n        this._imageResize(diametr, diametr, RESIZE_TYPE_SQUARE, opts)\n        this._addToTask(MANIPULATION, circle(diametr, opts))\n        return this\n    }\n\n    /**\n     * @returns {Promise}\n     */\n    async _runTasks () {\n        this._canvas = null\n        for (let i = 0; i < this._tasks.length; i++) {\n            // if type loader, covert image to canvas and save in _loadedCanvas\n            if (this._tasks[i].type === LOADER) {\n                let data = await this._tasks[i].func()\n                this._loadedCanvas = data.canvas\n                if (data.fileName) {\n                    this._fileName = data.fileName;\n                }\n            } else {\n                if (this._canvas === null && this._loadedCanvas === null) {\n                    throw new Error('use loadBlob first')\n                }\n                this._canvas = await this._tasks[i].func(this._canvas || this._loadedCanvas)\n            }\n        }\n        this._cleanTasks()\n    }\n\n    /**\n     * @param type{String}\n     * @param func{Function}\n     * @private\n     */\n    _addToTask (type = 'manipulation', func) {\n        this._tasks.push({type, func})\n    }\n\n    _cleanTasks () {\n        this._tasks = []\n        // save last canvas\n        // for save image after all convert in same formats\n        if (this._canvas !== null) {\n            this._lastCanvas = this._canvas\n        }\n    }\n\n    /**\n     * @returns {HTMLCanvasElement}\n     */\n    getCanvas () {\n        return this._canvas || this._lastCanvas\n    }\n\n    /**\n     *\n     * @returns {String}\n     */\n    getFileName () {\n        return this._fileName\n    }\n\n    /**\n     *\n     * @param newFileName - New filename to be used in mime type definition\n     */\n    setFileName (newFileName) {\n        this._fileName = newFileName;\n    }\n\n    /**\n     * @param mimeType\n     * @param q\n     * @returns {Promise<File>}\n     */\n    saveAsBlob (mimeType = 'image/jpeg', q = '1.0') {\n        return this._runTasks().then(() => asBlob(this.getCanvas(), this.getFileName(), mimeType, q))\n    }\n\n    /**\n     * @returns {Promise<HTMLCanvasElement>}\n     */\n    saveAsCanvas () {\n        return this._runTasks().then(() => asCanvas(this.getCanvas()))\n    }\n\n    /**\n     * @param mimeType\n     * @param q\n     * @returns {Promise<HTMLImageElement.src>}\n     */\n    saveAsImage (mimeType = 'image/jpeg', q = '1.0') {\n        return this._runTasks().then(() => asImage(this.getCanvas(), mimeType, q))\n    }\n\n    /**\n     * @param points Sequence of [[x0, y0], [x1, y1] ...] or [x0, y0, x1, y1 ...]\n     * @param fill Color to use for the line\n     * @param width The line width, in pixels\n     * @returns {ImageManipulation}\n     */\n    drawLine (points = [], fill = 'green', width = 6) {\n        this._addToTask(DRAW, drawLine(points, fill, width))\n        return this\n    }\n\n    /**\n     * @param points Sequence of [[x0, y0], [x1, y1] ...] or [x0, y0, x1, y1 ...]\n     * @param fill Color to use for fill poly\n     * @param outline Color to use for the outline\n     * @param outlineWidth The outline width, in pixels\n     * @returns {ImageManipulation}\n     */\n    drawPolygon (points = [], fill = 'green', outline = 'red', outlineWidth = 6) {\n        this._addToTask(DRAW, drawPolygon(points, fill, outline, outlineWidth))\n        return this\n    }\n\n    /**\n     * @param points Sequence of [[left, bottom], [right, top]] or [left, bottom, right, top]\n     * @param fill null or color use for fill poly\n     * @param outline null or color to use for the outline\n     * @param outlineWidth The outline width, in pixels\n     * @returns {ImageManipulation}\n     */\n    drawRectangle (points = [], fill = null, outline = 'red', outlineWidth = 6) {\n        this._addToTask(DRAW, drawRectangle(points, fill, outline, outlineWidth))\n        return this\n    }\n\n    /**\n     * @param xy{Array}\n     * @param text{String}\n     * @param style{Object}\n     * @param style.font for example 'serif bold 16px'\n     * @param style.fontSize null or size in % or px\n     * @param style.fill null or color use for fill\n     * @param style.fillPadding null or color use for fill\n     * @param style.angle null or degrees for rotate text\n     * @returns {ImageManipulation}\n     */\n    drawText (xy = [], text = '', style = {}) {\n        this._addToTask(DRAW, drawText(xy, text, style))\n        return this\n    }\n\n    /**\n     * @param points - {xy0: [], xy1: [], xy2: [], xy3: []}\n     * @returns {ImageManipulation}\n     */\n    perspective (points) {\n        this._addToTask(MANIPULATION, perspective(points))\n        return this\n    }\n}\n","/*\n * JavaScript Canvas to Blob\n * https://github.com/blueimp/JavaScript-Canvas-to-Blob\n *\n * Copyright 2012, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n *\n * Based on stackoverflow user Stoive's code snippet:\n * http://stackoverflow.com/q/4998908\n */\n\n/* global atob, Blob, define */\n\n;(function (window) {\n  'use strict'\n\n  var CanvasPrototype =\n    window.HTMLCanvasElement && window.HTMLCanvasElement.prototype\n  var hasBlobConstructor =\n    window.Blob &&\n    (function () {\n      try {\n        return Boolean(new Blob())\n      } catch (e) {\n        return false\n      }\n    })()\n  var hasArrayBufferViewSupport =\n    hasBlobConstructor &&\n    window.Uint8Array &&\n    (function () {\n      try {\n        return new Blob([new Uint8Array(100)]).size === 100\n      } catch (e) {\n        return false\n      }\n    })()\n  var BlobBuilder =\n    window.BlobBuilder ||\n    window.WebKitBlobBuilder ||\n    window.MozBlobBuilder ||\n    window.MSBlobBuilder\n  var dataURIPattern = /^data:((.*?)(;charset=.*?)?)(;base64)?,/\n  var dataURLtoBlob =\n    (hasBlobConstructor || BlobBuilder) &&\n    window.atob &&\n    window.ArrayBuffer &&\n    window.Uint8Array &&\n    function (dataURI) {\n      var matches,\n        mediaType,\n        isBase64,\n        dataString,\n        byteString,\n        arrayBuffer,\n        intArray,\n        i,\n        bb\n      // Parse the dataURI components as per RFC 2397\n      matches = dataURI.match(dataURIPattern)\n      if (!matches) {\n        throw new Error('invalid data URI')\n      }\n      // Default to text/plain;charset=US-ASCII\n      mediaType = matches[2]\n        ? matches[1]\n        : 'text/plain' + (matches[3] || ';charset=US-ASCII')\n      isBase64 = !!matches[4]\n      dataString = dataURI.slice(matches[0].length)\n      if (isBase64) {\n        // Convert base64 to raw binary data held in a string:\n        byteString = atob(dataString)\n      } else {\n        // Convert base64/URLEncoded data component to raw binary:\n        byteString = decodeURIComponent(dataString)\n      }\n      // Write the bytes of the string to an ArrayBuffer:\n      arrayBuffer = new ArrayBuffer(byteString.length)\n      intArray = new Uint8Array(arrayBuffer)\n      for (i = 0; i < byteString.length; i += 1) {\n        intArray[i] = byteString.charCodeAt(i)\n      }\n      // Write the ArrayBuffer (or ArrayBufferView) to a blob:\n      if (hasBlobConstructor) {\n        return new Blob([hasArrayBufferViewSupport ? intArray : arrayBuffer], {\n          type: mediaType\n        })\n      }\n      bb = new BlobBuilder()\n      bb.append(arrayBuffer)\n      return bb.getBlob(mediaType)\n    }\n  if (window.HTMLCanvasElement && !CanvasPrototype.toBlob) {\n    if (CanvasPrototype.mozGetAsFile) {\n      CanvasPrototype.toBlob = function (callback, type, quality) {\n        var self = this\n        setTimeout(function () {\n          if (quality && CanvasPrototype.toDataURL && dataURLtoBlob) {\n            callback(dataURLtoBlob(self.toDataURL(type, quality)))\n          } else {\n            callback(self.mozGetAsFile('blob', type))\n          }\n        })\n      }\n    } else if (CanvasPrototype.toDataURL && dataURLtoBlob) {\n      CanvasPrototype.toBlob = function (callback, type, quality) {\n        var self = this\n        setTimeout(function () {\n          callback(dataURLtoBlob(self.toDataURL(type, quality)))\n        })\n      }\n    }\n  }\n  if (typeof define === 'function' && define.amd) {\n    define(function () {\n      return dataURLtoBlob\n    })\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = dataURLtoBlob\n  } else {\n    window.dataURLtoBlob = dataURLtoBlob\n  }\n})(window)\n","import 'regenerator-runtime/runtime'\nimport {ImageManipulation} from './src/ImageManipulation.js'\nimport 'blueimp-canvas-to-blob'\n\nif (typeof window !== 'undefined') {\n    window.BrowserImageManipulation = ImageManipulation\n}\n\nexport default ImageManipulation\n"],"names":["loadBlob","imageFile","Promise","resolve","reject","image","document","createElement","reader","FileReader","onload","data","src","target","result","onerror","Error","canvas","width","height","getContext","drawImage","fileName","name","readAsDataURL","loadCanvas","imageCrop","newWidth","newHeight","offsetX","offsetY","canvasImage","sx","sy","cropedCanvas","cropedCanvasCtx","imageResize","maxWidth","maxHeight","type","options","resizeOptions","Object","assign","outputCanvas","ratio","RESIZE_TYPE_SQUARE","RESIZE_TYPE_TO","ratioWidth","ratioHeight","Math","round","Pica","resize","pica","then","resizedCanvas","degreesToRadian","degrees","PI","rotate","opts","padding","bgColor","calcAngle","degreesRad","calcAngleRad","angleRad","sinCos","cos","sin","key","cosAngle","cosCalcAngle","sinAngle","sinCalcAngle","ctx","beginPath","rect","fillStyle","fill","save","translate","restore","centerInRectangle","dx","dy","circle","diametr","paddingSize","halfSize","arc","closePath","clip","grayscale","rQ","gQ","bQ","imageData","getImageData","i","length","brightness","putImageData","pixelize","threshold","smallW","smallH","disableSmooth","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","imageSmoothingEnabled","_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","getImageDataFromCanvas","topX","topY","getElementById","context","e","processCanvasRGBA","radius","isNaN","processImageDataRGBA","x","y","p","yp","yi","yw","rSum","gSum","bSum","aSum","rOutSum","gOutSum","bOutSum","aOutSum","rInSum","gInSum","bInSum","aInSum","pr","pg","pb","pa","rbs","stackEnd","pixels","div","widthMinus1","heightMinus1","radiusPlus1","sumFactor","stackStart","BlurStack","stack","next","stackIn","stackOut","mulSum","mulTable","shgSum","shgTable","r","g","b","a","gaussianBlur","fileExtByMimeType","mimeType","tmp","split","ext","indexOf","pop","push","join","asBlob","q","toBlob","blob","fileOfBlob","Blob","asCanvas","asImage","toDataURL","pointsTo2DArray","points","out","Array","isArray","lastIndex","drawLine","points2d","moveTo","lineTo","strokeStyle","lineWidth","stroke","drawPolygon","outline","outlineWidth","drawRectangle","left","bottom","right","top","drawText","xy","text","font","fontSize","fillPadding","rotateAngle","canvasMaskImage","radians","floor","parseFloat","fontSizeInPx","trim","parseInt","measureText","metrics","actualBoundingBoxAscent","actualBoundingBoxDescent","fillPaddingInPx","fillText","perspective","warpPoints","ctxDestination","xy0","xy1","xy2","xy3","convertRelativePointsToAbsolute","ctxOut","createCanvasContext","ctxTransformed","baseIndex","getBaseIndex","clearRect","step","convertRelativePointValue","point","sizeSize","toString","w","h","d0x","d0y","d1x","d1y","d2x","d2y","d3x","d3y","dims","sqrt","pow","maxScaleRate","zeroNum","rate","transformSide","sideSize","otherSizeSize","coverStep","ctxWide","globalCompositeOperation","ex","ey","ag","atan","sc","setTransform","scale","applyMask","global","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","create","Context","_invoke","makeInvokeMethod","tryCatch","fn","arg","call","err","GeneratorFunction","GeneratorFunctionPrototype","defineIteratorMethods","forEach","method","this","AsyncIterator","invoke","record","value","hasOwn","__await","unwrapped","enqueue","callInvokeWithMethodAndArg","previousPromise","state","GenStateSuspendedStart","GenStateExecuting","GenStateCompleted","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","done","GenStateSuspendedYield","undefined","return","info","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","values","iterable","iteratorMethod","iteratorSymbol","Op","hasOwnProperty","$Symbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","runtime","regeneratorRuntime","module","exports","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","Gp","displayName","isGeneratorFunction","genFun","ctor","mark","setPrototypeOf","__proto__","awrap","async","iter","keys","object","reverse","skipTempReset","prev","charAt","slice","stop","rootEntry","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","catch","thrown","delegateYield","Function","f","n","t","o","c","require","u","code","1","MathLib","requested_features","__requested_features","features","js","wasm","Multimath","has_wasm","use","mm_unsharp_mask","mm_resize","inherits","resizeAndUnsharp","cache","unsharpAmount","unsharp_mask","toWidth","toHeight","unsharpRadius","unsharpThreshold","./mm_resize","multimath","multimath/lib/unsharp_mask","2","clampTo8","convolveHorizontally","dest","srcW","srcH","destW","filters","filterPtr","filterShift","filterSize","srcPtr","srcY","destX","filterVal","srcOffset","destOffset","convolveVertically","3","4","wasm_fn","wasm_src","./convolve_wasm_base64","./resize","./resize_wasm","5","resetAlpha","dst","ptr","len","createFilters","destH","scaleX","scaleY","Uint8Array","quality","alpha","filtersX","filtersY","./convolve","./resize_filter_gen","6","toFixedPoint","num","FIXED_FRAC_BITS","FILTER_INFO","srcSize","destSize","offset","destPixel","srcPixel","srcFirst","srcLast","filterElementSize","floatFilter","fxpFilter","total","pxl","idx","floatVal","filterTotal","leftNotEmpty","rightNotEmpty","filterFunction","filter","scaleInverted","scaleClamped","min","srcWindow","win","maxFilterElementSize","packedFilter","Int16Array","packedFilterPtr","slowCopy","subarray","set","max","ceil","Float32Array","./resize_filter_info","7","xpi","8","asUint8Array","buffer","byteLength","copyInt16asLE","target_offset","IS_LE","Uint32Array","__","tmp_offset","__align","filtersX_offset","filtersY_offset","alloc_bytes","__instance","mem","__memory","mem32","src32","convolveHV","_convolveHV","9","Pool","idle","available","acquired","lastId","timeoutId","acquire","_this","resource","id","release","_this2","lastUsed","Date","now","setTimeout","gc","_this3","destroy","10","fromWidth","fromHeight","srcTileSize","destTileBorder","minScale","stageCount","log","11","pixelFloor","nearest","abs","PIXEL_EPSILON","pixelCeil","innerTileWidth","innerTileHeight","innerX","innerY","toTileWidth","toTileHeight","tile","tiles","toX","toY","toInnerX","toInnerY","toInnerWidth","toInnerHeight","12","objClass","isCanvas","element","cname","isImage","limiter","concurrency","roll","active","queue","shift","cib_quality_name","cib_support","createImageBitmap","resizeWidth","resizeHeight","resizeQuality","bitmap","status","close","13","mathLib","onmessage","ev","postMessage","./mathlib","14","gaussCoef","sigma","exp","g1","g2","k","a0","a1","a2","a3","b1","b2","left_corner","right_corner","convolveMono16","line","coeff","prev_src","curr_src","curr_out","prev_out","prev_prev_out","src_index","out_index","line_index","j","coeff_a0","coeff_a1","coeff_b1","coeff_b2","blurMono16","Uint16Array","tmp_line","15","superCtor","super_","enumerable","writable","configurable","TempCtor","16","MultiMath","DEFAULT_OPTIONS","__cache","hasWebAssembly","__init_promise","__modules","modules","__wasm","__isLE","base64decode","init","all","map","WebAssembly","compile","__base64decode","m","__reallocate","bytes","Memory","initial","mem_size","grow","memsize","env_extra","Module","env_base","memoryBase","memory","tableBase","table","Table","Instance","env","number","base","reminder","./lib/base64decode","./lib/wa_detect","object-assign","17","str","input","replace","bits","tailbits","18","img","size","19","./unsharp_mask","./unsharp_mask_wasm","./unsharp_mask_wasm_base64","20","glur_mono16","hsl_l16","amount","s","l","m1","m2","hShifted","diff","iTimes4","lightness","blured","amountFp","thresholdFp","./hsl_l16","glur/mono16","21","img_bytes_cnt","hsl_bytes_cnt","blur_bytes_cnt","blur_line_byte_cnt","hsl_offset","blur_offset","blur_tmp_offset","blur_line_offset","blur_coeffs_offset","img32","_hsl_l16","_blurMono16","unsharp","_unsharp","22","23","wa","bin","test","24","toObject","val","getOwnPropertySymbols","propIsEnumerable","propertyIsEnumerable","test1","String","getOwnPropertyNames","test2","fromCharCode","test3","letter","source","from","symbols","to","arguments","25","bundleFn","sources","stringify","JSON","resolveSources","workerSources","depPath","depKey","wkey","cacheKeys","default","random","wcache","skey","scache","URL","window","webkitURL","mozURL","msURL","bare","workerUrl","createObjectURL","worker","Worker","objectURL","/","workerFabric","webworkify","terminate","url","revokeObjectURL","DEFAULT_PICA_OPTS","limiter_key","__limit","singletones","utils","cib","ww","__workersPool","__mathlib","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","createStages","createRegions","NEED_SAFARI_FIX","navigator","userAgent","hardwareConcurrency","DEFAULT_RESIZE_OPTS","CAN_NEW_IMAGE_DATA","CAN_CREATE_IMAGE_BITMAP","__initPromise","ImageData","Uint8ClampedArray","ImageBitmap","debug","wpool_key","initMath","mathlib","checkCibResize","naturalWidth","naturalHeight","canceled","cancelToken","toCtx","Boolean","imageBitmap","tmpCanvas","tmpCtx","iData","invokeResize","preload","wasm_nodule","tileAndResize","srcCtx","srcImageBitmap","processTile","srcImageData","toImageData","createImageData","cleanup","regions","jobs","stages","processStages","_stages$shift","_stages$shift2","isLastStage","resizeBuffer","asString","atob","asBuffer","charCodeAt","./lib/mathlib","./lib/pool","./lib/stepper","./lib/tiler","./lib/utils","./lib/worker","ImageManipulation","_tasks","_canvas","_loadedCanvas","_lastCanvas","_fileName","_addToTask","_imageResize","func","_cleanTasks","newFileName","_runTasks","getCanvas","getFileName","style","CanvasPrototype","HTMLCanvasElement","hasBlobConstructor","hasArrayBufferViewSupport","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","dataURIPattern","dataURLtoBlob","ArrayBuffer","dataURI","matches","mediaType","isBase64","dataString","byteString","arrayBuffer","intArray","bb","match","decodeURIComponent","append","getBlob","mozGetAsFile","callback","BrowserImageManipulation"],"mappings":"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IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAClwCE,GAAY,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GA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"}