{"version":3,"file":"browser-image-manipulation.js","sources":["../src/helpers/degreesToRadian.js","../node_modules/regenerator-runtime/runtime.js","../src/loaders/loadBlob.js","../node_modules/pica/dist/pica.js","../src/manipulations/imageResize.js","../src/constants.js","../src/manipulations/rotate.js","../src/manipulations/centerInRectangle.js","../src/manipulations/circle.js","../src/filters/grayscale.js","../src/helpers/fileExtByMimeType.js","../src/savers/asBlob.js","../src/savers/asCanvas.js","../src/savers/asImage.js","../src/ImageManipulation.js","../src/index.js"],"sourcesContent":["/**\n * @param degrees{number}\n * @returns {number}\n */\nexport default function degreesToRadian (degrees) {\n    return degrees * (Math.PI / 180)\n}\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  runtime.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  runtime.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        if (delegate.iterator.return) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // In sloppy mode, unbound `this` refers to the global object, fallback to\n  // Function constructor if we're in global strict mode. That is sadly a form\n  // of indirect eval which violates Content Security Policy.\n  (function() { return this })() || Function(\"return this\")()\n);\n","/**\n * @param imageFile{File}\n * @returns {function(): Promise<HTMLCanvasElement>}\n */\nexport default function (imageFile) {\n    return () => new Promise((resolve, reject) => {\n        let image = document.createElement('img')\n        let reader = new FileReader()\n        reader.onload = (data) => {\n            image.src = data.target.result\n        }\n        image.onload = (data) => {\n            let canvas = document.createElement('canvas')\n            canvas.width = image.width\n            canvas.height = image.height\n            let ctx = canvas.getContext('2d')\n            ctx.drawImage(image, 0, 0, canvas.width, canvas.height)\n            resolve({canvas, fileName: imageFile.name})\n        }\n        reader.readAsDataURL(imageFile)\n    })\n}\n","/* pica 4.1.1 nodeca/pica */(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.pica = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n// Collection of math functions\n//\n// 1. Combine components together\n// 2. Has async init to load wasm modules\n//\n'use strict';\n\nvar inherits = require('inherits');\nvar Multimath = require('multimath');\n\nvar mm_unsharp_mask = require('multimath/lib/unsharp_mask');\nvar mm_resize = require('./mm_resize');\n\nfunction MathLib(requested_features) {\n  var __requested_features = requested_features || [];\n\n  var features = {\n    js: __requested_features.indexOf('js') >= 0,\n    wasm: __requested_features.indexOf('wasm') >= 0\n  };\n\n  Multimath.call(this, features);\n\n  this.features = {\n    js: features.js,\n    wasm: features.wasm && this.has_wasm\n  };\n\n  this.use(mm_unsharp_mask);\n  this.use(mm_resize);\n}\n\ninherits(MathLib, Multimath);\n\nMathLib.prototype.resizeAndUnsharp = function resizeAndUnsharp(options, cache) {\n  var result = this.resize(options, cache);\n\n  if (options.unsharpAmount) {\n    this.unsharp_mask(result, options.toWidth, options.toHeight, options.unsharpAmount, options.unsharpRadius, options.unsharpThreshold);\n  }\n\n  return result;\n};\n\nmodule.exports = MathLib;\n\n},{\"./mm_resize\":4,\"inherits\":15,\"multimath\":16,\"multimath/lib/unsharp_mask\":19}],2:[function(require,module,exports){\n// Resize convolvers, pure JS implementation\n//\n'use strict';\n\n// Precision of fixed FP values\n//var FIXED_FRAC_BITS = 14;\n\n\nfunction clampTo8(i) {\n  return i < 0 ? 0 : i > 255 ? 255 : i;\n}\n\n// Convolve image in horizontal directions and transpose output. In theory,\n// transpose allow:\n//\n// - use the same convolver for both passes (this fails due different\n//   types of input array and temporary buffer)\n// - making vertical pass by horisonltal lines inprove CPU cache use.\n//\n// But in real life this doesn't work :)\n//\nfunction convolveHorizontally(src, dest, srcW, srcH, destW, filters) {\n\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0;\n\n  // For each row\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0;\n\n    // Apply precomputed filters to each destination row point\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n\n      srcPtr = srcOffset + filterShift * 4 | 0;\n\n      r = g = b = a = 0;\n\n      // Apply the filter to the row to get the destination pixel r, g, b, a\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++];\n\n        // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      }\n\n      // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n}\n\n// Technically, convolvers are the same. But input array and temporary\n// buffer can be of different type (especially, in old browsers). So,\n// keep code in separate functions to avoid deoptimizations & speed loss.\n\nfunction convolveVertically(src, dest, srcW, srcH, destW, filters) {\n\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0;\n\n  // For each row\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0;\n\n    // Apply precomputed filters to each destination row point\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n\n      srcPtr = srcOffset + filterShift * 4 | 0;\n\n      r = g = b = a = 0;\n\n      // Apply the filter to the row to get the destination pixel r, g, b, a\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++];\n\n        // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      }\n\n      // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14 /*FIXED_FRAC_BITS*/);\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n}\n\nmodule.exports = {\n  convolveHorizontally: convolveHorizontally,\n  convolveVertically: convolveVertically\n};\n\n},{}],3:[function(require,module,exports){\n// This is autogenerated file from math.wasm, don't edit.\n//\n'use strict';\n\n/* eslint-disable max-len */\n\nmodule.exports = 'AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw==';\n\n},{}],4:[function(require,module,exports){\n'use strict';\n\nmodule.exports = {\n  name: 'resize',\n  fn: require('./resize'),\n  wasm_fn: require('./resize_wasm'),\n  wasm_src: require('./convolve_wasm_base64')\n};\n\n},{\"./convolve_wasm_base64\":3,\"./resize\":5,\"./resize_wasm\":8}],5:[function(require,module,exports){\n'use strict';\n\nvar createFilters = require('./resize_filter_gen');\nvar convolveHorizontally = require('./convolve').convolveHorizontally;\nvar convolveVertically = require('./convolve').convolveVertically;\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n  while (ptr < len) {\n    dst[ptr] = 0xFF;ptr = ptr + 4 | 0;\n  }\n}\n\nmodule.exports = function resize(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0;\n  var offsetY = options.offsetY || 0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY);\n\n  var tmp = new Uint8Array(destW * srcH * 4);\n\n  // To use single function we need src & tmp of the same type.\n  // But src can be CanvasPixelArray, and tmp - Uint8Array. So, keep\n  // vertical and horizontal passes separately to avoid deoptimization.\n\n  convolveHorizontally(src, tmp, srcW, srcH, destW, filtersX);\n  convolveVertically(tmp, dest, srcH, destW, destH, filtersY);\n\n  // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n\n  return dest;\n};\n\n},{\"./convolve\":2,\"./resize_filter_gen\":6}],6:[function(require,module,exports){\n// Calculate convolution filters for each destination point,\n// and pack data to Int16Array:\n//\n// [ shift, length, data..., shift2, length2, data..., ... ]\n//\n// - shift - offset in src image\n// - length - filter length (in src points)\n// - data - filter values sequence\n//\n'use strict';\n\nvar FILTER_INFO = require('./resize_filter_info');\n\n// Precision of fixed FP values\nvar FIXED_FRAC_BITS = 14;\n\nfunction toFixedPoint(num) {\n  return Math.round(num * ((1 << FIXED_FRAC_BITS) - 1));\n}\n\nmodule.exports = function resizeFilterGen(quality, srcSize, destSize, scale, offset) {\n\n  var filterFunction = FILTER_INFO[quality].filter;\n\n  var scaleInverted = 1.0 / scale;\n  var scaleClamped = Math.min(1.0, scale); // For upscale\n\n  // Filter window (averaging interval), scaled to src image\n  var srcWindow = FILTER_INFO[quality].win / scaleClamped;\n\n  var destPixel, srcPixel, srcFirst, srcLast, filterElementSize, floatFilter, fxpFilter, total, pxl, idx, floatVal, filterTotal, filterVal;\n  var leftNotEmpty, rightNotEmpty, filterShift, filterSize;\n\n  var maxFilterElementSize = Math.floor((srcWindow + 1) * 2);\n  var packedFilter = new Int16Array((maxFilterElementSize + 2) * destSize);\n  var packedFilterPtr = 0;\n\n  var slowCopy = !packedFilter.subarray || !packedFilter.set;\n\n  // For each destination pixel calculate source range and built filter values\n  for (destPixel = 0; destPixel < destSize; destPixel++) {\n\n    // Scaling should be done relative to central pixel point\n    srcPixel = (destPixel + 0.5) * scaleInverted + offset;\n\n    srcFirst = Math.max(0, Math.floor(srcPixel - srcWindow));\n    srcLast = Math.min(srcSize - 1, Math.ceil(srcPixel + srcWindow));\n\n    filterElementSize = srcLast - srcFirst + 1;\n    floatFilter = new Float32Array(filterElementSize);\n    fxpFilter = new Int16Array(filterElementSize);\n\n    total = 0.0;\n\n    // Fill filter values for calculated range\n    for (pxl = srcFirst, idx = 0; pxl <= srcLast; pxl++, idx++) {\n      floatVal = filterFunction((pxl + 0.5 - srcPixel) * scaleClamped);\n      total += floatVal;\n      floatFilter[idx] = floatVal;\n    }\n\n    // Normalize filter, convert to fixed point and accumulate conversion error\n    filterTotal = 0;\n\n    for (idx = 0; idx < floatFilter.length; idx++) {\n      filterVal = floatFilter[idx] / total;\n      filterTotal += filterVal;\n      fxpFilter[idx] = toFixedPoint(filterVal);\n    }\n\n    // Compensate normalization error, to minimize brightness drift\n    fxpFilter[destSize >> 1] += toFixedPoint(1.0 - filterTotal);\n\n    //\n    // Now pack filter to useable form\n    //\n    // 1. Trim heading and tailing zero values, and compensate shitf/length\n    // 2. Put all to single array in this format:\n    //\n    //    [ pos shift, data length, value1, value2, value3, ... ]\n    //\n\n    leftNotEmpty = 0;\n    while (leftNotEmpty < fxpFilter.length && fxpFilter[leftNotEmpty] === 0) {\n      leftNotEmpty++;\n    }\n\n    if (leftNotEmpty < fxpFilter.length) {\n      rightNotEmpty = fxpFilter.length - 1;\n      while (rightNotEmpty > 0 && fxpFilter[rightNotEmpty] === 0) {\n        rightNotEmpty--;\n      }\n\n      filterShift = srcFirst + leftNotEmpty;\n      filterSize = rightNotEmpty - leftNotEmpty + 1;\n\n      packedFilter[packedFilterPtr++] = filterShift; // shift\n      packedFilter[packedFilterPtr++] = filterSize; // size\n\n      if (!slowCopy) {\n        packedFilter.set(fxpFilter.subarray(leftNotEmpty, rightNotEmpty + 1), packedFilterPtr);\n        packedFilterPtr += filterSize;\n      } else {\n        // fallback for old IE < 11, without subarray/set methods\n        for (idx = leftNotEmpty; idx <= rightNotEmpty; idx++) {\n          packedFilter[packedFilterPtr++] = fxpFilter[idx];\n        }\n      }\n    } else {\n      // zero data, write header only\n      packedFilter[packedFilterPtr++] = 0; // shift\n      packedFilter[packedFilterPtr++] = 0; // size\n    }\n  }\n  return packedFilter;\n};\n\n},{\"./resize_filter_info\":7}],7:[function(require,module,exports){\n// Filter definitions to build tables for\n// resizing convolvers.\n//\n// Presets for quality 0..3. Filter functions + window size\n//\n'use strict';\n\nmodule.exports = [{ // Nearest neibor (Box)\n  win: 0.5,\n  filter: function filter(x) {\n    return x >= -0.5 && x < 0.5 ? 1.0 : 0.0;\n  }\n}, { // Hamming\n  win: 1.0,\n  filter: function filter(x) {\n    if (x <= -1.0 || x >= 1.0) {\n      return 0.0;\n    }\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * (0.54 + 0.46 * Math.cos(xpi / 1.0));\n  }\n}, { // Lanczos, win = 2\n  win: 2.0,\n  filter: function filter(x) {\n    if (x <= -2.0 || x >= 2.0) {\n      return 0.0;\n    }\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 2.0) / (xpi / 2.0);\n  }\n}, { // Lanczos, win = 3\n  win: 3.0,\n  filter: function filter(x) {\n    if (x <= -3.0 || x >= 3.0) {\n      return 0.0;\n    }\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 3.0) / (xpi / 3.0);\n  }\n}];\n\n},{}],8:[function(require,module,exports){\n'use strict';\n\nvar createFilters = require('./resize_filter_gen');\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n  while (ptr < len) {\n    dst[ptr] = 0xFF;ptr = ptr + 4 | 0;\n  }\n}\n\nfunction asUint8Array(src) {\n  return new Uint8Array(src.buffer, 0, src.byteLength);\n}\n\nvar IS_LE = true;\n// should not crash everything on module load in old browsers\ntry {\n  IS_LE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n} catch (__) {}\n\nfunction copyInt16asLE(src, target, target_offset) {\n  if (IS_LE) {\n    target.set(asUint8Array(src), target_offset);\n    return;\n  }\n\n  for (var ptr = target_offset, i = 0; i < src.length; i++) {\n    var data = src[i];\n    target[ptr++] = data & 0xFF;\n    target[ptr++] = data >> 8 & 0xFF;\n  }\n}\n\nmodule.exports = function resize_wasm(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0.0;\n  var offsetY = options.offsetY || 0.0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY);\n\n  // destination is 0 too.\n  var src_offset = 0;\n  // buffer between convolve passes\n  var tmp_offset = this.__align(src_offset + Math.max(src.byteLength, dest.byteLength));\n  var filtersX_offset = this.__align(tmp_offset + srcH * destW * 4);\n  var filtersY_offset = this.__align(filtersX_offset + filtersX.byteLength);\n  var alloc_bytes = filtersY_offset + filtersY.byteLength;\n\n  var instance = this.__instance('resize', alloc_bytes);\n\n  //\n  // Fill memory block with data to process\n  //\n\n  var mem = new Uint8Array(this.__memory.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer);\n\n  // 32-bit copy is much faster in chrome\n  var src32 = new Uint32Array(src.buffer);\n  mem32.set(src32);\n\n  // We should guarantee LE bytes order. Filters are not big, so\n  // speed difference is not significant vs direct .set()\n  copyInt16asLE(filtersX, mem, filtersX_offset);\n  copyInt16asLE(filtersY, mem, filtersY_offset);\n\n  //\n  // Now call webassembly method\n  // emsdk does method names with '_'\n  var fn = instance.exports.convolveHV || instance.exports._convolveHV;\n\n  fn(filtersX_offset, filtersY_offset, tmp_offset, srcW, srcH, destW, destH);\n\n  //\n  // Copy data back to typed array\n  //\n\n  // 32-bit copy is much faster in chrome\n  var dest32 = new Uint32Array(dest.buffer);\n  dest32.set(new Uint32Array(this.__memory.buffer, 0, destH * destW));\n\n  // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n\n  return dest;\n};\n\n},{\"./resize_filter_gen\":6}],9:[function(require,module,exports){\n'use strict';\n\nvar GC_INTERVAL = 100;\n\nfunction Pool(create, idle) {\n  this.create = create;\n\n  this.available = [];\n  this.acquired = {};\n  this.lastId = 1;\n\n  this.timeoutId = 0;\n  this.idle = idle || 2000;\n}\n\nPool.prototype.acquire = function () {\n  var _this = this;\n\n  var resource = void 0;\n\n  if (this.available.length !== 0) {\n    resource = this.available.pop();\n  } else {\n    resource = this.create();\n    resource.id = this.lastId++;\n    resource.release = function () {\n      return _this.release(resource);\n    };\n  }\n  this.acquired[resource.id] = resource;\n  return resource;\n};\n\nPool.prototype.release = function (resource) {\n  var _this2 = this;\n\n  delete this.acquired[resource.id];\n\n  resource.lastUsed = Date.now();\n  this.available.push(resource);\n\n  if (this.timeoutId === 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this2.gc();\n    }, GC_INTERVAL);\n  }\n};\n\nPool.prototype.gc = function () {\n  var _this3 = this;\n\n  var now = Date.now();\n\n  this.available = this.available.filter(function (resource) {\n    if (now - resource.lastUsed > _this3.idle) {\n      resource.destroy();\n      return false;\n    }\n    return true;\n  });\n\n  if (this.available.length !== 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this3.gc();\n    }, GC_INTERVAL);\n  } else {\n    this.timeoutId = 0;\n  }\n};\n\nmodule.exports = Pool;\n\n},{}],10:[function(require,module,exports){\n// Add intermediate resizing steps when scaling down by a very large factor.\n//\n// For example, when resizing 10000x10000 down to 10x10, it'll resize it to\n// 300x300 first.\n//\n// It's needed because tiler has issues when the entire tile is scaled down\n// to a few pixels (1024px source tile with border size 3 should result in\n// at least 3+3+2 = 8px target tile, so max scale factor is 128 here).\n//\n// Also, adding intermediate steps can speed up processing if we use lower\n// quality algorithms for first stages.\n//\n\n'use strict';\n\n// min size = 0 results in infinite loop,\n// min size = 1 can consume large amount of memory\n\nvar MIN_INNER_TILE_SIZE = 2;\n\nmodule.exports = function createStages(fromWidth, fromHeight, toWidth, toHeight, srcTileSize, destTileBorder) {\n  var scaleX = toWidth / fromWidth;\n  var scaleY = toHeight / fromHeight;\n\n  // derived from createRegions equation:\n  // innerTileWidth = pixelFloor(srcTileSize * scaleX) - 2 * destTileBorder;\n  var minScale = (2 * destTileBorder + MIN_INNER_TILE_SIZE + 1) / srcTileSize;\n\n  // refuse to scale image multiple times by less than twice each time,\n  // it could only happen because of invalid options\n  if (minScale > 0.5) return [[toWidth, toHeight]];\n\n  var stageCount = Math.ceil(Math.log(Math.min(scaleX, scaleY)) / Math.log(minScale));\n\n  // no additional resizes are necessary,\n  // stageCount can be zero or be negative when enlarging the image\n  if (stageCount <= 1) return [[toWidth, toHeight]];\n\n  var result = [];\n\n  for (var i = 0; i < stageCount; i++) {\n    var width = Math.round(Math.pow(Math.pow(fromWidth, stageCount - i - 1) * Math.pow(toWidth, i + 1), 1 / stageCount));\n\n    var height = Math.round(Math.pow(Math.pow(fromHeight, stageCount - i - 1) * Math.pow(toHeight, i + 1), 1 / stageCount));\n\n    result.push([width, height]);\n  }\n\n  return result;\n};\n\n},{}],11:[function(require,module,exports){\n// Split original image into multiple 1024x1024 chunks to reduce memory usage\n// (images have to be unpacked into typed arrays for resizing) and allow\n// parallel processing of multiple tiles at a time.\n//\n\n'use strict';\n\n/*\n * pixelFloor and pixelCeil are modified versions of Math.floor and Math.ceil\n * functions which take into account floating point arithmetic errors.\n * Those errors can cause undesired increments/decrements of sizes and offsets:\n * Math.ceil(36 / (36 / 500)) = 501\n * pixelCeil(36 / (36 / 500)) = 500\n */\n\nvar PIXEL_EPSILON = 1e-5;\n\nfunction pixelFloor(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n  return Math.floor(x);\n}\n\nfunction pixelCeil(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n  return Math.ceil(x);\n}\n\nmodule.exports = function createRegions(options) {\n  var scaleX = options.toWidth / options.width;\n  var scaleY = options.toHeight / options.height;\n\n  var innerTileWidth = pixelFloor(options.srcTileSize * scaleX) - 2 * options.destTileBorder;\n  var innerTileHeight = pixelFloor(options.srcTileSize * scaleY) - 2 * options.destTileBorder;\n\n  // prevent infinite loop, this should never happen\n  if (innerTileWidth < 1 || innerTileHeight < 1) {\n    throw new Error('Internal error in pica: target tile width/height is too small.');\n  }\n\n  var x, y;\n  var innerX, innerY, toTileWidth, toTileHeight;\n  var tiles = [];\n  var tile;\n\n  // we go top-to-down instead of left-to-right to make image displayed from top to\n  // doesn in the browser\n  for (innerY = 0; innerY < options.toHeight; innerY += innerTileHeight) {\n    for (innerX = 0; innerX < options.toWidth; innerX += innerTileWidth) {\n      x = innerX - options.destTileBorder;\n      if (x < 0) {\n        x = 0;\n      }\n      toTileWidth = innerX + innerTileWidth + options.destTileBorder - x;\n      if (x + toTileWidth >= options.toWidth) {\n        toTileWidth = options.toWidth - x;\n      }\n\n      y = innerY - options.destTileBorder;\n      if (y < 0) {\n        y = 0;\n      }\n      toTileHeight = innerY + innerTileHeight + options.destTileBorder - y;\n      if (y + toTileHeight >= options.toHeight) {\n        toTileHeight = options.toHeight - y;\n      }\n\n      tile = {\n        toX: x,\n        toY: y,\n        toWidth: toTileWidth,\n        toHeight: toTileHeight,\n\n        toInnerX: innerX,\n        toInnerY: innerY,\n        toInnerWidth: innerTileWidth,\n        toInnerHeight: innerTileHeight,\n\n        offsetX: x / scaleX - pixelFloor(x / scaleX),\n        offsetY: y / scaleY - pixelFloor(y / scaleY),\n        scaleX: scaleX,\n        scaleY: scaleY,\n\n        x: pixelFloor(x / scaleX),\n        y: pixelFloor(y / scaleY),\n        width: pixelCeil(toTileWidth / scaleX),\n        height: pixelCeil(toTileHeight / scaleY)\n      };\n\n      tiles.push(tile);\n    }\n  }\n\n  return tiles;\n};\n\n},{}],12:[function(require,module,exports){\n'use strict';\n\nfunction objClass(obj) {\n  return Object.prototype.toString.call(obj);\n}\n\nmodule.exports.isCanvas = function isCanvas(element) {\n  //return (element.nodeName && element.nodeName.toLowerCase() === 'canvas') ||\n  var cname = objClass(element);\n\n  return cname === '[object HTMLCanvasElement]' /* browser */ || cname === '[object Canvas]' /* node-canvas */;\n};\n\nmodule.exports.isImage = function isImage(element) {\n  //return element.nodeName && element.nodeName.toLowerCase() === 'img';\n  return objClass(element) === '[object HTMLImageElement]';\n};\n\nmodule.exports.limiter = function limiter(concurrency) {\n  var active = 0,\n      queue = [];\n\n  function roll() {\n    if (active < concurrency && queue.length) {\n      active++;\n      queue.shift()();\n    }\n  }\n\n  return function limit(fn) {\n    return new Promise(function (resolve, reject) {\n      queue.push(function () {\n        fn().then(function (result) {\n          resolve(result);\n          active--;\n          roll();\n        }, function (err) {\n          reject(err);\n          active--;\n          roll();\n        });\n      });\n\n      roll();\n    });\n  };\n};\n\nmodule.exports.cib_quality_name = function cib_quality_name(num) {\n  switch (num) {\n    case 0:\n      return 'pixelated';\n    case 1:\n      return 'low';\n    case 2:\n      return 'medium';\n  }\n  return 'high';\n};\n\nmodule.exports.cib_support = function cib_support() {\n  return Promise.resolve().then(function () {\n    if (typeof createImageBitmap === 'undefined' || typeof document === 'undefined') {\n      return false;\n    }\n\n    var c = document.createElement('canvas');\n    c.width = 100;\n    c.height = 100;\n\n    return createImageBitmap(c, 0, 0, 100, 100, {\n      resizeWidth: 10,\n      resizeHeight: 10,\n      resizeQuality: 'high'\n    }).then(function (bitmap) {\n      var status = bitmap.width === 10;\n\n      // Branch below is filtered on upper level. We do not call resize\n      // detection for basic ImageBitmap.\n      //\n      // https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap\n      // old Crome 51 has ImageBitmap without .close(). Then this code\n      // will throw and return 'false' as expected.\n      //\n      bitmap.close();\n      c = null;\n      return status;\n    });\n  }).catch(function () {\n    return false;\n  });\n};\n\n},{}],13:[function(require,module,exports){\n// Web Worker wrapper for image resize function\n\n'use strict';\n\nmodule.exports = function () {\n  var MathLib = require('./mathlib');\n\n  var mathLib = void 0;\n\n  /* eslint-disable no-undef */\n  onmessage = function onmessage(ev) {\n    var opts = ev.data.opts;\n\n    if (!mathLib) mathLib = new MathLib(ev.data.features);\n\n    // Use multimath's sync auto-init. Avoid Promise use in old browsers,\n    // because polyfills are not propagated to webworker.\n    var result = mathLib.resizeAndUnsharp(opts);\n\n    postMessage({ result: result }, [result.buffer]);\n  };\n};\n\n},{\"./mathlib\":1}],14:[function(require,module,exports){\n// Calculate Gaussian blur of an image using IIR filter\n// The method is taken from Intel's white paper and code example attached to it:\n// https://software.intel.com/en-us/articles/iir-gaussian-blur-filter\n// -implementation-using-intel-advanced-vector-extensions\n\nvar a0, a1, a2, a3, b1, b2, left_corner, right_corner;\n\nfunction gaussCoef(sigma) {\n  if (sigma < 0.5) {\n    sigma = 0.5;\n  }\n\n  var a = Math.exp(0.726 * 0.726) / sigma,\n      g1 = Math.exp(-a),\n      g2 = Math.exp(-2 * a),\n      k = (1 - g1) * (1 - g1) / (1 + 2 * a * g1 - g2);\n\n  a0 = k;\n  a1 = k * (a - 1) * g1;\n  a2 = k * (a + 1) * g1;\n  a3 = -k * g2;\n  b1 = 2 * g1;\n  b2 = -g2;\n  left_corner = (a0 + a1) / (1 - b1 - b2);\n  right_corner = (a2 + a3) / (1 - b1 - b2);\n\n  // Attempt to force type to FP32.\n  return new Float32Array([ a0, a1, a2, a3, b1, b2, left_corner, right_corner ]);\n}\n\nfunction convolveMono16(src, out, line, coeff, width, height) {\n  // takes src image and writes the blurred and transposed result into out\n\n  var prev_src, curr_src, curr_out, prev_out, prev_prev_out;\n  var src_index, out_index, line_index;\n  var i, j;\n  var coeff_a0, coeff_a1, coeff_b1, coeff_b2;\n\n  for (i = 0; i < height; i++) {\n    src_index = i * width;\n    out_index = i;\n    line_index = 0;\n\n    // left to right\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[6];\n    prev_out = prev_prev_out;\n\n    coeff_a0 = coeff[0];\n    coeff_a1 = coeff[1];\n    coeff_b1 = coeff[4];\n    coeff_b2 = coeff[5];\n\n    for (j = 0; j < width; j++) {\n      curr_src = src[src_index];\n\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n      prev_src = curr_src;\n\n      line[line_index] = prev_out;\n      line_index++;\n      src_index++;\n    }\n\n    src_index--;\n    line_index--;\n    out_index += height * (width - 1);\n\n    // right to left\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[7];\n    prev_out = prev_prev_out;\n    curr_src = prev_src;\n\n    coeff_a0 = coeff[2];\n    coeff_a1 = coeff[3];\n\n    for (j = width - 1; j >= 0; j--) {\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n\n      prev_src = curr_src;\n      curr_src = src[src_index];\n\n      out[out_index] = line[line_index] + prev_out;\n\n      src_index--;\n      line_index--;\n      out_index -= height;\n    }\n  }\n}\n\n\nfunction blurMono16(src, width, height, radius) {\n  // Quick exit on zero radius\n  if (!radius) { return; }\n\n  var out      = new Uint16Array(src.length),\n      tmp_line = new Float32Array(Math.max(width, height));\n\n  var coeff = gaussCoef(radius);\n\n  convolveMono16(src, out, tmp_line, coeff, width, height, radius);\n  convolveMono16(out, src, tmp_line, coeff, height, width, radius);\n}\n\nmodule.exports = blurMono16;\n\n},{}],15:[function(require,module,exports){\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n\n},{}],16:[function(require,module,exports){\n'use strict';\n\n\nvar assign         = require('object-assign');\nvar base64decode   = require('./lib/base64decode');\nvar hasWebAssembly = require('./lib/wa_detect');\n\n\nvar DEFAULT_OPTIONS = {\n  js: true,\n  wasm: true\n};\n\n\nfunction MultiMath(options) {\n  if (!(this instanceof MultiMath)) return new MultiMath(options);\n\n  var opts = assign({}, DEFAULT_OPTIONS, options || {});\n\n  this.options         = opts;\n\n  this.__cache         = {};\n  this.has_wasm        = hasWebAssembly();\n\n  this.__init_promise  = null;\n  this.__modules       = opts.modules || {};\n  this.__memory        = null;\n  this.__wasm          = {};\n\n  this.__isLE = ((new Uint32Array((new Uint8Array([ 1, 0, 0, 0 ])).buffer))[0] === 1);\n\n  if (!this.options.js && !this.options.wasm) {\n    throw new Error('mathlib: at least \"js\" or \"wasm\" should be enabled');\n  }\n}\n\n\nMultiMath.prototype.use = function (module) {\n  this.__modules[module.name] = module;\n\n  // Pin the best possible implementation\n  if (!this.has_wasm || !this.options.wasm || !module.wasm_fn) {\n    this[module.name] = module.fn;\n  } else {\n    this[module.name] = module.wasm_fn;\n  }\n\n  return this;\n};\n\n\nMultiMath.prototype.init = function () {\n  if (this.__init_promise) return this.__init_promise;\n\n  if (!this.options.js && this.options.wasm && !this.has_wasm) {\n    return Promise.reject(new Error('mathlib: only \"wasm\" was enabled, but it\\'s not supported'));\n  }\n\n  var self = this;\n\n  this.__init_promise = Promise.all(Object.keys(self.__modules).map(function (name) {\n    var module = self.__modules[name];\n\n    if (!self.has_wasm || !self.options.wasm || !module.wasm_fn) return null;\n\n    // If already compiled - exit\n    if (self.__wasm[name]) return null;\n\n    // Compile wasm source\n    return WebAssembly.compile(self.__base64decode(module.wasm_src))\n      .then(function (m) { self.__wasm[name] = m; });\n  }))\n    .then(function () { return self; });\n\n  return this.__init_promise;\n};\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Methods below are for internal use from plugins\n\n\n// Simple decode base64 to typed array. Useful to load embedded webassembly\n// code. You probably don't need to call this method directly.\n//\nMultiMath.prototype.__base64decode = base64decode;\n\n\n// Increase current memory to include specified number of bytes. Do nothing if\n// size is already ok. You probably don't need to call this method directly,\n// because it will be invoked from `.__instance()`.\n//\nMultiMath.prototype.__reallocate = function mem_grow_to(bytes) {\n  if (!this.__memory) {\n    this.__memory = new WebAssembly.Memory({\n      initial: Math.ceil(bytes / (64 * 1024))\n    });\n    return this.__memory;\n  }\n\n  var mem_size = this.__memory.buffer.byteLength;\n\n  if (mem_size < bytes) {\n    this.__memory.grow(Math.ceil((bytes - mem_size) / (64 * 1024)));\n  }\n\n  return this.__memory;\n};\n\n\n// Returns instantinated webassembly item by name, with specified memory size\n// and environment.\n// - use cache if available\n// - do sync module init, if async init was not called earlier\n// - allocate memory if not enougth\n// - can export functions to webassembly via \"env_extra\",\n//   for example, { exp: Math.exp }\n//\nMultiMath.prototype.__instance = function instance(name, memsize, env_extra) {\n  if (memsize) this.__reallocate(memsize);\n\n  // If .init() was not called, do sync compile\n  if (!this.__wasm[name]) {\n    var module = this.__modules[name];\n    this.__wasm[name] = new WebAssembly.Module(this.__base64decode(module.wasm_src));\n  }\n\n  if (!this.__cache[name]) {\n    var env_base = {\n      memoryBase: 0,\n      memory: this.__memory,\n      tableBase: 0,\n      table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' })\n    };\n\n    this.__cache[name] = new WebAssembly.Instance(this.__wasm[name], {\n      env: assign(env_base, env_extra || {})\n    });\n  }\n\n  return this.__cache[name];\n};\n\n\n// Helper to calculate memory aligh for pointers. Webassembly does not require\n// this, but you may wish to experiment. Default base = 8;\n//\nMultiMath.prototype.__align = function align(number, base) {\n  base = base || 8;\n  var reminder = number % base;\n  return number + (reminder ? base - reminder : 0);\n};\n\n\nmodule.exports = MultiMath;\n\n},{\"./lib/base64decode\":17,\"./lib/wa_detect\":23,\"object-assign\":24}],17:[function(require,module,exports){\n// base64 decode str -> Uint8Array, to load WA modules\n//\n'use strict';\n\n\nvar BASE64_MAP = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n\nmodule.exports = function base64decode(str) {\n  var input = str.replace(/[\\r\\n=]/g, ''), // remove CR/LF & padding to simplify scan\n      max   = input.length;\n\n  var out = new Uint8Array((max * 3) >> 2);\n\n  // Collect by 6*4 bits (3 bytes)\n\n  var bits = 0;\n  var ptr  = 0;\n\n  for (var idx = 0; idx < max; idx++) {\n    if ((idx % 4 === 0) && idx) {\n      out[ptr++] = (bits >> 16) & 0xFF;\n      out[ptr++] = (bits >> 8) & 0xFF;\n      out[ptr++] = bits & 0xFF;\n    }\n\n    bits = (bits << 6) | BASE64_MAP.indexOf(input.charAt(idx));\n  }\n\n  // Dump tail\n\n  var tailbits = (max % 4) * 6;\n\n  if (tailbits === 0) {\n    out[ptr++] = (bits >> 16) & 0xFF;\n    out[ptr++] = (bits >> 8) & 0xFF;\n    out[ptr++] = bits & 0xFF;\n  } else if (tailbits === 18) {\n    out[ptr++] = (bits >> 10) & 0xFF;\n    out[ptr++] = (bits >> 2) & 0xFF;\n  } else if (tailbits === 12) {\n    out[ptr++] = (bits >> 4) & 0xFF;\n  }\n\n  return out;\n};\n\n},{}],18:[function(require,module,exports){\n// Calculates 16-bit precision HSL lightness from 8-bit rgba buffer\n//\n'use strict';\n\n\nmodule.exports = function hsl_l16_js(img, width, height) {\n  var size = width * height;\n  var out = new Uint16Array(size);\n  var r, g, b, min, max;\n  for (var i = 0; i < size; i++) {\n    r = img[4 * i];\n    g = img[4 * i + 1];\n    b = img[4 * i + 2];\n    max = (r >= g && r >= b) ? r : (g >= b && g >= r) ? g : b;\n    min = (r <= g && r <= b) ? r : (g <= b && g <= r) ? g : b;\n    out[i] = (max + min) * 257 >> 1;\n  }\n  return out;\n};\n\n},{}],19:[function(require,module,exports){\n'use strict';\n\nmodule.exports = {\n  name:     'unsharp_mask',\n  fn:       require('./unsharp_mask'),\n  wasm_fn:  require('./unsharp_mask_wasm'),\n  wasm_src: require('./unsharp_mask_wasm_base64')\n};\n\n},{\"./unsharp_mask\":20,\"./unsharp_mask_wasm\":21,\"./unsharp_mask_wasm_base64\":22}],20:[function(require,module,exports){\n// Unsharp mask filter\n//\n// http://stackoverflow.com/a/23322820/1031804\n// USM(O) = O + (2 * (Amount / 100) * (O - GB))\n// GB - gaussian blur.\n//\n// Image is converted from RGB to HSL, unsharp mask is applied to the\n// lightness channel and then image is converted back to RGB.\n//\n'use strict';\n\n\nvar glur_mono16 = require('glur/mono16');\nvar hsl_l16     = require('./hsl_l16');\n\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  var r, g, b;\n  var h, s, l;\n  var min, max;\n  var m1, m2, hShifted;\n  var diff, iTimes4;\n\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var lightness = hsl_l16(img, width, height);\n\n  var blured = new Uint16Array(lightness); // copy, because blur modify src\n\n  glur_mono16(blured, width, height, radius);\n\n  var amountFp = (amount / 100 * 0x1000 + 0.5)|0;\n  var thresholdFp = (threshold * 257)|0;\n\n  var size = width * height;\n\n  /* eslint-disable indent */\n  for (var i = 0; i < size; i++) {\n    diff = 2 * (lightness[i] - blured[i]);\n\n    if (Math.abs(diff) >= thresholdFp) {\n      iTimes4 = i * 4;\n      r = img[iTimes4];\n      g = img[iTimes4 + 1];\n      b = img[iTimes4 + 2];\n\n      // convert RGB to HSL\n      // take RGB, 8-bit unsigned integer per each channel\n      // save HSL, H and L are 16-bit unsigned integers, S is 12-bit unsigned integer\n      // math is taken from here: http://www.easyrgb.com/index.php?X=MATH&H=18\n      // and adopted to be integer (fixed point in fact) for sake of performance\n      max = (r >= g && r >= b) ? r : (g >= r && g >= b) ? g : b; // min and max are in [0..0xff]\n      min = (r <= g && r <= b) ? r : (g <= r && g <= b) ? g : b;\n      l = (max + min) * 257 >> 1; // l is in [0..0xffff] that is caused by multiplication by 257\n\n      if (min === max) {\n        h = s = 0;\n      } else {\n        s = (l <= 0x7fff) ?\n          (((max - min) * 0xfff) / (max + min))|0 :\n          (((max - min) * 0xfff) / (2 * 0xff - max - min))|0; // s is in [0..0xfff]\n        // h could be less 0, it will be fixed in backward conversion to RGB, |h| <= 0xffff / 6\n        h = (r === max) ? (((g - b) * 0xffff) / (6 * (max - min)))|0\n          : (g === max) ? 0x5555 + ((((b - r) * 0xffff) / (6 * (max - min)))|0) // 0x5555 == 0xffff / 3\n          : 0xaaaa + ((((r - g) * 0xffff) / (6 * (max - min)))|0); // 0xaaaa == 0xffff * 2 / 3\n      }\n\n      // add unsharp mask mask to the lightness channel\n      l += (amountFp * diff + 0x800) >> 12;\n      if (l > 0xffff) {\n        l = 0xffff;\n      } else if (l < 0) {\n        l = 0;\n      }\n\n      // convert HSL back to RGB\n      // for information about math look above\n      if (s === 0) {\n        r = g = b = l >> 8;\n      } else {\n        m2 = (l <= 0x7fff) ? (l * (0x1000 + s) + 0x800) >> 12 :\n          l  + (((0xffff - l) * s + 0x800) >>  12);\n        m1 = 2 * l - m2 >> 8;\n        m2 >>= 8;\n        // save result to RGB channels\n        // R channel\n        hShifted = (h + 0x5555) & 0xffff; // 0x5555 == 0xffff / 3\n        r = (hShifted >= 0xaaaa) ? m1 // 0xaaaa == 0xffff * 2 / 3\n          : (hShifted >= 0x7fff) ?  m1 + ((m2 - m1) * 6 * (0xaaaa - hShifted) + 0x8000 >> 16)\n          : (hShifted >= 0x2aaa) ? m2 // 0x2aaa == 0xffff / 6\n          : m1 + ((m2 - m1) * 6 * hShifted + 0x8000 >> 16);\n        // G channel\n        hShifted = h & 0xffff;\n        g = (hShifted >= 0xaaaa) ? m1 // 0xaaaa == 0xffff * 2 / 3\n          : (hShifted >= 0x7fff) ?  m1 + ((m2 - m1) * 6 * (0xaaaa - hShifted) + 0x8000 >> 16)\n          : (hShifted >= 0x2aaa) ? m2 // 0x2aaa == 0xffff / 6\n          : m1 + ((m2 - m1) * 6 * hShifted + 0x8000 >> 16);\n        // B channel\n        hShifted = (h - 0x5555) & 0xffff;\n        b = (hShifted >= 0xaaaa) ? m1 // 0xaaaa == 0xffff * 2 / 3\n          : (hShifted >= 0x7fff) ?  m1 + ((m2 - m1) * 6 * (0xaaaa - hShifted) + 0x8000 >> 16)\n          : (hShifted >= 0x2aaa) ? m2 // 0x2aaa == 0xffff / 6\n          : m1 + ((m2 - m1) * 6 * hShifted + 0x8000 >> 16);\n      }\n\n      img[iTimes4] = r;\n      img[iTimes4 + 1] = g;\n      img[iTimes4 + 2] = b;\n    }\n  }\n};\n\n},{\"./hsl_l16\":18,\"glur/mono16\":14}],21:[function(require,module,exports){\n'use strict';\n\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var pixels = width * height;\n\n  var img_bytes_cnt        = pixels * 4;\n  var hsl_bytes_cnt        = pixels * 2;\n  var blur_bytes_cnt       = pixels * 2;\n  var blur_line_byte_cnt   = Math.max(width, height) * 4; // float32 array\n  var blur_coeffs_byte_cnt = 8 * 4; // float32 array\n\n  var img_offset         = 0;\n  var hsl_offset         = img_bytes_cnt;\n  var blur_offset        = hsl_offset + hsl_bytes_cnt;\n  var blur_tmp_offset    = blur_offset + blur_bytes_cnt;\n  var blur_line_offset   = blur_tmp_offset + blur_bytes_cnt;\n  var blur_coeffs_offset = blur_line_offset + blur_line_byte_cnt;\n\n  var instance = this.__instance(\n    'unsharp_mask',\n    img_bytes_cnt + hsl_bytes_cnt + blur_bytes_cnt * 2 + blur_line_byte_cnt + blur_coeffs_byte_cnt,\n    { exp: Math.exp }\n  );\n\n  // 32-bit copy is much faster in chrome\n  var img32 = new Uint32Array(img.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer);\n  mem32.set(img32);\n\n  // HSL\n  var fn = instance.exports.hsl_l16 || instance.exports._hsl_l16;\n  fn(img_offset, hsl_offset, width, height);\n\n  // BLUR\n  fn = instance.exports.blurMono16 || instance.exports._blurMono16;\n  fn(hsl_offset, blur_offset, blur_tmp_offset,\n    blur_line_offset, blur_coeffs_offset, width, height, radius);\n\n  // UNSHARP\n  fn = instance.exports.unsharp || instance.exports._unsharp;\n  fn(img_offset, img_offset, hsl_offset,\n    blur_offset, width, height, amount, threshold);\n\n  // 32-bit copy is much faster in chrome\n  img32.set(new Uint32Array(this.__memory.buffer, 0, pixels));\n};\n\n},{}],22:[function(require,module,exports){\n// This is autogenerated file from math.wasm, don't edit.\n//\n'use strict';\n\n/* eslint-disable max-len */\nmodule.exports = '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';\n\n},{}],23:[function(require,module,exports){\n// Detect WebAssembly support.\n// - Check global WebAssembly object\n// - Try to load simple module (can be disabled via CSP)\n//\n'use strict';\n\n\nvar wa;\n\n\nmodule.exports = function hasWebAssembly() {\n  // use cache if called before;\n  if (typeof wa !== 'undefined') return wa;\n\n  wa = false;\n\n  if (typeof WebAssembly === 'undefined') return wa;\n\n  // If WebAssenbly is disabled, code can throw on compile\n  try {\n    // https://github.com/brion/min-wasm-fail/blob/master/min-wasm-fail.in.js\n    // Additional check that WA internals are correct\n\n    /* eslint-disable comma-spacing, max-len */\n    var bin      = new Uint8Array([ 0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11 ]);\n    var module   = new WebAssembly.Module(bin);\n    var instance = new WebAssembly.Instance(module, {});\n\n    // test storing to and loading from a non-zero location via a parameter.\n    // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n    if (instance.exports.test(4) !== 0) wa = true;\n\n    return wa;\n  } catch (__) {}\n\n  return wa;\n};\n\n},{}],24:[function(require,module,exports){\n/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n},{}],25:[function(require,module,exports){\nvar bundleFn = arguments[3];\nvar sources = arguments[4];\nvar cache = arguments[5];\n\nvar stringify = JSON.stringify;\n\nmodule.exports = function (fn, options) {\n    var wkey;\n    var cacheKeys = Object.keys(cache);\n\n    for (var i = 0, l = cacheKeys.length; i < l; i++) {\n        var key = cacheKeys[i];\n        var exp = cache[key].exports;\n        // Using babel as a transpiler to use esmodule, the export will always\n        // be an object with the default export as a property of it. To ensure\n        // the existing api and babel esmodule exports are both supported we\n        // check for both\n        if (exp === fn || exp && exp.default === fn) {\n            wkey = key;\n            break;\n        }\n    }\n\n    if (!wkey) {\n        wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n        var wcache = {};\n        for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            wcache[key] = key;\n        }\n        sources[wkey] = [\n            'function(require,module,exports){' + fn + '(self); }',\n            wcache\n        ];\n    }\n    var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n\n    var scache = {}; scache[wkey] = wkey;\n    sources[skey] = [\n        'function(require,module,exports){' +\n            // try to call default if defined to also support babel esmodule exports\n            'var f = require(' + stringify(wkey) + ');' +\n            '(f.default ? f.default : f)(self);' +\n        '}',\n        scache\n    ];\n\n    var workerSources = {};\n    resolveSources(skey);\n\n    function resolveSources(key) {\n        workerSources[key] = true;\n\n        for (var depPath in sources[key][1]) {\n            var depKey = sources[key][1][depPath];\n            if (!workerSources[depKey]) {\n                resolveSources(depKey);\n            }\n        }\n    }\n\n    var src = '(' + bundleFn + ')({'\n        + Object.keys(workerSources).map(function (key) {\n            return stringify(key) + ':['\n                + sources[key][0]\n                + ',' + stringify(sources[key][1]) + ']'\n            ;\n        }).join(',')\n        + '},{},[' + stringify(skey) + '])'\n    ;\n\n    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n    var blob = new Blob([src], { type: 'text/javascript' });\n    if (options && options.bare) { return blob; }\n    var workerUrl = URL.createObjectURL(blob);\n    var worker = new Worker(workerUrl);\n    worker.objectURL = workerUrl;\n    return worker;\n};\n\n},{}],\"/\":[function(require,module,exports){\n'use strict';\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar assign = require('object-assign');\nvar webworkify = require('webworkify');\n\nvar MathLib = require('./lib/mathlib');\nvar Pool = require('./lib/pool');\nvar utils = require('./lib/utils');\nvar worker = require('./lib/worker');\nvar createStages = require('./lib/stepper');\nvar createRegions = require('./lib/tiler');\n\n// Deduplicate pools & limiters with the same configs\n// when user creates multiple pica instances.\nvar singletones = {};\n\nvar NEED_SAFARI_FIX = false;\ntry {\n  if (typeof navigator !== 'undefined' && navigator.userAgent) {\n    NEED_SAFARI_FIX = navigator.userAgent.indexOf('Safari') >= 0;\n  }\n} catch (e) {}\n\nvar concurrency = 1;\nif (typeof navigator !== 'undefined') {\n  concurrency = Math.min(navigator.hardwareConcurrency || 1, 4);\n}\n\nvar DEFAULT_PICA_OPTS = {\n  tile: 1024,\n  concurrency: concurrency,\n  features: ['js', 'wasm', 'ww'],\n  idle: 2000\n};\n\nvar DEFAULT_RESIZE_OPTS = {\n  quality: 3,\n  alpha: false,\n  unsharpAmount: 0,\n  unsharpRadius: 0.0,\n  unsharpThreshold: 0\n};\n\nvar CAN_NEW_IMAGE_DATA = void 0;\nvar CAN_CREATE_IMAGE_BITMAP = void 0;\n\nfunction workerFabric() {\n  return {\n    value: webworkify(worker),\n    destroy: function destroy() {\n      this.value.terminate();\n\n      if (typeof window !== 'undefined') {\n        var url = window.URL || window.webkitURL || window.mozURL || window.msURL;\n        if (url && url.revokeObjectURL && this.value.objectURL) {\n          url.revokeObjectURL(this.value.objectURL);\n        }\n      }\n    }\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// API methods\n\nfunction Pica(options) {\n  if (!(this instanceof Pica)) return new Pica(options);\n\n  this.options = assign({}, DEFAULT_PICA_OPTS, options || {});\n\n  var limiter_key = 'lk_' + this.options.concurrency;\n\n  // Share limiters to avoid multiple parallel workers when user creates\n  // multiple pica instances.\n  this.__limit = singletones[limiter_key] || utils.limiter(this.options.concurrency);\n\n  if (!singletones[limiter_key]) singletones[limiter_key] = this.__limit;\n\n  // List of supported features, according to options & browser/node.js\n  this.features = {\n    js: false, // pure JS implementation, can be disabled for testing\n    wasm: false, // webassembly implementation for heavy functions\n    cib: false, // resize via createImageBitmap (only FF at this moment)\n    ww: false // webworkers\n  };\n\n  this.__workersPool = null;\n\n  // Store requested features for webworkers\n  this.__requested_features = [];\n\n  this.__mathlib = null;\n}\n\nPica.prototype.init = function () {\n  var _this = this;\n\n  if (this.__initPromise) return this.__initPromise;\n\n  // Test if we can create ImageData without canvas and memory copy\n  if (CAN_NEW_IMAGE_DATA !== false && CAN_NEW_IMAGE_DATA !== true) {\n    CAN_NEW_IMAGE_DATA = false;\n    if (typeof ImageData !== 'undefined' && typeof Uint8ClampedArray !== 'undefined') {\n      try {\n        /* eslint-disable no-new */\n        new ImageData(new Uint8ClampedArray(400), 10, 10);\n        CAN_NEW_IMAGE_DATA = true;\n      } catch (__) {}\n    }\n  }\n\n  // ImageBitmap can be effective in 2 places:\n  //\n  // 1. Threaded jpeg unpack (basic)\n  // 2. Built-in resize (blocked due problem in chrome, see issue #89)\n  //\n  // For basic use we also need ImageBitmap wo support .close() method,\n  // see https://developer.mozilla.org/ru/docs/Web/API/ImageBitmap\n\n  if (CAN_CREATE_IMAGE_BITMAP !== false && CAN_CREATE_IMAGE_BITMAP !== true) {\n    CAN_CREATE_IMAGE_BITMAP = false;\n    if (typeof ImageBitmap !== 'undefined') {\n      if (ImageBitmap.prototype && ImageBitmap.prototype.close) {\n        CAN_CREATE_IMAGE_BITMAP = true;\n      } else {\n        this.debug('ImageBitmap does not support .close(), disabled');\n      }\n    }\n  }\n\n  var features = this.options.features.slice();\n\n  if (features.indexOf('all') >= 0) {\n    features = ['cib', 'wasm', 'js', 'ww'];\n  }\n\n  this.__requested_features = features;\n\n  this.__mathlib = new MathLib(features);\n\n  // Check WebWorker support if requested\n  if (features.indexOf('ww') >= 0) {\n    if (typeof window !== 'undefined' && 'Worker' in window) {\n      // IE <= 11 don't allow to create webworkers from string. We should check it.\n      // https://connect.microsoft.com/IE/feedback/details/801810/web-workers-from-blob-urls-in-ie-10-and-11\n      try {\n        var wkr = require('webworkify')(function () {});\n        wkr.terminate();\n        this.features.ww = true;\n\n        // pool uniqueness depends on pool config + webworker config\n        var wpool_key = 'wp_' + JSON.stringify(this.options);\n\n        if (singletones[wpool_key]) {\n          this.__workersPool = singletones[wpool_key];\n        } else {\n          this.__workersPool = new Pool(workerFabric, this.options.idle);\n          singletones[wpool_key] = this.__workersPool;\n        }\n      } catch (__) {}\n    }\n  }\n\n  var initMath = this.__mathlib.init().then(function (mathlib) {\n    // Copy detected features\n    assign(_this.features, mathlib.features);\n  });\n\n  var checkCibResize = void 0;\n\n  if (!CAN_CREATE_IMAGE_BITMAP) {\n    checkCibResize = Promise.resolve(false);\n  } else {\n    checkCibResize = utils.cib_support().then(function (status) {\n      if (_this.features.cib && features.indexOf('cib') < 0) {\n        _this.debug('createImageBitmap() resize supported, but disabled by config');\n        return;\n      }\n\n      if (features.indexOf('cib') >= 0) _this.features.cib = status;\n    });\n  }\n\n  // Init math lib. That's async because can load some\n  this.__initPromise = Promise.all([initMath, checkCibResize]).then(function () {\n    return _this;\n  });\n\n  return this.__initPromise;\n};\n\nPica.prototype.resize = function (from, to, options) {\n  var _this2 = this;\n\n  this.debug('Start resize...');\n\n  var opts = assign({}, DEFAULT_RESIZE_OPTS);\n\n  if (!isNaN(options)) {\n    opts = assign(opts, { quality: options });\n  } else if (options) {\n    opts = assign(opts, options);\n  }\n\n  opts.toWidth = to.width;\n  opts.toHeight = to.height;\n  opts.width = from.naturalWidth || from.width;\n  opts.height = from.naturalHeight || from.height;\n\n  if (opts.unsharpRadius > 2) opts.unsharpRadius = 2;\n\n  var canceled = false;\n  var cancelToken = null;\n\n  if (opts.cancelToken) {\n    // Wrap cancelToken to avoid successive resolve & set flag\n    cancelToken = opts.cancelToken.then(function (data) {\n      canceled = true;throw data;\n    }, function (err) {\n      canceled = true;throw err;\n    });\n  }\n\n  var DEST_TILE_BORDER = 3; // Max possible filter window size\n  var destTileBorder = Math.ceil(Math.max(DEST_TILE_BORDER, 2.5 * opts.unsharpRadius | 0));\n\n  return this.init().then(function () {\n    if (canceled) return cancelToken;\n\n    // if createImageBitmap supports resize, just do it and return\n    if (_this2.features.cib) {\n      var toCtx = to.getContext('2d', { alpha: Boolean(opts.alpha) });\n\n      _this2.debug('Resize via createImageBitmap()');\n\n      return createImageBitmap(from, {\n        resizeWidth: opts.toWidth,\n        resizeHeight: opts.toHeight,\n        resizeQuality: utils.cib_quality_name(opts.quality)\n      }).then(function (imageBitmap) {\n        if (canceled) return cancelToken;\n\n        // if no unsharp - draw directly to output canvas\n        if (!opts.unsharpAmount) {\n          toCtx.drawImage(imageBitmap, 0, 0);\n          imageBitmap.close();\n          toCtx = null;\n\n          _this2.debug('Finished!');\n\n          return to;\n        }\n\n        _this2.debug('Unsharp result');\n\n        var tmpCanvas = document.createElement('canvas');\n\n        tmpCanvas.width = opts.toWidth;\n        tmpCanvas.height = opts.toHeight;\n\n        var tmpCtx = tmpCanvas.getContext('2d', { alpha: Boolean(opts.alpha) });\n\n        tmpCtx.drawImage(imageBitmap, 0, 0);\n        imageBitmap.close();\n\n        var iData = tmpCtx.getImageData(0, 0, opts.toWidth, opts.toHeight);\n\n        _this2.__mathlib.unsharp(iData.data, opts.toWidth, opts.toHeight, opts.unsharpAmount, opts.unsharpRadius, opts.unsharpThreshold);\n\n        toCtx.putImageData(iData, 0, 0);\n        iData = tmpCtx = tmpCanvas = toCtx = null;\n\n        _this2.debug('Finished!');\n\n        return to;\n      });\n    }\n\n    //\n    // No easy way, let's resize manually via arrays\n    //\n\n    // Share cache between calls:\n    //\n    // - wasm instance\n    // - wasm memory object\n    //\n    var cache = {};\n\n    // Call resizer in webworker or locally, depending on config\n    var invokeResize = function invokeResize(opts) {\n      return Promise.resolve().then(function () {\n        if (!_this2.features.ww) return _this2.__mathlib.resizeAndUnsharp(opts, cache);\n\n        return new Promise(function (resolve, reject) {\n          var w = _this2.__workersPool.acquire();\n\n          if (cancelToken) cancelToken.catch(function (err) {\n            return reject(err);\n          });\n\n          w.value.onmessage = function (ev) {\n            w.release();\n\n            if (ev.data.err) reject(ev.data.err);else resolve(ev.data.result);\n          };\n\n          w.value.postMessage({\n            opts: opts,\n            features: _this2.__requested_features,\n            preload: {\n              wasm_nodule: _this2.__mathlib.__\n            }\n          }, [opts.src.buffer]);\n        });\n      });\n    };\n\n    var tileAndResize = function tileAndResize(from, to, opts) {\n      var srcCtx = void 0;\n      var srcImageBitmap = void 0;\n      var toCtx = void 0;\n\n      var processTile = function processTile(tile) {\n        return _this2.__limit(function () {\n          if (canceled) return cancelToken;\n\n          var srcImageData = void 0;\n\n          // Extract tile RGBA buffer, depending on input type\n          if (utils.isCanvas(from)) {\n            _this2.debug('Get tile pixel data');\n\n            // If input is Canvas - extract region data directly\n            srcImageData = srcCtx.getImageData(tile.x, tile.y, tile.width, tile.height);\n          } else {\n            // If input is Image or decoded to ImageBitmap,\n            // draw region to temporary canvas and extract data from it\n            //\n            // Note! Attempt to reuse this canvas causes significant slowdown in chrome\n            //\n            _this2.debug('Draw tile imageBitmap/image to temporary canvas');\n\n            var tmpCanvas = document.createElement('canvas');\n            tmpCanvas.width = tile.width;\n            tmpCanvas.height = tile.height;\n\n            var tmpCtx = tmpCanvas.getContext('2d', { alpha: Boolean(opts.alpha) });\n            tmpCtx.globalCompositeOperation = 'copy';\n            tmpCtx.drawImage(srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height, 0, 0, tile.width, tile.height);\n\n            _this2.debug('Get tile pixel data');\n\n            srcImageData = tmpCtx.getImageData(0, 0, tile.width, tile.height);\n            tmpCtx = tmpCanvas = null;\n          }\n\n          var o = {\n            src: srcImageData.data,\n            width: tile.width,\n            height: tile.height,\n            toWidth: tile.toWidth,\n            toHeight: tile.toHeight,\n            scaleX: tile.scaleX,\n            scaleY: tile.scaleY,\n            offsetX: tile.offsetX,\n            offsetY: tile.offsetY,\n            quality: opts.quality,\n            alpha: opts.alpha,\n            unsharpAmount: opts.unsharpAmount,\n            unsharpRadius: opts.unsharpRadius,\n            unsharpThreshold: opts.unsharpThreshold\n          };\n\n          _this2.debug('Invoke resize math');\n\n          return Promise.resolve().then(function () {\n            return invokeResize(o);\n          }).then(function (result) {\n            if (canceled) return cancelToken;\n\n            srcImageData = null;\n\n            var toImageData = void 0;\n\n            _this2.debug('Convert raw rgba tile result to ImageData');\n\n            if (CAN_NEW_IMAGE_DATA) {\n              // this branch is for modern browsers\n              // If `new ImageData()` & Uint8ClampedArray suported\n              toImageData = new ImageData(new Uint8ClampedArray(result), tile.toWidth, tile.toHeight);\n            } else {\n              // fallback for `node-canvas` and old browsers\n              // (IE11 has ImageData but does not support `new ImageData()`)\n              toImageData = toCtx.createImageData(tile.toWidth, tile.toHeight);\n\n              if (toImageData.data.set) {\n                toImageData.data.set(result);\n              } else {\n                // IE9 don't have `.set()`\n                for (var i = toImageData.data.length - 1; i >= 0; i--) {\n                  toImageData.data[i] = result[i];\n                }\n              }\n            }\n\n            _this2.debug('Draw tile');\n\n            if (NEED_SAFARI_FIX) {\n              // Safari draws thin white stripes between tiles without this fix\n              toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth + 1e-5, tile.toInnerHeight + 1e-5);\n            } else {\n              toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth, tile.toInnerHeight);\n            }\n\n            return null;\n          });\n        });\n      };\n\n      // Need to normalize data source first. It can be canvas or image.\n      // If image - try to decode in background if possible\n      return Promise.resolve().then(function () {\n        toCtx = to.getContext('2d', { alpha: Boolean(opts.alpha) });\n\n        if (utils.isCanvas(from)) {\n          srcCtx = from.getContext('2d', { alpha: Boolean(opts.alpha) });\n          return null;\n        }\n\n        if (utils.isImage(from)) {\n          // try do decode image in background for faster next operations\n          if (!CAN_CREATE_IMAGE_BITMAP) return null;\n\n          _this2.debug('Decode image via createImageBitmap');\n\n          return createImageBitmap(from).then(function (imageBitmap) {\n            srcImageBitmap = imageBitmap;\n          });\n        }\n\n        throw new Error('\".from\" should be image or canvas');\n      }).then(function () {\n        if (canceled) return cancelToken;\n\n        _this2.debug('Calculate tiles');\n\n        //\n        // Here we are with \"normalized\" source,\n        // follow to tiling\n        //\n\n        var regions = createRegions({\n          width: opts.width,\n          height: opts.height,\n          srcTileSize: _this2.options.tile,\n          toWidth: opts.toWidth,\n          toHeight: opts.toHeight,\n          destTileBorder: destTileBorder\n        });\n\n        var jobs = regions.map(function (tile) {\n          return processTile(tile);\n        });\n\n        function cleanup() {\n          if (srcImageBitmap) {\n            srcImageBitmap.close();\n            srcImageBitmap = null;\n          }\n        }\n\n        _this2.debug('Process tiles');\n\n        return Promise.all(jobs).then(function () {\n          _this2.debug('Finished!');\n          cleanup();return to;\n        }, function (err) {\n          cleanup();throw err;\n        });\n      });\n    };\n\n    var processStages = function processStages(stages, from, to, opts) {\n      if (canceled) return cancelToken;\n\n      var _stages$shift = stages.shift(),\n          _stages$shift2 = _slicedToArray(_stages$shift, 2),\n          toWidth = _stages$shift2[0],\n          toHeight = _stages$shift2[1];\n\n      var isLastStage = stages.length === 0;\n\n      opts = assign({}, opts, {\n        toWidth: toWidth,\n        toHeight: toHeight,\n        // only use user-defined quality for the last stage,\n        // use simpler (Hamming) filter for the first stages where\n        // scale factor is large enough (more than 2-3)\n        quality: isLastStage ? opts.quality : Math.min(1, opts.quality)\n      });\n\n      var tmpCanvas = void 0;\n\n      if (!isLastStage) {\n        // create temporary canvas\n        tmpCanvas = document.createElement('canvas');\n        tmpCanvas.width = toWidth;\n        tmpCanvas.height = toHeight;\n      }\n\n      return tileAndResize(from, isLastStage ? to : tmpCanvas, opts).then(function () {\n        if (isLastStage) return to;\n\n        opts.width = toWidth;\n        opts.height = toHeight;\n        return processStages(stages, tmpCanvas, to, opts);\n      });\n    };\n\n    var stages = createStages(opts.width, opts.height, opts.toWidth, opts.toHeight, _this2.options.tile, destTileBorder);\n\n    return processStages(stages, from, to, opts);\n  });\n};\n\n// RGBA buffer resize\n//\nPica.prototype.resizeBuffer = function (options) {\n  var _this3 = this;\n\n  var opts = assign({}, DEFAULT_RESIZE_OPTS, options);\n\n  return this.init().then(function () {\n    return _this3.__mathlib.resizeAndUnsharp(opts);\n  });\n};\n\nPica.prototype.toBlob = function (canvas, mimeType, quality) {\n  mimeType = mimeType || 'image/png';\n\n  return new Promise(function (resolve) {\n    if (canvas.toBlob) {\n      canvas.toBlob(function (blob) {\n        return resolve(blob);\n      }, mimeType, quality);\n      return;\n    }\n\n    // Fallback for old browsers\n    var asString = atob(canvas.toDataURL(mimeType, quality).split(',')[1]);\n    var len = asString.length;\n    var asBuffer = new Uint8Array(len);\n\n    for (var i = 0; i < len; i++) {\n      asBuffer[i] = asString.charCodeAt(i);\n    }\n\n    resolve(new Blob([asBuffer], { type: mimeType }));\n  });\n};\n\nPica.prototype.debug = function () {};\n\nmodule.exports = Pica;\n\n},{\"./lib/mathlib\":1,\"./lib/pool\":9,\"./lib/stepper\":10,\"./lib/tiler\":11,\"./lib/utils\":12,\"./lib/worker\":13,\"object-assign\":24,\"webworkify\":25}]},{},[])(\"/\")\n});\n","import Pica from 'pica/dist/pica'\n\nimport {RESIZE_TYPE_SQUARE, RESIZE_TYPE_TO} from '../constants'\n\n/**\n * @param maxWidth\n * @param maxHeight\n * @param type\n * @param options{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport default function (maxWidth, maxHeight, type = null, options = {}) {\n    let resizeOptions = Object.assign({\n        pica: {}\n    }, options)\n\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let outputCanvas = null\n        let canvas = document.createElement('canvas')\n        let ratio = 0\n        let width = canvasImage.width\n        let height = canvasImage.height\n        let newHeight = 0\n        let newWidth = 0\n\n        if (type === RESIZE_TYPE_SQUARE) {\n            if (width < height) {\n                ratio = maxWidth / width\n            } else {\n                ratio = maxHeight / height\n            }\n            newHeight = height * ratio\n            newWidth = width * ratio\n        } else if (type === RESIZE_TYPE_TO) {\n            let ratioWidth = width / maxWidth\n            let ratioHeight = height / maxHeight\n            if (ratioWidth > ratioHeight) {\n                newHeight = Math.round(height / ratioWidth)\n                newWidth = maxWidth\n            } else {\n                newWidth = Math.round(width / ratioHeight)\n                newHeight = maxHeight\n            }\n        } else {\n            reject(new Error('Unknown resize type'))\n        }\n\n        canvas.width = newWidth\n        canvas.height = newHeight\n\n        let picaInstanse = new Pica()\n        picaInstanse.resize(canvasImage, canvas, resizeOptions.pica).then(resizedCanvas => {\n            if (type === RESIZE_TYPE_SQUARE) {\n                let dx = 0\n                let dy = 0\n                let sx = 0\n                let sy = 0\n\n                if (newWidth < newHeight) {\n                    sy = (newHeight - newWidth) / 2\n                    newHeight = newWidth\n                } else {\n                    sx = (newWidth - newHeight) / 2\n                    newWidth = newHeight\n                }\n                let cropedCanvas = document.createElement('canvas')\n                let cropedCanvasCtx = cropedCanvas.getContext('2d')\n                cropedCanvas.width = newWidth\n                cropedCanvas.height = newHeight\n\n                cropedCanvasCtx.drawImage(resizedCanvas, sx, sy, newWidth, newHeight, dx, dy, newWidth, newHeight)\n\n                outputCanvas = cropedCanvas\n            } else {\n                outputCanvas = resizedCanvas\n            }\n            resolve(outputCanvas)\n        })\n    })\n}\n","export const RESIZE_TYPE_SQUARE = 'square'\nexport const RESIZE_TYPE_TO = 'to'\n\nexport const MANIPULATION = 'MANIPULATION'\nexport const LOADER = 'LOADER'\nexport const FILTER = 'FILTER'\n","import degreesToRadian from '../helpers/degreesToRadian.js'\n\n/**\n * @param degrees\n * @param opts{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport default function (degrees, opts = {}) {\n    let {padding = 0, bgColor = 'white'} = opts\n\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        let calcAngle = 0\n        let angle = degrees\n\n        if (degrees < 0) {\n            degrees = 360 + degrees\n        }\n\n        // get angle\n        if (degrees >= 0 && degrees <= 90) {\n            angle = degrees\n            calcAngle = 90 - angle\n        } else {\n            angle = degrees\n            calcAngle = 270 - angle\n        }\n        // to rad\n        let degreesRad = degreesToRadian(degrees)\n        let calcAngleRad = degreesToRadian(calcAngle)\n        let angleRad = degreesToRadian(angle)\n        // calc sin cos\n        let sinCos = {\n            cosAngle: Math.cos(angleRad),\n            cosCalcAngle: Math.cos(calcAngleRad),\n            sinAngle: Math.sin(angleRad),\n            sinCalcAngle: Math.sin(calcAngleRad)\n\n        }\n        // get module of sin/cos\n        for (let key in sinCos) {\n            if (sinCos[key] < 0) {\n                sinCos[key] = sinCos[key] * -1\n            }\n        }\n        // calc w/h on rotate changes\n        canvas.width =  canvasImage.width * sinCos.cosAngle + canvasImage.height * sinCos.cosCalcAngle + padding\n        canvas.height =  canvasImage.width * sinCos.sinAngle + canvasImage.height * sinCos.sinCalcAngle + padding\n\n        let ctx = canvas.getContext('2d')\n        // set bg\n        if (bgColor) {\n            ctx.beginPath()\n            ctx.rect(0, 0, canvas.width, canvas.height)\n            ctx.fillStyle = bgColor\n            ctx.fill()\n            ctx.save()\n        }\n        ctx.save()\n\n        // rotate\n        ctx.translate(canvas.width / 2, canvas.height / 2)\n        ctx.rotate(degreesRad)\n        ctx.drawImage(canvasImage, -(canvasImage.width / 2), -(canvasImage.height / 2))\n        ctx.restore()\n\n        resolve(canvas)\n    })\n}\n","/**\n * @param width\n * @param height\n * @param opts{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport default function (width, height, opts = {}) {\n    let {bgColor = 'white'} = opts\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        canvas.width = width\n        canvas.height = height\n        let ctx = canvas.getContext('2d')\n        let newWidth = canvasImage.width\n        let newHeight = canvasImage.height\n        // set bg\n        if (bgColor) {\n            ctx.beginPath()\n            ctx.rect(0, 0, width, height)\n            ctx.fillStyle = bgColor\n            ctx.fill()\n            ctx.save()\n        }\n        // put image\n        let dx = 0\n        let dy = 0\n        let sx = 0\n        let sy = 0\n        if (newWidth < width) {\n            dx = (width - newWidth) / 2\n        }\n        if (newHeight < height) {\n            dy = (height - newHeight) / 2\n        }\n        ctx.drawImage(canvasImage, sx, sy, newWidth, newHeight, dx, dy, newWidth, newHeight)\n        resolve(canvas)\n    })\n}\n","/**\n * @param diametr\n * @param opts{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport default function (diametr, opts = {}) {\n    let {padding = 4, bgColor = 'white'} = opts\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        canvas.width = diametr\n        canvas.height = diametr\n\n        let ctx = canvas.getContext('2d')\n        // set area and area bg color\n        ctx.beginPath()\n        ctx.rect(0, 0, diametr, diametr)\n        ctx.fillStyle = bgColor\n        ctx.fill()\n        ctx.save()\n        // set padding in cropped circle\n        let paddingSize = diametr - padding\n        let halfSize = Math.round(paddingSize / 2)\n        ctx.beginPath()\n        ctx.arc(halfSize + (padding / 2), halfSize + (padding / 2), halfSize - (padding / 2), 0, Math.PI * 2, true)\n        ctx.closePath()\n        ctx.clip()\n\n        ctx.drawImage(canvasImage, 0, 0, paddingSize, paddingSize)\n        ctx.restore()\n        resolve(canvas)\n    })\n}\n","/**\n * @param opts{Object}\n * @returns {function(*=): Promise<HTMLCanvasElement>}\n */\nexport default function (opts = {}) {\n    let {rQ = 0.34, gQ = 0.5, bQ = 0.16} = opts\n\n    return (canvasImage) => new Promise((resolve, reject) => {\n        let canvas = document.createElement('canvas')\n        canvas.width = canvasImage.width\n        canvas.height = canvasImage.height\n\n        let ctx = canvas.getContext('2d')\n        ctx.drawImage(canvasImage, 0, 0)\n\n        let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n        let data = imageData.data\n\n        for (let i = 0; i < data.length; i += 4) {\n            let brightness = rQ * data[i] + gQ * data[i + 1] + bQ * data[i + 2]\n\n            data[i] = brightness\n            data[i + 1] = brightness\n            data[i + 2] = brightness\n        }\n\n        ctx.putImageData(imageData, 0, 0)\n\n        resolve(canvas)\n    })\n}\n","/**\n * @param fileName{string}\n * @param mimeType{string}\n * @returns {string}\n */\nexport default function (fileName, mimeType) {\n    let tmp = fileName.split('.')\n    let ext = 'jpg'\n    if (mimeType.indexOf('png') > -1) {\n        ext = 'png'\n    } else if (mimeType.indexOf('webp') > -1) {\n        ext = 'webp'\n    }\n    tmp.pop()\n    tmp.push(ext)\n    return tmp.join('.')\n}\n","import fileExtByMimeType from '../helpers/fileExtByMimeType'\n\n/**\n * @param canvas{HTMLCanvasElement}\n * @param fileName\n * @param mimeType\n * @param q\n * @returns {Promise<File>}\n */\nexport default function (canvas, fileName, mimeType, q) {\n    return new Promise((resolve, reject) => {\n        canvas.toBlob((blob) => {\n            fileName = fileExtByMimeType(fileName, mimeType)\n            let fileOfBlob = new File([blob], fileName, {type: mimeType})\n            resolve(fileOfBlob)\n        }, mimeType, q)\n    })\n}\n","/**\n * @param canvas{HTMLCanvasElement}\n * @returns {Promise<HTMLCanvasElement>}\n */\nexport default function (canvas) {\n    return Promise.resolve(canvas)\n}\n","/**\n * @param canvas{HTMLCanvasElement}\n * @param mimeType\n * @param q\n * @returns {Promise<HTMLImageElement.src>}\n */\nexport default function (canvas, mimeType, q) {\n    return new Promise((resolve, reject) => {\n        let image = canvas.toDataURL(mimeType, q)\n        resolve(image)\n    })\n}\n","import loadBlob from './loaders/loadBlob.js'\nimport imageResize from './manipulations/imageResize.js'\nimport rotate from './manipulations/rotate.js'\nimport centerInRectangle from './manipulations/centerInRectangle.js'\nimport circle from './manipulations/circle.js'\nimport grayscale from './filters/grayscale.js'\nimport asBlob from './savers/asBlob'\nimport asCanvas from './savers/asCanvas'\nimport asImage from './savers/asImage'\n\nimport {RESIZE_TYPE_SQUARE, RESIZE_TYPE_TO, MANIPULATION, LOADER, FILTER} from './constants'\n\nclass ImageManipulation {\n    _tasks = []\n\n    _canvas = null\n    _loadedCanvas = null\n    _lastCanvas = null\n\n    _fileName = null\n\n    /**\n     * @param imageFile{File}\n     * @returns {ImageManipulation}\n     */\n    loadBlob (imageFile) {\n        this._addToTask(LOADER, loadBlob(imageFile))\n        return this\n    }\n\n    /**\n     * @param maxWidth\n     * @param maxHeight\n     * @param type\n     * @param options\n     * @returns {ImageManipulation}\n     * @private\n     */\n    _imageResize (maxWidth = 200, maxHeight = 100, type = null, options = {}) {\n        this._addToTask(MANIPULATION, imageResize(maxWidth, maxHeight, type, options))\n        return this\n    }\n\n    /**\n     * @param length\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    toSquare (length = 150, opts = {}) {\n        return this._imageResize(length, length, RESIZE_TYPE_SQUARE, opts)\n    }\n\n    /**\n     *\n     * @param maxWidth\n     * @param maxHeight\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    resize (maxWidth = 200, maxHeight = 100, opts = {}) {\n        return this._imageResize(maxWidth, maxHeight, RESIZE_TYPE_TO, opts)\n    }\n\n    /**\n     *\n     * @param degrees\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    rotate (degrees, opts = {}) {\n        this._addToTask(MANIPULATION, rotate(degrees, opts))\n        return this\n    }\n\n    /**\n     *\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    toGrayscale (opts = {}) {\n        this._addToTask(FILTER, grayscale(opts))\n        return this\n    }\n\n    /**\n     *\n     * @param width\n     * @param height\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    centerInRectangle (width = 200, height = 100, opts = {}) {\n        // resize\n        this._imageResize(width, height, RESIZE_TYPE_TO, opts)\n        // fit\n        this._addToTask(MANIPULATION, centerInRectangle(width, height, opts))\n        return this\n    }\n\n    /**\n     * @param diametr\n     * @param opts{Object}\n     * @returns {ImageManipulation}\n     */\n    toCircle (diametr = 150, opts = {}) {\n        // resize to square first\n        this._imageResize(diametr, diametr, RESIZE_TYPE_SQUARE, opts)\n        this._addToTask(MANIPULATION, circle(diametr, opts))\n        return this\n    }\n\n    /**\n     * @returns {Promise<boolean>}\n     */\n    async _runTasks () {\n        this._canvas = null\n        for (let i = 0; i < this._tasks.length; i++) {\n            // if type loader, covert image to canvas and save in _loadedCanvas\n            if (this._tasks[i].type === LOADER) {\n                let data = await this._tasks[i].func()\n                this._loadedCanvas = data.canvas\n                this._fileName = data.fileName\n            } else {\n                // if exist only _loadedCanvas get _loadedCanvas\n                if (this._canvas === null) {\n                    this._canvas = await this._tasks[i].func(this._loadedCanvas)\n                } else if (this._canvas !== null) {\n                    this._canvas = await this._tasks[i].func(this._canvas)\n                } else {\n                    throw new Error('use loadBlob first')\n                }\n            }\n        }\n        this._cleanTasks()\n        return true\n    }\n\n    /**\n     * @param type{String}\n     * @param func{Function}\n     * @private\n     */\n    _addToTask (type = 'manipulation', func) {\n        this._tasks.push({type, func})\n    }\n\n    _cleanTasks () {\n        this._tasks = []\n        // save last canvas\n        // for save image after all convert in same formats\n        if (this._canvas !== null) {\n            this._lastCanvas = this._canvas\n        }\n    }\n\n    /**\n     * @returns {HTMLCanvasElement}\n     */\n    getCanvas () {\n        return this._canvas || this._lastCanvas\n    }\n\n    /**\n     *\n     * @returns {String}\n     */\n    getFileName () {\n        return this._fileName\n    }\n\n    /**\n     * @param mimeType\n     * @param q\n     * @returns {Promise<File>}\n     */\n    saveAsBlob (mimeType = 'image/jpeg', q = '1.0') {\n        return this._runTasks().then(() => asBlob(this.getCanvas(), this.getFileName(), mimeType, q))\n    }\n\n    /**\n     * @returns {Promise<HTMLCanvasElement>}\n     */\n    saveAsCanvas () {\n        return this._runTasks().then(() => asCanvas(this.getCanvas()))\n    }\n\n    /**\n     * @param mimeType\n     * @param q\n     * @returns {Promise<HTMLImageElement.src>}\n     */\n    saveAsImage (mimeType = 'image/jpeg', q = '1.0') {\n        return this._runTasks().then(() => asImage(this.getCanvas(), mimeType, q))\n    }\n}\n\nexport default ImageManipulation\n","import 'regenerator-runtime/runtime'\nimport BrowserImageManipulation from './ImageManipulation.js'\n\nif (typeof window !== 'undefined') {\n    window.BrowserImageManipulation = BrowserImageManipulation\n}\n\nexport default BrowserImageManipulation\n"],"names":["degreesToRadian","degrees","Math","PI","global","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","prototype","Generator","generator","Object","create","context","Context","_invoke","makeInvokeMethod","tryCatch","fn","obj","arg","type","call","err","GeneratorFunction","GeneratorFunctionPrototype","defineIteratorMethods","forEach","method","this","AsyncIterator","invoke","resolve","reject","record","result","value","hasOwn","Promise","__await","then","unwrapped","enqueue","callInvokeWithMethodAndArg","previousPromise","state","GenStateSuspendedStart","GenStateExecuting","Error","GenStateCompleted","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","done","GenStateSuspendedYield","iterator","undefined","return","TypeError","info","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","values","iterable","iteratorMethod","iteratorSymbol","isNaN","length","i","Op","hasOwnProperty","$Symbol","Symbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","runtime","regeneratorRuntime","module","exports","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","Gp","constructor","displayName","isGeneratorFunction","genFun","ctor","name","mark","setPrototypeOf","__proto__","awrap","async","iter","toString","keys","object","key","reverse","pop","skipTempReset","prev","charAt","slice","stop","rootEntry","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","catch","thrown","delegateYield","Function","imageFile","image","document","createElement","reader","FileReader","onload","data","src","target","canvas","width","height","getContext","drawImage","fileName","readAsDataURL","f","r","e","n","t","o","c","require","u","a","code","p","1","MathLib","requested_features","__requested_features","features","js","indexOf","wasm","Multimath","has_wasm","use","mm_unsharp_mask","mm_resize","inherits","resizeAndUnsharp","options","cache","resize","unsharpAmount","unsharp_mask","toWidth","toHeight","unsharpRadius","unsharpThreshold","./mm_resize","multimath","multimath/lib/unsharp_mask","2","clampTo8","convolveHorizontally","dest","srcW","srcH","destW","filters","g","b","filterPtr","filterShift","filterSize","srcPtr","srcY","destX","filterVal","srcOffset","destOffset","convolveVertically","3","4","wasm_fn","wasm_src","./convolve_wasm_base64","./resize","./resize_wasm","5","resetAlpha","dst","ptr","len","createFilters","destH","scaleX","scaleY","offsetX","offsetY","Uint8Array","quality","alpha","filtersX","filtersY","tmp","./convolve","./resize_filter_gen","6","toFixedPoint","num","round","FIXED_FRAC_BITS","FILTER_INFO","srcSize","destSize","scale","offset","destPixel","srcPixel","srcFirst","srcLast","filterElementSize","floatFilter","fxpFilter","total","pxl","idx","floatVal","filterTotal","leftNotEmpty","rightNotEmpty","filterFunction","filter","scaleInverted","scaleClamped","min","srcWindow","win","maxFilterElementSize","floor","packedFilter","Int16Array","packedFilterPtr","slowCopy","subarray","set","max","ceil","Float32Array","./resize_filter_info","7","x","xpi","sin","cos","8","asUint8Array","buffer","byteLength","copyInt16asLE","target_offset","IS_LE","Uint32Array","__","tmp_offset","__align","filtersX_offset","filtersY_offset","alloc_bytes","instance","__instance","mem","__memory","mem32","src32","convolveHV","_convolveHV","9","Pool","idle","available","acquired","lastId","timeoutId","acquire","_this","resource","id","release","_this2","lastUsed","Date","now","setTimeout","gc","_this3","destroy","10","fromWidth","fromHeight","srcTileSize","destTileBorder","minScale","stageCount","log","pow","11","pixelFloor","nearest","abs","PIXEL_EPSILON","pixelCeil","innerTileWidth","innerTileHeight","y","innerX","innerY","toTileWidth","toTileHeight","tile","tiles","toX","toY","toInnerX","toInnerY","toInnerWidth","toInnerHeight","12","objClass","isCanvas","element","cname","isImage","limiter","concurrency","roll","active","queue","shift","cib_quality_name","cib_support","createImageBitmap","resizeWidth","resizeHeight","resizeQuality","bitmap","status","close","13","mathLib","onmessage","ev","opts","postMessage","./mathlib","14","gaussCoef","sigma","exp","g1","g2","k","a0","a1","a2","a3","b1","b2","left_corner","right_corner","convolveMono16","out","line","coeff","prev_src","curr_src","curr_out","prev_out","prev_prev_out","src_index","out_index","line_index","j","coeff_a0","coeff_a1","coeff_b1","coeff_b2","blurMono16","radius","Uint16Array","tmp_line","15","superCtor","super_","enumerable","writable","configurable","TempCtor","16","MultiMath","assign","DEFAULT_OPTIONS","__cache","hasWebAssembly","__init_promise","__modules","modules","__wasm","__isLE","base64decode","init","all","map","WebAssembly","compile","__base64decode","m","__reallocate","bytes","Memory","initial","mem_size","grow","memsize","env_extra","Module","env_base","memoryBase","memory","tableBase","table","Table","Instance","env","number","base","reminder","./lib/base64decode","./lib/wa_detect","object-assign","17","str","input","replace","bits","tailbits","18","img","size","19","./unsharp_mask","./unsharp_mask_wasm","./unsharp_mask_wasm_base64","20","glur_mono16","hsl_l16","amount","threshold","h","s","l","m1","m2","hShifted","diff","iTimes4","lightness","blured","amountFp","thresholdFp","./hsl_l16","glur/mono16","21","pixels","img_bytes_cnt","hsl_bytes_cnt","blur_bytes_cnt","blur_line_byte_cnt","hsl_offset","blur_offset","blur_tmp_offset","blur_line_offset","blur_coeffs_offset","img32","_hsl_l16","_blurMono16","unsharp","_unsharp","22","23","wa","bin","test","24","toObject","val","getOwnPropertySymbols","propIsEnumerable","propertyIsEnumerable","test1","String","getOwnPropertyNames","test2","fromCharCode","join","test3","split","letter","source","from","symbols","to","arguments","25","bundleFn","sources","stringify","JSON","resolveSources","workerSources","depPath","depKey","wkey","cacheKeys","default","random","wcache","skey","scache","URL","window","webkitURL","mozURL","msURL","blob","Blob","bare","workerUrl","createObjectURL","worker","Worker","objectURL","/","workerFabric","webworkify","terminate","url","revokeObjectURL","Pica","DEFAULT_PICA_OPTS","limiter_key","__limit","singletones","utils","cib","ww","__workersPool","__mathlib","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","Array","isArray","createStages","createRegions","NEED_SAFARI_FIX","navigator","userAgent","hardwareConcurrency","DEFAULT_RESIZE_OPTS","CAN_NEW_IMAGE_DATA","CAN_CREATE_IMAGE_BITMAP","__initPromise","ImageData","Uint8ClampedArray","ImageBitmap","debug","wpool_key","initMath","mathlib","checkCibResize","naturalWidth","naturalHeight","canceled","cancelToken","toCtx","Boolean","imageBitmap","tmpCanvas","tmpCtx","iData","getImageData","putImageData","invokeResize","w","preload","wasm_nodule","tileAndResize","srcCtx","srcImageBitmap","processTile","srcImageData","globalCompositeOperation","toImageData","createImageData","cleanup","regions","jobs","stages","processStages","_stages$shift","_stages$shift2","isLastStage","resizeBuffer","toBlob","mimeType","asString","atob","toDataURL","asBuffer","charCodeAt","./lib/mathlib","./lib/pool","./lib/stepper","./lib/tiler","./lib/utils","./lib/worker","maxWidth","maxHeight","resizeOptions","canvasImage","outputCanvas","ratio","newHeight","newWidth","ratioWidth","ratioHeight","pica","sx","sy","cropedCanvas","cropedCanvasCtx","resizedCanvas","padding","bgColor","calcAngle","angle","degreesRad","calcAngleRad","angleRad","sinCos","cosAngle","cosCalcAngle","sinAngle","sinCalcAngle","ctx","beginPath","rect","fillStyle","fill","save","translate","rotate","restore","dx","dy","diametr","paddingSize","halfSize","arc","closePath","clip","rQ","gQ","bQ","imageData","brightness","ext","q","fileExtByMimeType","fileOfBlob","File","ImageManipulation","_tasks","_canvas","_loadedCanvas","_lastCanvas","_fileName","_addToTask","loadBlob","imageResize","_imageResize","grayscale","centerInRectangle","circle","func","_cleanTasks","_runTasks","asBlob","getCanvas","getFileName","asCanvas","asImage","BrowserImageManipulation"],"mappings":"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"}